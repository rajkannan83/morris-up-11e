/*
 Poe eBook Framework
 Copyright 2011-2014 Metrodigi, Inc. All rights reserved.
 build 1000 20140422
*/
(function(){this.MooTools={version:"1.4.1",build:"d1fb25710e3c5482a219ab9dc675a4e0ad2176b6"};var f=this.typeOf=function(i){if(i==null){return"null"}if(i.$family){return i.$family()}if(i.nodeName){if(i.nodeType==1){return"element"}if(i.nodeType==3){return(/\S/).test(i.nodeValue)?"textnode":"whitespace"}}else{if(typeof i.length=="number"){if(i.callee){return"arguments"}if("item" in i){return"collection"}}}return typeof i};var w=this.instanceOf=function(y,i){if(y==null){return false}var x=y.$constructor||y.constructor;while(x){if(x===i){return true}x=x.parent}return y instanceof i};var g=this.Function;var t=true;for(var s in {toString:1}){t=null}if(t){t=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}g.prototype.overloadSetter=function(x){var i=this;return function(z,y){if(z==null){return this}if(x||typeof z!="string"){for(var A in z){i.call(this,A,z[A])}if(t){for(var B=t.length;B--;){A=t[B];if(z.hasOwnProperty(A)){i.call(this,A,z[A])}}}}else{i.call(this,z,y)}return this}};g.prototype.overloadGetter=function(x){var i=this;return function(z){var A,y;if(x||typeof z!="string"){A=z}else{if(arguments.length>1){A=arguments}}if(A){y={};for(var B=0;B<A.length;B++){y[A[B]]=i.call(this,A[B])}}else{y=i.call(this,z)}return y}};g.prototype.extend=function(i,x){this[i]=x}.overloadSetter();g.prototype.implement=function(i,x){this.prototype[i]=x}.overloadSetter();var q=Array.prototype.slice;g.from=function(i){return(f(i)=="function")?i:function(){return i}};Array.from=function(i){if(i==null){return[]}return(m.isEnumerable(i)&&typeof i!="string")?(f(i)=="array")?i:q.call(i):[i]};Number.from=function(x){var i=parseFloat(x);return isFinite(i)?i:null};String.from=function(i){return i+""};g.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var m=this.Type=function(z,y){if(z){var x=z.toLowerCase();var i=function(A){return(f(A)==x)};m["is"+z]=i;if(y!=null){y.prototype.$family=(function(){return x}).hide();y.type=i}}if(y==null){return null}y.extend(this);y.$constructor=m;y.prototype.$constructor=y;return y};var r=Object.prototype.toString;m.isEnumerable=function(i){return(i!=null&&typeof i.length=="number"&&r.call(i)!="[object Function]")};var b={};var d=function(i){var x=f(i.prototype);return b[x]||(b[x]=[])};var k=function(y,C){if(C&&C.$hidden){return}var x=d(this);for(var z=0;z<x.length;z++){var B=x[z];if(f(B)=="type"){k.call(B,y,C)}else{B.call(this,y,C)}}var A=this.prototype[y];if(A==null||!A.$protected){this.prototype[y]=C}if(this[y]==null&&f(C)=="function"){v.call(this,y,function(i){return C.apply(i,q.call(arguments,1))})}};var v=function(i,y){if(y&&y.$hidden){return}var x=this[i];if(x==null||!x.$protected){this[i]=y}};m.implement({implement:k.overloadSetter(),extend:v.overloadSetter(),alias:function(i,x){k.call(this,i,this.prototype[x])}.overloadSetter(),mirror:function(i){d(this).push(i);return this}});new m("Type",m);var c=function(x,B,z){var y=(B!=Object),F=B.prototype;if(y){B=new m(x,B)}for(var C=0,A=z.length;C<A;C++){var G=z[C],E=B[G],D=F[G];if(E){E.protect()}if(y&&D){delete F[G];F[G]=D.protect()}}if(y){B.implement(F)}return c};c("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",g,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=v.overloadSetter();Date.extend("now",function(){return +(new Date)});new m("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(x,i){return Math.floor(Math.random()*(i-x+1)+x)});var n=Object.prototype.hasOwnProperty;Object.extend("forEach",function(i,y,z){for(var x in i){if(n.call(i,x)){y.call(z,i[x],x,i)}}});Object.each=Object.forEach;Array.implement({forEach:function(z,A){for(var y=0,x=this.length;y<x;y++){if(y in this){z.call(A,this[y],y,this)}}},each:function(i,x){Array.forEach(this,i,x);return this}});var u=function(i){switch(f(i)){case"array":return i.clone();case"object":return Object.clone(i);default:return i}};Array.implement("clone",function(){var x=this.length,y=new Array(x);while(x--){y[x]=u(this[x])}return y});var a=function(x,i,y){switch(f(y)){case"object":if(f(x[i])=="object"){Object.merge(x[i],y)}else{x[i]=Object.clone(y)}break;case"array":x[i]=y.clone();break;default:x[i]=y}return x};Object.extend({merge:function(D,z,y){if(f(z)=="string"){return a(D,z,y)}for(var C=1,x=arguments.length;C<x;C++){var A=arguments[C];for(var B in A){a(D,B,A[B])}}return D},clone:function(i){var y={};for(var x in i){y[x]=u(i[x])}return y},append:function(B){for(var A=1,y=arguments.length;A<y;A++){var x=arguments[A]||{};for(var z in x){B[z]=x[z]}}return B}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(i){new m(i)});var l=Date.now();String.extend("uniqueID",function(){return(l++).toString(36)});var j=this.Hash=new m("Hash",function(i){if(f(i)=="hash"){i=Object.clone(i.getClean())}for(var x in i){this[x]=i[x]}return this});j.implement({forEach:function(i,x){Object.forEach(this,i,x)},getClean:function(){var x={};for(var i in this){if(this.hasOwnProperty(i)){x[i]=this[i]}}return x},getLength:function(){var x=0;for(var i in this){if(this.hasOwnProperty(i)){x++}}return x}});j.alias("each","forEach");Object.type=m.isObject;var p=this.Native=function(i){return new m(i.name,i.initialize)};p.type=m.type;p.implement=function(z,x){for(var y=0;y<z.length;y++){z[y].implement(x)}return p};var o=Array.type;Array.type=function(i){return w(i,Array)||o(i)};this.$A=function(i){return Array.from(i).slice()};this.$arguments=function(x){return function(){return arguments[x]}};this.$chk=function(i){return !!(i||i===0)};this.$clear=function(i){clearTimeout(i);clearInterval(i);return null};this.$defined=function(i){return(i!=null)};this.$each=function(y,x,z){var i=f(y);((i=="arguments"||i=="collection"||i=="array"||i=="elements")?Array:Object).each(y,x,z)};this.$empty=function(){};this.$extend=function(x,i){return Object.append(x,i)};this.$H=function(i){return new j(i)};this.$merge=function(){var i=Array.slice(arguments);i.unshift({});return Object.merge.apply(null,i)};this.$lambda=g.from;this.$mixin=Object.merge;this.$random=Number.random;this.$splat=Array.from;this.$time=Date.now;this.$type=function(i){var x=f(i);if(x=="elements"){return"array"}return(x=="null")?false:x};this.$unlink=function(i){switch(f(i)){case"object":return Object.clone(i);case"array":return Array.clone(i);case"hash":return new j(i);default:return i}}})();Array.implement({every:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&!c.call(d,this[b],b,this)){return false}}return true},filter:function(d,f){var c=[];for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&d.call(f,this[b],b,this)){c.push(this[b])}}return c},indexOf:function(c,d){var b=this.length>>>0;for(var a=(d<0)?Math.max(0,b+d):d||0;a<b;a++){if(this[a]===c){return a}}return -1},map:function(c,f){var d=this.length>>>0,b=Array(d);for(var a=0;a<d;a++){if(a in this){b[a]=c.call(f,this[a],a,this)}}return b},some:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true}}return false},clean:function(){return this.filter(function(a){return a!=null})},invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b)})},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a]}return d},link:function(c){var a={};for(var f=0,b=this.length;f<b;f++){for(var d in c){if(c[d](this[f])){a[d]=this[f];delete c[d];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},append:function(a){this.push.apply(this,a);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b])}return this},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b])}return d},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b]}}return null},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(c){if(c.length==1){c+=c}return c.toInt(16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(d){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!d){return"transparent"}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c)}return(d)?b:"#"+b.join("")}});Array.alias("extend","append");var $pick=function(){return Array.from(arguments).pick()};Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(c){}}return null}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a))}catch(b){}return null},bind:function(f){var a=this,b=arguments.length>1?Array.slice(arguments,1):null,d=function(){};var c=function(){var i=f,j=arguments.length;if(this instanceof c){d.prototype=a.prototype;i=new d}var g=(!b&&!j)?a.call(i):a.apply(i,b&&j?b.concat(Array.slice(arguments)):b||arguments);return i==f?g:i};return c},pass:function(b,c){var a=this;if(b!=null){b=Array.from(b)}return function(){return a.apply(c,b||arguments)}},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b)},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c)}});delete Function.prototype.bind;Function.implement({create:function(b){var a=this;b=b||{};return function(d){var c=b.arguments;c=(c!=null)?Array.from(c):Array.slice(arguments,(b.event)?1:0);if(b.event){c=[d||window.event].extend(c)}var f=function(){return a.apply(b.bind||null,c)};if(b.delay){return setTimeout(f,b.delay)}if(b.periodical){return setInterval(f,b.periodical)}if(b.attempt){return Function.attempt(f)}return f()}},bind:function(c,b){var a=this;if(b!=null){b=Array.from(b)}return function(){return a.apply(c,b||arguments)}},bindWithEvent:function(c,b){var a=this;if(b!=null){b=Array.from(b)}return function(d){return a.apply(c,(b==null)?arguments:[d].concat(b))}},run:function(a,b){return this.apply(b,Array.from(a))}});if(Object.create==Function.prototype.create){Object.create=null}var $try=Function.attempt;Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.from(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);String.implement({test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this)},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:String(this).indexOf(a)>-1},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=String(this).match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},substitute:function(a,b){return String(this).replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1)}return(a[c]!=null)?a[c]:""})}});(function(){var m=this.document;var k=m.window=this;var b=1;this.$uid=(k.ActiveXObject)?function(r){return(r.uid||(r.uid=[b++]))[0]}:function(r){return r.uid||(r.uid=b++)};$uid(k);$uid(m);var a=navigator.userAgent.toLowerCase(),c=navigator.platform.toLowerCase(),l=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],g=l[1]=="ie"&&m.documentMode;var q=this.Browser={extend:Function.prototype.extend,name:(l[1]=="version")?l[3]:l[1],version:g||parseFloat((l[1]=="opera"&&l[4])?l[4]:l[2]),Platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||c.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(m.evaluate),air:!!(k.runtime),query:!!(m.querySelector),json:!!(k.JSON)},Plugins:{}};q[q.name]=true;q[q.name+parseInt(q.version,10)]=true;q.Platform[q.Platform.name]=true;q.Request=(function(){var t=function(){return new XMLHttpRequest()};var s=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var r=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){t();return t},function(){s();return s},function(){r();return r})})();q.Features.xhr=!!(q.Request);var j=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);q.Plugins.Flash={version:Number(j[0]||"0."+j[1])||0,build:Number(j[2])||0};q.exec=function(s){if(!s){return s}if(k.execScript){k.execScript(s)}else{var r=m.createElement("script");r.setAttribute("type","text/javascript");r.text=s;m.head.appendChild(r);m.head.removeChild(r)}return s};String.implement("stripScripts",function(s){var r="";var t=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(u,v){r+=v+"\n";return""});if(s===true){q.exec(r)}else{if(typeOf(s)=="function"){s(r,t)}}return t});q.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(r,s){k[r]=s});this.Document=m.$constructor=new Type("Document",function(){});m.$family=Function.from("document").hide();Document.mirror(function(r,s){m[r]=s});m.html=m.documentElement;if(!m.head){m.head=m.getElementsByTagName("head")[0]}if(m.execCommand){try{m.execCommand("BackgroundImageCache",false,true)}catch(i){}}if(this.attachEvent&&!this.addEventListener){var d=function(){this.detachEvent("onunload",d);m.head=m.html=m.window=null};this.attachEvent("onunload",d)}var o=Array.from;try{o(m.html.childNodes)}catch(i){Array.from=function(s){if(typeof s!="string"&&Type.isEnumerable(s)&&typeOf(s)!="array"){var r=s.length,t=new Array(r);while(r--){t[r]=s[r]}return t}return o(s)};var n=Array.prototype,p=n.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(r){var s=n[r];Array[r]=function(t){return s.apply(Array.from(t),p.call(arguments,1))}})}if(q.Platform.ios){q.Platform.ipod=true}q.Engine={};var f=function(s,r){q.Engine.name=s;q.Engine[s+r]=true;q.Engine.version=r};if(q.ie){q.Engine.trident=true;switch(q.version){case 6:f("trident",4);break;case 7:f("trident",5);break;case 8:f("trident",6)}}if(q.firefox){q.Engine.gecko=true;if(q.version>=3){f("gecko",19)}else{f("gecko",18)}}if(q.safari||q.chrome){q.Engine.webkit=true;switch(q.version){case 2:f("webkit",419);break;case 3:f("webkit",420);break;case 4:f("webkit",525)}}if(q.opera){q.Engine.presto=true;if(q.version>=9.6){f("presto",960)}else{if(q.version>=9.5){f("presto",950)}else{f("presto",925)}}}if(q.name=="unknown"){switch((a.match(/(?:webkit|khtml|gecko)/)||[])[0]){case"webkit":case"khtml":q.Engine.webkit=true;break;case"gecko":q.Engine.gecko=true}}this.$exec=q.exec})();(function(){var a=Object.prototype.hasOwnProperty;Object.extend({subset:function(d,j){var g={};for(var f=0,b=j.length;f<b;f++){var c=j[f];if(c in d){g[c]=d[c]}}return g},map:function(b,f,g){var d={};for(var c in b){if(a.call(b,c)){d[c]=f.call(g,b[c],c,b)}}return d},filter:function(b,f,i){var d={};for(var c in b){var g=b[c];if(a.call(b,c)&&f.call(i,g,c,b)){d[c]=g}}return d},every:function(b,d,f){for(var c in b){if(a.call(b,c)&&!d.call(f,b[c],c)){return false}}return true},some:function(b,d,f){for(var c in b){if(a.call(b,c)&&d.call(f,b[c],c)){return true}}return false},keys:function(b){var d=[];for(var c in b){if(a.call(b,c)){d.push(c)}}return d},values:function(c){var b=[];for(var d in c){if(a.call(c,d)){b.push(c[d])}}return b},getLength:function(b){return Object.keys(b).length},keyOf:function(b,d){for(var c in b){if(a.call(b,c)&&b[c]===d){return c}}return null},contains:function(b,c){return Object.keyOf(b,c)!=null},toQueryString:function(b,c){var d=[];Object.each(b,function(j,i){if(c){i=c+"["+i+"]"}var g;switch(typeOf(j)){case"object":g=Object.toQueryString(j,i);break;case"array":var f={};j.each(function(l,k){f[k]=l});g=Object.toQueryString(f,i);break;default:g=i+"="+encodeURIComponent(j)}if(j!=null){d.push(g)}});return d.join("&")}})})();Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(a){return Object.keyOf(this,a)},hasValue:function(a){return Object.contains(this,a)},extend:function(a){Hash.each(a||{},function(c,b){Hash.set(this,b,c)},this);return this},combine:function(a){Hash.each(a||{},function(c,b){Hash.include(this,b,c)},this);return this},erase:function(a){if(this.hasOwnProperty(a)){delete this[a]}return this},get:function(a){return(this.hasOwnProperty(a))?this[a]:null},set:function(a,b){if(!this[a]||this.hasOwnProperty(a)){this[a]=b}return this},empty:function(){Hash.each(this,function(b,a){delete this[a]},this);return this},include:function(a,b){if(this[a]==null){this[a]=b}return this},map:function(a,b){return new Hash(Object.map(this,a,b))},filter:function(a,b){return new Hash(Object.filter(this,a,b))},every:function(a,b){return Object.every(this,a,b)},some:function(a,b){return Object.some(this,a,b)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(a){return Object.toQueryString(this,a)}});Hash.extend=Object.append;Hash.alias({indexOf:"keyOf",contains:"hasValue"});(function(){var m,p,n,i,a={},c={},o=/\\/g;var f=function(s,r){if(s==null){return null}if(s.Slick===true){return s}s=(""+s).replace(/^\s+|\s+$/g,"");i=!!r;var q=(i)?c:a;if(q[s]){return q[s]}m={Slick:true,expressions:[],raw:s,reverse:function(){return f(this.raw,true)}};p=-1;while(s!=(s=s.replace(l,b))){}m.length=m.expressions.length;return q[m.raw]=(i)?j(m):m};var k=function(q){if(q==="!"){return" "}else{if(q===" "){return"!"}else{if((/^!/).test(q)){return q.replace(/^!/,"")}else{return"!"+q}}}};var j=function(w){var t=w.expressions;for(var r=0;r<t.length;r++){var v=t[r];var s={parts:[],tag:"*",combinator:k(v[0].combinator)};for(var q=0;q<v.length;q++){var u=v[q];if(!u.reverseCombinator){u.reverseCombinator=" "}u.combinator=u.reverseCombinator;delete u.reverseCombinator}v.reverse().push(s)}return w};var g=function(q){return q.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(r){return"\\"+r})};var l=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+g(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function b(z,u,F,B,t,E,s,D,C,A,w,H,I,x,r,y){if(u||p===-1){m.expressions[++p]=[];n=-1;if(u){return""}}if(F||B||n===-1){F=F||" ";var v=m.expressions[p];if(i&&v[n]){v[n].reverseCombinator=k(F)}v[++n]={combinator:F,tag:"*"}}var q=m.expressions[p][n];if(t){q.tag=t.replace(o,"")}else{if(E){q.id=E.replace(o,"")}else{if(s){s=s.replace(o,"");if(!q.classList){q.classList=[]}if(!q.classes){q.classes=[]}q.classList.push(s);q.classes.push({value:s,regexp:new RegExp("(^|\\s)"+g(s)+"(\\s|$)")})}else{if(I){y=y||r;y=y?y.replace(o,""):null;if(!q.pseudos){q.pseudos=[]}q.pseudos.push({key:I.replace(o,""),value:y,type:H.length==1?"class":"element"})}else{if(D){D=D.replace(o,"");w=(w||"").replace(o,"");var G,J;switch(C){case"^=":J=new RegExp("^"+g(w));break;case"$=":J=new RegExp(g(w)+"$");break;case"~=":J=new RegExp("(^|\\s)"+g(w)+"(\\s|$)");break;case"|=":J=new RegExp("^"+g(w)+"(-|$)");break;case"=":G=function(K){return w==K};break;case"*=":G=function(K){return K&&K.indexOf(w)>-1};break;case"!=":G=function(K){return w!=K};break;default:G=function(K){return !!K}}if(w==""&&(/^[*$^]=$/).test(C)){G=function(){return false}}if(!G){G=function(K){return K&&J.test(K)}}if(!q.attributes){q.attributes=[]}q.attributes.push({key:D,operator:C,value:w,test:G})}}}}}return""}var d=(this.Slick||{});d.parse=function(q){return f(q)};d.escapeRegExp=g;if(!this.Slick){this.Slick=d}}).apply((typeof exports!="undefined")?exports:this);(function(){var m={},o={},d=Object.prototype.toString;m.isNativeCode=function(c){return(/\{\s*\[native code\]\s*\}/).test(""+c)};m.isXML=function(c){return(!!c.xmlVersion)||(!!c.xml)||(d.call(c)=="[object XMLDocument]")||(c.nodeType==9&&c.documentElement.nodeName!="HTML")};m.setDocument=function(z){var w=z.nodeType;if(w==9){}else{if(w){z=z.ownerDocument}else{if(z.navigator){z=z.document}else{return}}}if(this.document===z){return}this.document=z;var B=z.documentElement,x=this.getUIDXML(B),r=o[x],D;if(r){for(D in r){this[D]=r[D]}return}r=o[x]={};r.root=B;r.isXMLDocument=this.isXML(z);r.brokenStarGEBTN=r.starSelectsClosedQSA=r.idGetsName=r.brokenMixedCaseQSA=r.brokenGEBCN=r.brokenCheckedQSA=r.brokenEmptyAttributeQSA=r.isHTMLDocument=r.nativeMatchesSelector=false;var p,q,A,t,u;var v,c="slick_uniqueid";var C=z.createElement("div");var s=z.body||z.getElementsByTagName("body")[0]||B;s.appendChild(C);try{C.innerHTML='<a id="'+c+'"></a>';r.isHTMLDocument=!!z.getElementById(c)}catch(y){}if(r.isHTMLDocument){C.style.display="none";C.appendChild(z.createComment(""));q=(C.getElementsByTagName("*").length>1);try{C.innerHTML="foo</foo>";v=C.getElementsByTagName("*");p=(v&&!!v.length&&v[0].nodeName.charAt(0)=="/")}catch(y){}r.brokenStarGEBTN=q||p;try{C.innerHTML='<a name="'+c+'"></a><b id="'+c+'"></b>';r.idGetsName=z.getElementById(c)===C.firstChild}catch(y){}if(C.getElementsByClassName){try{C.innerHTML='<a class="f"></a><a class="b"></a>';C.getElementsByClassName("b").length;C.firstChild.className="b";t=(C.getElementsByClassName("b").length!=2)}catch(y){}try{C.innerHTML='<a class="a"></a><a class="f b a"></a>';A=(C.getElementsByClassName("a").length!=2)}catch(y){}r.brokenGEBCN=t||A}if(C.querySelectorAll){try{C.innerHTML="foo</foo>";v=C.querySelectorAll("*");r.starSelectsClosedQSA=(v&&!!v.length&&v[0].nodeName.charAt(0)=="/")}catch(y){}try{C.innerHTML='<a class="MiX"></a>';r.brokenMixedCaseQSA=!C.querySelectorAll(".MiX").length}catch(y){}try{C.innerHTML='<select><option selected="selected">a</option></select>';r.brokenCheckedQSA=(C.querySelectorAll(":checked").length==0)}catch(y){}try{C.innerHTML='<a class=""></a>';r.brokenEmptyAttributeQSA=(C.querySelectorAll('[class*=""]').length!=0)}catch(y){}}try{C.innerHTML='<form action="s"><input id="action"/></form>';u=(C.firstChild.getAttribute("action")!="s")}catch(y){}r.nativeMatchesSelector=B.matchesSelector||B.mozMatchesSelector||B.webkitMatchesSelector;if(r.nativeMatchesSelector){try{r.nativeMatchesSelector.call(B,":slick");r.nativeMatchesSelector=null}catch(y){}}}try{B.slick_expando=1;delete B.slick_expando;r.getUID=this.getUIDHTML}catch(y){r.getUID=this.getUIDXML}s.removeChild(C);C=v=s=null;r.getAttribute=(r.isHTMLDocument&&u)?function(G,E){var H=this.attributeGetters[E];if(H){return H.call(G)}var F=G.getAttributeNode(E);return(F)?F.nodeValue:null}:function(F,E){var G=this.attributeGetters[E];return(G)?G.call(F):F.getAttribute(E)};r.hasAttribute=(B&&this.isNativeCode(B.hasAttribute))?function(F,E){return F.hasAttribute(E)}:function(F,E){F=F.getAttributeNode(E);return !!(F&&(F.specified||F.nodeValue))};r.contains=(B&&this.isNativeCode(B.contains))?function(E,F){return E.contains(F)}:(B&&B.compareDocumentPosition)?function(E,F){return E===F||!!(E.compareDocumentPosition(F)&16)}:function(E,F){if(F){do{if(F===E){return true}}while((F=F.parentNode))}return false};r.documentSorter=(B.compareDocumentPosition)?function(F,E){if(!F.compareDocumentPosition||!E.compareDocumentPosition){return 0}return F.compareDocumentPosition(E)&4?-1:F===E?0:1}:("sourceIndex" in B)?function(F,E){if(!F.sourceIndex||!E.sourceIndex){return 0}return F.sourceIndex-E.sourceIndex}:(z.createRange)?function(H,F){if(!H.ownerDocument||!F.ownerDocument){return 0}var G=H.ownerDocument.createRange(),E=F.ownerDocument.createRange();G.setStart(H,0);G.setEnd(H,0);E.setStart(F,0);E.setEnd(F,0);return G.compareBoundaryPoints(Range.START_TO_END,E)}:null;B=null;for(D in r){this[D]=r[D]}};var g=/^([#.]?)((?:[\w-]+|\*))$/,j=/\[.+[*$^]=(?:""|'')?\]/,i={};m.search=function(V,A,I,t){var q=this.found=(t)?null:(I||[]);if(!V){return q}else{if(V.navigator){V=V.document}else{if(!V.nodeType){return q}}}var G,P,W=this.uniques={},J=!!(I&&I.length),z=(V.nodeType==9);if(this.document!==(z?V:V.ownerDocument)){this.setDocument(V)}if(J){for(P=q.length;P--;){W[this.getUID(q[P])]=true}}if(typeof A=="string"){var s=A.match(g);simpleSelectors:if(s){var v=s[1],w=s[2],B,F;if(!v){if(w=="*"&&this.brokenStarGEBTN){break simpleSelectors}F=V.getElementsByTagName(w);if(t){return F[0]||null}for(P=0;B=F[P++];){if(!(J&&W[this.getUID(B)])){q.push(B)}}}else{if(v=="#"){if(!this.isHTMLDocument||!z){break simpleSelectors}B=V.getElementById(w);if(!B){return q}if(this.idGetsName&&B.getAttributeNode("id").nodeValue!=w){break simpleSelectors}if(t){return B||null}if(!(J&&W[this.getUID(B)])){q.push(B)}}else{if(v=="."){if(!this.isHTMLDocument||((!V.getElementsByClassName||this.brokenGEBCN)&&V.querySelectorAll)){break simpleSelectors}if(V.getElementsByClassName&&!this.brokenGEBCN){F=V.getElementsByClassName(w);if(t){return F[0]||null}for(P=0;B=F[P++];){if(!(J&&W[this.getUID(B)])){q.push(B)}}}else{var U=new RegExp("(^|\\s)"+f.escapeRegExp(w)+"(\\s|$)");F=V.getElementsByTagName("*");for(P=0;B=F[P++];){className=B.className;if(!(className&&U.test(className))){continue}if(t){return B}if(!(J&&W[this.getUID(B)])){q.push(B)}}}}}}if(J){this.sort(q)}return(t)?null:q}querySelector:if(V.querySelectorAll){if(!this.isHTMLDocument||i[A]||this.brokenMixedCaseQSA||(this.brokenCheckedQSA&&A.indexOf(":checked")>-1)||(this.brokenEmptyAttributeQSA&&j.test(A))||(!z&&A.indexOf(",")>-1)||f.disableQSA){break querySelector}var T=A,y=V;if(!z){var D=y.getAttribute("id"),u="slickid__";y.setAttribute("id",u);T="#"+u+" "+T;V=y.parentNode}try{if(t){return V.querySelector(T)||null}else{F=V.querySelectorAll(T)}}catch(R){i[A]=1;break querySelector}finally{if(!z){if(D){y.setAttribute("id",D)}else{y.removeAttribute("id")}V=y}}if(this.starSelectsClosedQSA){for(P=0;B=F[P++];){if(B.nodeName>"@"&&!(J&&W[this.getUID(B)])){q.push(B)}}}else{for(P=0;B=F[P++];){if(!(J&&W[this.getUID(B)])){q.push(B)}}}if(J){this.sort(q)}return q}G=this.Slick.parse(A);if(!G.length){return q}}else{if(A==null){return q}else{if(A.Slick){G=A}else{if(this.contains(V.documentElement||V,A)){(q)?q.push(A):q=A;return q}else{return q}}}}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=(!J&&(t||(G.length==1&&G.expressions[0].length==1)))?this.pushArray:this.pushUID;if(q==null){q=[]}var N,M,L;var C,K,E,c,r,H,X;var O,Q,p,x,S=G.expressions;search:for(P=0;(Q=S[P]);P++){for(N=0;(p=Q[N]);N++){C="combinator:"+p.combinator;if(!this[C]){continue search}K=(this.isXMLDocument)?p.tag:p.tag.toUpperCase();E=p.id;c=p.classList;r=p.classes;H=p.attributes;X=p.pseudos;x=(N===(Q.length-1));this.bitUniques={};if(x){this.uniques=W;this.found=q}else{this.uniques={};this.found=[]}if(N===0){this[C](V,K,E,r,H,X,c);if(t&&x&&q.length){break search}}else{if(t&&x){for(M=0,L=O.length;M<L;M++){this[C](O[M],K,E,r,H,X,c);if(q.length){break search}}}else{for(M=0,L=O.length;M<L;M++){this[C](O[M],K,E,r,H,X,c)}}}O=this.found}}if(J||(G.expressions.length>1)){this.sort(q)}return(t)?(q[0]||null):q};m.uidx=1;m.uidk="slick-uniqueid";m.getUIDXML=function(p){var c=p.getAttribute(this.uidk);if(!c){c=this.uidx++;p.setAttribute(this.uidk,c)}return c};m.getUIDHTML=function(c){return c.uniqueNumber||(c.uniqueNumber=this.uidx++)};m.sort=function(c){if(!this.documentSorter){return c}c.sort(this.documentSorter);return c};m.cacheNTH={};m.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;m.parseNTHArgument=function(s){var q=s.match(this.matchNTH);if(!q){return false}var r=q[2]||false;var p=q[1]||1;if(p=="-"){p=-1}var c=+q[3]||0;q=(r=="n")?{a:p,b:c}:(r=="odd")?{a:2,b:1}:(r=="even")?{a:2,b:0}:{a:0,b:p};return(this.cacheNTH[s]=q)};m.createNTHPseudo=function(r,p,c,q){return function(u,s){var w=this.getUID(u);if(!this[c][w]){var C=u.parentNode;if(!C){return false}var t=C[r],v=1;if(q){var B=u.nodeName;do{if(t.nodeName!=B){continue}this[c][this.getUID(t)]=v++}while((t=t[p]))}else{do{if(t.nodeType!=1){continue}this[c][this.getUID(t)]=v++}while((t=t[p]))}}s=s||"n";var x=this.cacheNTH[s]||this.parseNTHArgument(s);if(!x){return false}var A=x.a,z=x.b,y=this[c][w];if(A==0){return z==y}if(A>0){if(y<z){return false}}else{if(z<y){return false}}return((y-z)%A)==0}};m.pushArray=function(r,c,t,q,p,s){if(this.matchSelector(r,c,t,q,p,s)){this.found.push(r)}};m.pushUID=function(s,c,u,r,p,t){var q=this.getUID(s);if(!this.uniques[q]&&this.matchSelector(s,c,u,r,p,t)){this.uniques[q]=true;this.found.push(s)}};m.matchNode=function(p,q){if(this.isHTMLDocument&&this.nativeMatchesSelector){try{return this.nativeMatchesSelector.call(p,q.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(w){}}var v=this.Slick.parse(q);if(!v){return true}var t=v.expressions,u=0,s;for(s=0;(currentExpression=t[s]);s++){if(currentExpression.length==1){var r=currentExpression[0];if(this.matchSelector(p,(this.isXMLDocument)?r.tag:r.tag.toUpperCase(),r.id,r.classes,r.attributes,r.pseudos)){return true}u++}}if(u==v.length){return false}var c=this.search(this.document,v),x;for(s=0;x=c[s++];){if(x===p){return true}}return false};m.matchPseudo=function(s,c,r){var p="pseudo:"+c;if(this[p]){return this[p](s,r)}var q=this.getAttribute(s,c);return(r)?r==q:!!q};m.matchSelector=function(q,x,c,r,s,u){if(x){var v=(this.isXMLDocument)?q.nodeName:q.nodeName.toUpperCase();if(x=="*"){if(v<"@"){return false}}else{if(v!=x){return false}}}if(c&&q.getAttribute("id")!=c){return false}var t,p,w;if(r){for(t=r.length;t--;){w=q.getAttribute("class")||q.className;if(!(w&&r[t].regexp.test(w))){return false}}}if(s){for(t=s.length;t--;){p=s[t];if(p.operator?!p.test(this.getAttribute(q,p.key)):!this.hasAttribute(q,p.key)){return false}}}if(u){for(t=u.length;t--;){p=u[t];if(!this.matchPseudo(q,p.key,p.value)){return false}}}return true};var l={" ":function(s,y,p,t,u,w,r){var v,x,q;if(this.isHTMLDocument){getById:if(p){x=this.document.getElementById(p);if((!x&&s.all)||(this.idGetsName&&x&&x.getAttributeNode("id").nodeValue!=p)){q=s.all[p];if(!q){return}if(!q[0]){q=[q]}for(v=0;x=q[v++];){var c=x.getAttributeNode("id");if(c&&c.nodeValue==p){this.push(x,y,null,t,u,w);break}}return}if(!x){if(this.contains(this.root,s)){return}else{break getById}}else{if(this.document!==s&&!this.contains(s,x)){return}}this.push(x,y,null,t,u,w);return}getByClass:if(t&&s.getElementsByClassName&&!this.brokenGEBCN){q=s.getElementsByClassName(r.join(" "));if(!(q&&q.length)){break getByClass}for(v=0;x=q[v++];){this.push(x,y,p,null,u,w)}return}}getByTag:{q=s.getElementsByTagName(y);if(!(q&&q.length)){break getByTag}if(!this.brokenStarGEBTN){y=null}for(v=0;x=q[v++];){this.push(x,y,p,t,u,w)}}},">":function(r,c,t,q,p,s){if((r=r.firstChild)){do{if(r.nodeType==1){this.push(r,c,t,q,p,s)}}while((r=r.nextSibling))}},"+":function(r,c,t,q,p,s){while((r=r.nextSibling)){if(r.nodeType==1){this.push(r,c,t,q,p,s);break}}},"^":function(r,c,t,q,p,s){r=r.firstChild;if(r){if(r.nodeType==1){this.push(r,c,t,q,p,s)}else{this["combinator:+"](r,c,t,q,p,s)}}},"~":function(s,c,u,r,p,t){while((s=s.nextSibling)){if(s.nodeType!=1){continue}var q=this.getUID(s);if(this.bitUniques[q]){break}this.bitUniques[q]=true;this.push(s,c,u,r,p,t)}},"++":function(r,c,t,q,p,s){this["combinator:+"](r,c,t,q,p,s);this["combinator:!+"](r,c,t,q,p,s)},"~~":function(r,c,t,q,p,s){this["combinator:~"](r,c,t,q,p,s);this["combinator:!~"](r,c,t,q,p,s)},"!":function(r,c,t,q,p,s){while((r=r.parentNode)){if(r!==this.document){this.push(r,c,t,q,p,s)}}},"!>":function(r,c,t,q,p,s){r=r.parentNode;if(r!==this.document){this.push(r,c,t,q,p,s)}},"!+":function(r,c,t,q,p,s){while((r=r.previousSibling)){if(r.nodeType==1){this.push(r,c,t,q,p,s);break}}},"!^":function(r,c,t,q,p,s){r=r.lastChild;if(r){if(r.nodeType==1){this.push(r,c,t,q,p,s)}else{this["combinator:!+"](r,c,t,q,p,s)}}},"!~":function(s,c,u,r,p,t){while((s=s.previousSibling)){if(s.nodeType!=1){continue}var q=this.getUID(s);if(this.bitUniques[q]){break}this.bitUniques[q]=true;this.push(s,c,u,r,p,t)}}};for(var k in l){m["combinator:"+k]=l[k]}var n={empty:function(c){var p=c.firstChild;return !(p&&p.nodeType==1)&&!(c.innerText||c.textContent||"").length},not:function(c,p){return !this.matchNode(c,p)},contains:function(c,p){return(c.innerText||c.textContent||"").indexOf(p)>-1},"first-child":function(c){while((c=c.previousSibling)){if(c.nodeType==1){return false}}return true},"last-child":function(c){while((c=c.nextSibling)){if(c.nodeType==1){return false}}return true},"only-child":function(q){var p=q;while((p=p.previousSibling)){if(p.nodeType==1){return false}}var c=q;while((c=c.nextSibling)){if(c.nodeType==1){return false}}return true},"nth-child":m.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":m.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":m.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":m.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(p,c){return this["pseudo:nth-child"](p,""+c+1)},even:function(c){return this["pseudo:nth-child"](c,"2n")},odd:function(c){return this["pseudo:nth-child"](c,"2n+1")},"first-of-type":function(c){var p=c.nodeName;while((c=c.previousSibling)){if(c.nodeName==p){return false}}return true},"last-of-type":function(c){var p=c.nodeName;while((c=c.nextSibling)){if(c.nodeName==p){return false}}return true},"only-of-type":function(q){var p=q,r=q.nodeName;while((p=p.previousSibling)){if(p.nodeName==r){return false}}var c=q;while((c=c.nextSibling)){if(c.nodeName==r){return false}}return true},enabled:function(c){return !c.disabled},disabled:function(c){return c.disabled},checked:function(c){return c.checked||c.selected},focus:function(c){return this.isHTMLDocument&&this.document.activeElement===c&&(c.href||c.type||this.hasAttribute(c,"tabindex"))},root:function(c){return(c===this.root)},selected:function(c){return c.selected}};for(var b in n){m["pseudo:"+b]=n[b]}var a=m.attributeGetters={"class":function(){return this.getAttribute("class")||this.className},"for":function(){return("htmlFor" in this)?this.htmlFor:this.getAttribute("for")},href:function(){return("href" in this)?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return(this.style)?this.style.cssText:this.getAttribute("style")},tabindex:function(){var c=this.getAttributeNode("tabindex");return(c&&c.specified)?c.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var c=this.getAttributeNode("maxLength");return(c&&c.specified)?c.nodeValue:null}};a.MAXLENGTH=a.maxLength=a.maxlength;var f=m.Slick=(this.Slick||{});f.version="1.1.6";f.search=function(p,q,c){return m.search(p,q,c)};f.find=function(c,p){return m.search(c,p,null,true)};f.contains=function(c,p){m.setDocument(c);return m.contains(c,p)};f.getAttribute=function(p,c){m.setDocument(p);return m.getAttribute(p,c)};f.hasAttribute=function(p,c){m.setDocument(p);return m.hasAttribute(p,c)};f.match=function(p,c){if(!(p&&c)){return false}if(!c||c===p){return true}m.setDocument(p);return m.matchNode(p,c)};f.defineAttributeGetter=function(c,p){m.attributeGetters[c]=p;return this};f.lookupAttributeGetter=function(c){return m.attributeGetters[c]};f.definePseudo=function(c,p){m["pseudo:"+c]=function(r,q){return p.call(r,q)};return this};f.lookupPseudo=function(c){var p=m["pseudo:"+c];if(p){return function(q){return p.call(this,q)}}return null};f.override=function(p,c){m.override(p,c);return this};f.isXML=m.isXML;f.uidOf=function(c){return m.getUIDHTML(c)};if(!this.Slick){this.Slick=f}}).apply((typeof exports!="undefined")?exports:this);var Element=function(b,j){var k=Element.Constructors[b];if(k){return k(j)}if(typeof b!="string"){return document.id(b).set(j)}if(!j){j={}}if(!(/^[\w-]+$/).test(b)){var f=Slick.parse(b).expressions[0][0];b=(f.tag=="*")?"div":f.tag;if(f.id&&j.id==null){j.id=f.id}var d=f.attributes;if(d){for(var a,g=0,c=d.length;g<c;g++){a=d[g];if(j[a.key]!=null){continue}if(a.value!=null&&a.operator=="="){j[a.key]=a.value}else{if(!a.value&&!a.operator){j[a.key]=true}}}}if(f.classList&&j["class"]==null){j["class"]=f.classList.join(" ")}}return document.newElement(b,j)};if(Browser.Element){Element.prototype=Browser.Element.prototype}new Type("Element",Element).mirror(function(a){if(Array.prototype[a]){return}var b={};b[a]=function(){var k=[],f=arguments,m=true;for(var j=0,d=this.length;j<d;j++){var g=this[j],c=k[j]=g[a].apply(g,f);m=(m&&typeOf(c)=="element")}return(m)?new Elements(k):k};Elements.implement(b)});if(!Browser.Element){Element.parent=Object;Element.Prototype={"$family":Function.from("element").hide()};Element.mirror(function(a,b){Element.Prototype[a]=b})}Element.Constructors={};Element.Constructors=new Hash;var IFrame=new Type("IFrame",function(){var f=Array.link(arguments,{properties:Type.isObject,iframe:function(g){return(g!=null)}});var c=f.properties||{},b;if(f.iframe){b=document.id(f.iframe)}var d=c.onload||function(){};delete c.onload;c.id=c.name=[c.id,c.name,b?(b.id||b.name):"IFrame_"+String.uniqueID()].pick();b=new Element(b||"iframe",c);var a=function(){d.call(b.contentWindow)};if(window.frames[c.id]){a()}else{b.addListener("load",a)}return b});var Elements=this.Elements=function(a){if(a&&a.length){var f={},d;for(var c=0;d=a[c++];){var b=Slick.uidOf(d);if(!f[b]){f[b]=true;this.push(d)}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(a,b){if(!a){return this}return new Elements(Array.filter(this,(typeOf(a)=="string")?function(c){return c.match(a)}:a,b))}.protect(),push:function(){var d=this.length;for(var b=0,a=arguments.length;b<a;b++){var c=document.id(arguments[b]);if(c){this[d++]=c}}return(this.length=d)}.protect(),unshift:function(){var b=[];for(var c=0,a=arguments.length;c<a;c++){var d=document.id(arguments[c]);if(d){b.push(d)}}return Array.prototype.unshift.apply(this,b)}.protect(),concat:function(){var b=new Elements(this);for(var c=0,a=arguments.length;c<a;c++){var d=arguments[c];if(Type.isEnumerable(d)){b.append(d)}else{b.push(d)}}return b}.protect(),append:function(c){for(var b=0,a=c.length;b<a;b++){this.push(c[b])}return this}.protect(),empty:function(){while(this.length){delete this[--this.length]}return this}.protect()});Elements.alias("extend","append");(function(){var g=Array.prototype.splice,b={"0":0,"1":1,length:2};g.call(b,1,1);if(b[1]==1){Elements.implement("splice",function(){var j=this.length;var i=g.apply(this,arguments);while(j>=this.length){delete this[j--]}return i}.protect())}Elements.implement(Array.prototype);Array.mirror(Elements);var f;try{var a=document.createElement("<input name=x>");f=(a.name=="x")}catch(c){}var d=function(i){return(""+i).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(i,j){if(j&&j.checked!=null){j.defaultChecked=j.checked}if(f&&j){i="<"+i;if(j.name){i+=' name="'+d(j.name)+'"'}if(j.type){i+=' type="'+d(j.type)+'"'}i+=">";delete j.name;delete j.type}return this.id(this.createElement(i)).set(j)}})})();Document.implement({newTextNode:function(a){return this.createTextNode(a)},getDocument:function(){return this},getWindow:function(){return this.window},id:(function(){var a={string:function(d,c,b){d=Slick.find(b,"#"+d.replace(/(\W)/g,"\\$1"));return(d)?a.element(d,c):null},element:function(b,c){$uid(b);if(!c&&!b.$family&&!(/^(?:object|embed)$/i).test(b.tagName)){Object.append(b,Element.Prototype)}return b},object:function(c,d,b){if(c.toElement){return a.element(c.toElement(b),d)}return null}};a.textnode=a.whitespace=a.window=a.document=function(b){return b};return function(c,f,d){if(c&&c.$family&&c.uid){return c}var b=typeOf(c);return(a[b])?a[b](c,f,d||document):null}})()});if(window.$==null){Window.implement("$",function(a,b){return document.id(a,b,this.document)})}Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(a){return Slick.search(this,a,new Elements)},getElement:function(a){return document.id(Slick.find(this,a))}});var contains={contains:function(a){return Slick.contains(this,a)}};if(!document.contains){Document.implement(contains)}if(!document.createElement("div").contains){Element.implement(contains)}Element.implement("hasChild",function(a){return this!==a&&this.contains(a)});(function(b,d,a){this.Selectors={};var f=this.Selectors.Pseudo=new Hash();var c=function(){for(var g in f){if(f.hasOwnProperty(g)){Slick.definePseudo(g,f[g]);delete f[g]}}};Slick.search=function(i,j,g){c();return b.call(this,i,j,g)};Slick.find=function(g,i){c();return d.call(this,g,i)};Slick.match=function(i,g){c();return a.call(this,i,g)}})(Slick.search,Slick.find,Slick.match);var injectCombinator=function(d,c){if(!d){return c}d=Object.clone(Slick.parse(d));var b=d.expressions;for(var a=b.length;a--;){b[a][0].combinator=c}return d};Object.forEach({getNext:"~",getPrevious:"!~",getParent:"!"},function(a,b){Element.implement(b,function(c){return this.getElement(injectCombinator(c,a))})});Object.forEach({getAllNext:"~",getAllPrevious:"!~",getSiblings:"~~",getChildren:">",getParents:"!"},function(a,b){Element.implement(b,function(c){return this.getElements(injectCombinator(c,a))})});Element.implement({getFirst:function(a){return document.id(Slick.search(this,injectCombinator(a,">"))[0])},getLast:function(a){return document.id(Slick.search(this,injectCombinator(a,">")).getLast())},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(a){return document.id(Slick.find(this,"#"+(""+a).replace(/(\W)/g,"\\$1")))},match:function(a){return !a||Slick.match(this,a)}});if(window.$$==null){Window.implement("$$",function(a){var g=new Elements;if(arguments.length==1&&typeof a=="string"){return Slick.search(this.document,a,g)}var c=Array.flatten(arguments);for(var d=0,b=c.length;d<b;d++){var f=c[d];switch(typeOf(f)){case"element":g.push(f);break;case"string":Slick.search(this.document,f,g)}}return g})}if(window.$$==null){Window.implement("$$",function(a){if(arguments.length==1){if(typeof a=="string"){return Slick.search(this.document,a,new Elements)}else{if(Type.isEnumerable(a)){return new Elements(a)}}}return new Elements(arguments)})}(function(){var b={before:function(p,o){var q=o.parentNode;if(q){q.insertBefore(p,o)}},after:function(p,o){var q=o.parentNode;if(q){q.insertBefore(p,o.nextSibling)}},bottom:function(p,o){o.appendChild(p)},top:function(p,o){o.insertBefore(p,o.firstChild)}};b.inside=b.bottom;Object.each(b,function(p,q){q=q.capitalize();var o={};o["inject"+q]=function(r){p(this,document.id(r,true));return this};o["grab"+q]=function(r){p(document.id(r,true),this);return this};Element.implement(o)});var m={},d={};var k={};Array.forEach(["type","value","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","readOnly","rowSpan","tabIndex","useMap"],function(o){k[o.toLowerCase()]=o});Object.append(k,{html:"innerHTML",text:(function(){var o=document.createElement("div");return(o.textContent==null)?"innerText":"textContent"})()});Object.forEach(k,function(p,o){d[o]=function(q,r){q[p]=r};m[o]=function(q){return q[p]}});var a=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked","autofocus","controls","autoplay","loop"];var j={};Array.forEach(a,function(o){var p=o.toLowerCase();j[p]=o;d[p]=function(q,r){q[o]=!!r};m[p]=function(q){return !!q[o]}});Object.append(d,{"class":function(o,p){("className" in o)?o.className=p:o.setAttribute("class",p)},"for":function(o,p){("htmlFor" in o)?o.htmlFor=p:o.setAttribute("for",p)},style:function(o,p){(o.style)?o.style.cssText=p:o.setAttribute("style",p)}});Element.implement({setProperty:function(p,q){var o=p.toLowerCase();if(q==null){if(!j[o]){this.removeAttribute(p);return this}q=false}var r=d[o];if(r){r(this,q)}else{this.setAttribute(p,q)}return this},setProperties:function(o){for(var p in o){this.setProperty(p,o[p])}return this},getProperty:function(q){var p=m[q.toLowerCase()];if(p){return p(this)}var o=Slick.getAttribute(this,q);return(!o&&!Slick.hasAttribute(this,q))?null:o},getProperties:function(){var o=Array.from(arguments);return o.map(this.getProperty,this).associate(o)},removeProperty:function(o){return this.setProperty(o,null)},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},set:function(q,p){var o=Element.Properties[q];(o&&o.set)?o.set.call(this,p):this.setProperty(q,p)}.overloadSetter(),get:function(p){var o=Element.Properties[p];return(o&&o.get)?o.get.apply(this):this.getProperty(p)}.overloadGetter(),erase:function(p){var o=Element.Properties[p];(o&&o.erase)?o.erase.apply(this):this.removeProperty(p);return this},hasClass:function(o){return this.className.clean().contains(o," ")},addClass:function(o){if(!this.hasClass(o)){this.className=(this.className+" "+o).clean()}return this},removeClass:function(o){this.className=this.className.replace(new RegExp("(^|\\s)"+o+"(?:\\s|$)"),"$1");return this},toggleClass:function(o,p){if(p==null){p=!this.hasClass(o)}return(p)?this.addClass(o):this.removeClass(o)},adopt:function(){var r=this,o,t=Array.flatten(arguments),s=t.length;if(s>1){r=o=document.createDocumentFragment()}for(var q=0;q<s;q++){var p=document.id(t[q],true);if(p){r.appendChild(p)}}if(o){this.appendChild(o)}return this},appendText:function(p,o){return this.grab(this.getDocument().newTextNode(p),o)},grab:function(p,o){b[o||"bottom"](document.id(p,true),this);return this},inject:function(p,o){b[o||"bottom"](this,document.id(p,true));return this},replaces:function(o){o=document.id(o,true);o.parentNode.replaceChild(this,o);return this},wraps:function(p,o){p=document.id(p,true);return this.replaces(p).grab(p,o)},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(o){return o.selected}))},toQueryString:function(){var o=[];this.getElements("input, select, textarea").each(function(q){var p=q.type;if(!q.name||q.disabled||p=="submit"||p=="reset"||p=="file"||p=="image"){return}var r=(q.get("tag")=="select")?q.getSelected().map(function(s){return document.id(s).get("value")}):((p=="radio"||p=="checkbox")&&!q.checked)?null:q.get("value");Array.from(r).each(function(s){if(typeof s!="undefined"){o.push(encodeURIComponent(q.name)+"="+encodeURIComponent(s))}})});return o.join("&")}});var l={},f={};var c=function(o){return(f[o]||(f[o]={}))};var i=function(p){var o=p.uid;if(p.removeEvents){p.removeEvents()}if(p.clearAttributes){p.clearAttributes()}if(o!=null){delete l[o];delete f[o]}return p};var n={input:"checked",option:"selected",textarea:"value"};Element.implement({destroy:function(){var o=i(this).getElementsByTagName("*");Array.each(o,i);Element.dispose(this);return null},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this},clone:function(t,r){t=t!==false;var y=this.cloneNode(t),q=[y],s=[this],w;if(t){q.append(Array.from(y.getElementsByTagName("*")));s.append(Array.from(this.getElementsByTagName("*")))}for(w=q.length;w--;){var u=q[w],x=s[w];if(!r){u.removeAttribute("id")}if(u.clearAttributes){u.clearAttributes();u.mergeAttributes(x);u.removeAttribute("uid");if(u.options){var B=u.options,o=x.options;for(var v=B.length;v--;){B[v].selected=o[v].selected}}}var p=n[x.tagName.toLowerCase()];if(p&&x[p]){u[p]=x[p]}}if(Browser.ie){var z=y.getElementsByTagName("object"),A=this.getElementsByTagName("object");for(w=z.length;w--;){z[w].outerHTML=A[w].outerHTML}}return document.id(y)}});[Element,Window,Document].invoke("implement",{addListener:function(r,q){if(r=="unload"){var o=q,p=this;q=function(){p.removeListener("unload",q);o()}}else{l[$uid(this)]=this}if(this.addEventListener){this.addEventListener(r,q,!!arguments[2])}else{this.attachEvent("on"+r,q)}return this},removeListener:function(p,o){if(this.removeEventListener){this.removeEventListener(p,o,!!arguments[2])}else{this.detachEvent("on"+p,o)}return this},retrieve:function(p,o){var r=c($uid(this)),q=r[p];if(o!=null&&q==null){q=r[p]=o}return q!=null?q:null},store:function(p,o){var q=c($uid(this));q[p]=o;return this},eliminate:function(o){var p=c($uid(this));delete p[o];return this}});if(window.attachEvent&&!window.addEventListener){window.addListener("unload",function(){Object.each(l,i);if(window.CollectGarbage){CollectGarbage()}})}Element.Properties={};Element.Properties=new Hash;Element.Properties.style={set:function(o){this.style.cssText=o},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};Element.Properties.html=(function(){var u=Function.attempt(function(){var w=document.createElement("table");w.innerHTML="<tr><td></td></tr>"});var v=document.createElement("div");var q={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};q.thead=q.tfoot=q.tbody;v.innerHTML="<nav></nav>";var p=v.childNodes.length==1;if(!p){var s="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" "),r=document.createDocumentFragment(),o=s.length;while(o--){r.createElement(s[o])}r.appendChild(v)}var t={set:function(x){if(typeOf(x)=="array"){x=x.join("")}var y=(!u&&q[this.get("tag")]);if(!y&&!p){y=[0,"",""]}if(y){var z=v;z.innerHTML=y[1]+x+y[2];for(var w=y[0];w--;){z=z.firstChild}this.empty().adopt(z.childNodes)}else{this.innerHTML=x}}};t.erase=t.set;return t})();var g=document.createElement("form");g.innerHTML="<select><option>s</option></select>";if(g.firstChild.value!="s"){Element.Properties.value={set:function(t){var p=this.get("tag");if(p!="select"){return this.setProperty("value",t)}var q=this.getElements("option");for(var r=0;r<q.length;r++){var s=q[r],o=s.getAttributeNode("value"),u=(o&&o.specified)?s.value:s.get("text");if(u==t){return s.selected=true}}},get:function(){var q=this,p=q.get("tag");if(p!="select"&&p!="option"){return this.getProperty("value")}if(p=="select"&&!(q=q.getSelected()[0])){return""}var o=q.getAttributeNode("value");return(o&&o.specified)?q.value:q.get("text")}}}})();(function(){var b={};var a=this.DOMEvent=new Type("DOMEvent",function(c,i){if(!i){i=window}c=c||i.event;if(c.$extended){return c}this.event=c;this.$extended=true;this.shift=c.shiftKey;this.control=c.ctrlKey;this.alt=c.altKey;this.meta=c.metaKey;var k=this.type=c.type;var j=c.target||c.srcElement;while(j&&j.nodeType==3){j=j.parentNode}this.target=document.id(j);if(k.indexOf("key")==0){var d=this.code=(c.which||c.keyCode);this.key=b[d]||Object.keyOf(Event.Keys,d);if(k=="keydown"){if(d>111&&d<124){this.key="f"+(d-111)}else{if(d>95&&d<106){this.key=d-96}}}if(this.key==null){this.key=String.fromCharCode(d).toLowerCase()}}else{if(k=="click"||k=="dblclick"||k=="contextmenu"||k=="DOMMouseScroll"||k.indexOf("mouse")==0){var l=i.document;l=(!l.compatMode||l.compatMode=="CSS1Compat")?l.html:l.body;this.page={x:(c.pageX!=null)?c.pageX:c.clientX+l.scrollLeft,y:(c.pageY!=null)?c.pageY:c.clientY+l.scrollTop};this.client={x:(c.pageX!=null)?c.pageX-i.pageXOffset:c.clientX,y:(c.pageY!=null)?c.pageY-i.pageYOffset:c.clientY};if(k=="DOMMouseScroll"||k=="mousewheel"){this.wheel=(c.wheelDelta)?c.wheelDelta/120:-(c.detail||0)/3}this.rightClick=(c.which==3||c.button==2);if(k=="mouseover"||k=="mouseout"){var m=c.relatedTarget||c[(k=="mouseover"?"from":"to")+"Element"];while(m&&m.nodeType==3){m=m.parentNode}this.relatedTarget=document.id(m)}}else{if(k.indexOf("touch")==0||k.indexOf("gesture")==0){this.rotation=c.rotation;this.scale=c.scale;this.targetTouches=c.targetTouches;this.changedTouches=c.changedTouches;var g=this.touches=c.touches;if(g&&g[0]){var f=g[0];this.page={x:f.pageX,y:f.pageY};this.client={x:f.clientX,y:f.clientY}}}}}if(!this.client){this.client={}}if(!this.page){this.page={}}});a.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation()}else{this.event.cancelBubble=true}return this},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault()}else{this.event.returnValue=false}return this}});a.defineKey=function(d,c){b[d]=c;return this};a.defineKeys=a.defineKey.overloadSetter(true);a.defineKeys({"38":"up","40":"down","37":"left","39":"right","27":"esc","32":"space","8":"backspace","9":"tab","46":"delete","13":"enter"})})();var Event=DOMEvent;Event.Keys={};Event.Keys=new Hash(Event.Keys);(function(){Element.Properties.events={set:function(b){this.addEvents(b)}};[Element,Window,Document].invoke("implement",{addEvent:function(g,j){var k=this.retrieve("events",{});if(!k[g]){k[g]={keys:[],values:[]}}if(k[g].keys.contains(j)){return this}k[g].keys.push(j);var i=g,b=Element.Events[g],d=j,l=this;if(b){if(b.onAdd){b.onAdd.call(this,j,g)}if(b.condition){d=function(m){if(b.condition.call(this,m,g)){return j.call(this,m)}return true}}if(b.base){i=Function.from(b.base).call(this,g)}}var f=function(){return j.call(l)};var c=Element.NativeEvents[i];if(c){if(c==2){f=function(m){m=new DOMEvent(m,l.getWindow());if(d.call(l,m)===false){m.stop()}}}this.addListener(i,f,arguments[2])}k[g].values.push(f);return this},removeEvent:function(f,d){var c=this.retrieve("events");if(!c||!c[f]){return this}var j=c[f];var b=j.keys.indexOf(d);if(b==-1){return this}var i=j.values[b];delete j.keys[b];delete j.values[b];var g=Element.Events[f];if(g){if(g.onRemove){g.onRemove.call(this,d,f)}if(g.base){f=Function.from(g.base).call(this,f)}}return(Element.NativeEvents[f])?this.removeListener(f,i,arguments[2]):this},addEvents:function(b){for(var c in b){this.addEvent(c,b[c])}return this},removeEvents:function(b){var d;if(typeOf(b)=="object"){for(d in b){this.removeEvent(d,b[d])}return this}var c=this.retrieve("events");if(!c){return this}if(!b){for(d in c){this.removeEvents(d)}this.eliminate("events")}else{if(c[b]){c[b].keys.each(function(f){this.removeEvent(b,f)},this);delete c[b]}}return this},fireEvent:function(f,c,b){var d=this.retrieve("events");if(!d||!d[f]){return this}c=Array.from(c);d[f].keys.each(function(g){if(b){g.delay(b,this,c)}else{g.apply(this,c)}},this);return this},cloneEvents:function(f,d){f=document.id(f);var c=f.retrieve("events");if(!c){return this}if(!d){for(var b in c){this.cloneEvents(f,b)}}else{if(c[d]){c[d].keys.each(function(g){this.addEvent(d,g)},this)}}return this}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};var a=function(b){var c=b.relatedTarget;if(c==null){return true}if(!c){return false}return(c!=this&&c.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(c))};Element.Events={mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:(Browser.firefox)?"DOMMouseScroll":"mousewheel"}};if(!window.addEventListener){Element.NativeEvents.propertychange=2;Element.Events.change={base:function(){var b=this.type;return(this.get("tag")=="input"&&(b=="radio"||b=="checkbox"))?"propertychange":"change"},condition:function(b){return !!(this.type!="radio"||this.checked)}}}Element.Events=new Hash(Element.Events)})();(function(k,m){var n,g,f=[],c,b,d=m.createElement("div");var i=function(){clearTimeout(b);if(n){return}Browser.loaded=n=true;m.removeListener("DOMContentLoaded",i).removeListener("readystatechange",a);m.fireEvent("domready");k.fireEvent("domready")};var a=function(){for(var o=f.length;o--;){if(f[o]()){i();return true}}return false};var l=function(){clearTimeout(b);if(!a()){b=setTimeout(l,10)}};m.addListener("DOMContentLoaded",i);var j=function(){try{d.doScroll();return true}catch(o){}return false};if(d.doScroll&&!j()){f.push(j);c=true}if(m.readyState){f.push(function(){var o=m.readyState;return(o=="loaded"||o=="complete")})}if("onreadystatechange" in m){m.addListener("readystatechange",a)}else{c=true}if(c){l()}Element.Events.domready={onAdd:function(o){if(n){o.call(this)}}};Element.Events.load={base:"load",onAdd:function(o){if(g&&this==k){o.call(this)}},condition:function(){if(this==k){i();delete Element.Events.load}return true}};k.addEvent("load",function(){g=true})})(window,document);MooTools.More={version:"1.4.0.1",build:"a4244edf2aa97ac8a196fc96082dd35af1abab87"};var Asset={javascript:function(d,b){if(!b){b={}}var a=new Element("script",{src:d,type:"text/javascript"}),f=b.document||document,c=b.onload||b.onLoad;delete b.onload;delete b.onLoad;delete b.document;if(c){if(typeof a.onreadystatechange!="undefined"){a.addEvent("readystatechange",function(){if(["loaded","complete"].contains(this.readyState)){c.call(this)}})}else{a.addEvent("load",c)}}return a.set(b).inject(f.head)},css:function(d,a){if(!a){a={}}var b=new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:d});var c=a.onload||a.onLoad,f=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(c){b.addEvent("load",c)}return b.set(a).inject(f.head)},image:function(c,b){if(!b){b={}}var d=new Image(),a=document.id(d)||new Element("img");["load","abort","error"].each(function(f){var i="on"+f,g="on"+f.capitalize(),j=b[i]||b[g]||function(){};delete b[g];delete b[i];d[i]=function(){if(!d){return}if(!a.parentNode){a.width=d.width;a.height=d.height}d=d.onload=d.onabort=d.onerror=null;j.delay(1,a,a);a.fireEvent(f,a,1)}});d.src=a.src=c;if(d&&d.complete){d.onload.delay(1)}return a.set(b)},images:function(c,b){c=Array.from(c);var d=function(){},a=0;b=Object.merge({onComplete:d,onProgress:d,onError:d,properties:{}},b);return new Elements(c.map(function(g,f){return Asset.image(g,Object.append(b.properties,{onload:function(){a++;b.onProgress.call(this,a,f,g);if(a==c.length){b.onComplete()}},onerror:function(){a++;b.onError.call(this,a,f,g);if(a==c.length){b.onComplete()}}}))}))}};(function(){var a=this.Class=new Type("Class",function(j){if(instanceOf(j,Function)){j={initialize:j}}var i=function(){f(this);if(i.$prototyping){return this}this.$caller=null;var k=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return k}.extend(this).implement(j);i.$constructor=a;i.prototype.$constructor=i;i.prototype.parent=c;return i});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var i=this.$caller.$name,j=this.$caller.$owner.parent,k=(j)?j.prototype[i]:null;if(!k){throw new Error('The method "'+i+'" has no parent.')}return k.apply(this,arguments)};var f=function(i){for(var j in i){var l=i[j];switch(typeOf(l)){case"object":var k=function(){};k.prototype=l;i[j]=f(new k);break;case"array":i[j]=l.clone();break}}return i};var b=function(i,j,l){if(l.$origin){l=l.$origin}var k=function(){if(l.$protected&&this.$caller==null){throw new Error('The method "'+j+'" cannot be called.')}var n=this.caller,o=this.$caller;this.caller=o;this.$caller=k;var m=l.apply(this,arguments);this.$caller=o;this.caller=n;return m}.extend({$owner:i,$origin:l,$name:j});return k};var g=function(j,k,i){if(a.Mutators.hasOwnProperty(j)){k=a.Mutators[j].call(this,k);if(k==null){return this}}if(typeOf(k)=="function"){if(k.$hidden){return this}this.prototype[j]=(i)?k:b(this,j,k)}else{Object.merge(this.prototype,j,k)}return this};var d=function(i){i.$prototyping=true;var j=new i;delete i.$prototyping;return j};a.implement("implement",g.overloadSetter());a.Mutators={Extends:function(i){this.parent=i;this.prototype=d(i)},Implements:function(i){Array.from(i).each(function(l){var j=new l;for(var k in j){g.call(this,k,j[k],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);if(c==$empty){return this}this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true}return this},addEvents:function(b){for(var c in b){this.addEvent(c,b[c])}return this},fireEvent:function(f,c,b){f=a(f);var d=this.$events[f];if(!d){return this}c=Array.from(c);d.each(function(g){if(b){g.delay(b,this,c)}else{g.apply(this,c)}},this);return this},removeEvent:function(f,d){f=a(f);var c=this.$events[f];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b]}}return this},removeEvents:function(d){var f;if(typeOf(d)=="object"){for(f in d){this.removeEvent(f,d[f])}return this}if(d){d=a(d)}for(f in this.$events){if(d&&d!=f){continue}var c=this.$events[f];for(var b=c.length;b--;){if(b in c){this.removeEvent(f,c[b])}}}return this}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue}this.addEvent(c,b[c]);delete b[c]}}return this}})})();(function(){var a=this.Table=function(){this.length=0;var c=[],b=[];this.set=function(f,i){var d=c.indexOf(f);if(d==-1){var g=c.length;c[g]=f;b[g]=i;this.length++}else{b[d]=i}return this};this.get=function(f){var d=c.indexOf(f);return(d==-1)?null:b[d]};this.erase=function(f){var d=c.indexOf(f);if(d!=-1){this.length--;c.splice(d,1);return b.splice(d,1)[0]}return null};this.each=this.forEach=function(g,j){for(var f=0,d=this.length;f<d;f++){g.call(j,c[f],b[f],this)}}};if(this.Type){new Type("Table",a)}})();if(typeof JSON=="undefined"){this.JSON={}}JSON=new Hash({stringify:JSON.stringify,parse:JSON.parse});(function(){var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var escape=function(chr){return special[chr]||"\\u"+("0000"+chr.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(string){string=string.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(string)};JSON.encode=JSON.stringify?function(obj){return JSON.stringify(obj)}:function(obj){if(obj&&obj.toJSON){obj=obj.toJSON()}switch(typeOf(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+obj.map(JSON.encode).clean()+"]";case"object":case"hash":var string=[];Object.each(obj,function(value,key){var json=JSON.encode(value);if(json){string.push(JSON.encode(key)+":"+json)}});return"{"+string+"}";case"number":case"boolean":return""+obj;case"null":return"null"}return null};JSON.decode=function(string,secure){if(!string||typeOf(string)!="string"){return null}if(secure||JSON.secure){if(JSON.parse){return JSON.parse(string)}if(!JSON.validate(string)){throw new Error("JSON could not decode the input; security is enabled and the value is not secure.")}}return eval("("+string+")")}})();(function(){JSON.isSecure=function(a){return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"").replace(/'[^'\\\n\r]*'/g,""))};Element.implement({setData:function(a,b){return this.set("data-"+a.hyphenate(),b)},getData:function(b,a){var c=this.get("data-"+b.hyphenate());if(c!=undefined){return c}else{if(a!=undefined){this.setData(b,a);return a}}},setJSONData:function(a,b){return this.setData(a,JSON.encode(b))},getJSONData:function(c,b,a){var d=this.get("data-"+c);if(d!=undefined){if(d&&JSON.isSecure(d)){return JSON.decode(d,b)}else{return d}}else{if(a!=undefined){this.setJSONData(c,a);return a}}}})})();(function(){var a=/[^a-z0-9\-]/gi;window.BehaviorAPI=new Class({element:null,prefix:"",defaults:{},initialize:function(b,c){this.element=b;this.prefix=c.toLowerCase().replace(a,"")},get:function(){if(arguments.length>1){return this._getObj(Array.from(arguments))}return this._getValue(arguments[0])},getAs:function(){if(typeOf(arguments[0])=="object"){return this._getValuesAs.apply(this,arguments)}return this._getValueAs.apply(this,arguments)},require:function(){for(var b=0;b<arguments.length;b++){if(this._getValue(arguments[b])==undefined){throw new Error("Could not retrieve "+this.prefix+"-"+arguments[b]+" option from element.")}}return this},requireAs:function(c,b){var f;if(typeOf(arguments[0])=="object"){for(var d in arguments[0]){f=this._getValueAs(arguments[0][d],d);if(f===undefined||f===null){throw new Error("Could not retrieve "+this.prefix+"-"+d+" option from element.")}}}else{f=this._getValueAs(c,b);if(f===undefined||f===null){throw new Error("Could not retrieve "+this.prefix+"-"+b+" option from element.")}}return this},setDefault:function(c,f){if(typeOf(arguments[0])=="object"){for(var d in arguments[0]){this.setDefault(d,arguments[0][d])}return}c=c.camelCase();this.defaults[c]=f;if(this._getValue(c)==null){var b=this._getOptions();b[c]=f}return this},refreshAPI:function(){delete this.options;this.setDefault(this.defaults);return},_getObj:function(c){var b={};c.each(function(d){var f=this._getValue(d);if(f!==undefined){b[d]=f}},this);return b},_getOptions:function(){if(!this.options){var b=this.element.getData(this.prefix+"-options","{}");if(b&&b[0]!="{"){b="{"+b+"}"}var c=JSON.isSecure(b);if(!c){throw new Error("warning, options value for element is not parsable, check your JSON format for quotes, etc.")}this.options=c?JSON.decode(b):{};for(option in this.options){this.options[option.camelCase()]=this.options[option]}}return this.options},_getValue:function(c){c=c.camelCase();var b=this._getOptions();if(!b.hasOwnProperty(c)){var d=this.element.getData(this.prefix+"-"+c.hyphenate());if(d){b[c]=d}}return b[c]},_getValueAs:function(d,c,b){var f=this._getValue(c);if(f==null||f==undefined){return b}var g=this._coerceFromString(d,f);if(g==null){throw new Error("Could not retrieve value '"+c+"' as the specified type. Its value is: "+f)}return g},_getValuesAs:function(d){var c={};for(var b in d){c[b]=this._getValueAs(d[b],b)}return c},_coerceFromString:function(b,c){if(typeOf(c)=="string"&&b!=String){if(JSON.isSecure(c)){c=JSON.decode(c)}}if(instanceOf(c,b)){return c}return null}})})();(function(){var k=function(l){return function(){if(window.console&&console[l]){if(console[l].apply){console[l].apply(console,arguments)}else{console[l](Array.from(arguments).join(" "))}}}};var f=new Class({passMethod:function(m,l){if(this.API.prototype[m]){throw new Error("Cannot overwrite API method "+m+" as it already exists")}this.API.implement(m,l);return this},passMethods:function(l){for(method in l){this.passMethod(method,l[method])}return this}});var i=/\s*,\s*|\s+/g;BehaviorAPI.implement({deprecate:function(m,o){var n,l={};Object.each(m,function(r,p){var q=this.element[o?"getJSONData":"getData"](r);if(q!==undefined){n=true;l[p]=q}},this);this.setDefault(l);return this}});this.Behavior=new Class({Implements:[Options,Events,f],options:{onError:k("error"),onWarn:k("warn"),enableDeprecation:true,selector:"[data-behavior]"},initialize:function(l){this.setOptions(l);this.API=new Class({Extends:BehaviorAPI});this.passMethods({addEvent:this.addEvent.bind(this),removeEvent:this.removeEvent.bind(this),addEvents:this.addEvents.bind(this),removeEvents:this.removeEvents.bind(this),fireEvent:this.fireEvent.bind(this),applyFilters:this.apply.bind(this),applyFilter:this.applyFilter.bind(this),getContentElement:this.getContentElement.bind(this),cleanup:this.cleanup.bind(this),getContainerSize:function(){return this.getContentElement().measure(function(){return this.getSize()})}.bind(this),error:function(){this.fireEvent("error",arguments)}.bind(this),fail:function(){var m=Array.join(arguments," ");throw new Error(m)},warn:function(){this.fireEvent("warn",arguments)}.bind(this)})},getContentElement:function(){return this.options.container||document.body},apply:function(l,m){this._getElements(l).each(function(o){var n=[];o.getBehaviors().each(function(q){var r=this.getFilter(q);if(!r){this.fireEvent("error",["There is no filter registered with this name: ",q,o])}else{var p=r.config;if(p.delay!==undefined){this.applyFilter.delay(r.config.delay,this,[o,r,m])}else{if(p.delayUntil){this._delayFilterUntil(o,r,m)}else{if(p.initializer){this._customInit(o,r,m)}else{n.append(this.applyFilter(o,r,m,true))}}}}},this);n.each(function(p){p()})},this);return this},_getElements:function(l){if(typeOf(this.options.selector)=="function"){return this.options.selector(l)}else{return document.id(l).getElements(this.options.selector)}},_delayFilterUntil:function(l,m,o){var n=m.config.delayUntil;var p=function(r){l.removeEvent(n,p);var q=m.setup;m.setup=function(s,u,t){u.event=r;q.apply(m,[s,u,t])};this.applyFilter(l,m,o);m.setup=q}.bind(this);l.addEvent(n,p)},_customInit:function(l,n,o){var m=new this.API(l,n.name);m.runSetup=this.applyFilter.pass([l,n,o],this);n.config.initializer(l,m)},applyFilter:function(n,p,q,m,l){var o=[];if(this.options.breakOnErrors){o=this._applyFilter.apply(this,arguments)}else{try{o=this._applyFilter.apply(this,arguments)}catch(r){this.fireEvent("error",["Could not apply the behavior "+p.name,r])}}return m?o:this},_applyFilter:function(r,n,m,u,t){var q=[];r=document.id(r);var p=c(r);if(!p[n.name]||m){if(p[n.name]){p[n.name].cleanup(r)}var s=new this.API(r,n.name);s.markForCleanup=n.markForCleanup.bind(n);s.onCleanup=function(w){n.markForCleanup(r,w)};if(n.config.deprecated&&this.options.enableDeprecation){s.deprecate(n.config.deprecated)}if(n.config.deprecateAsJSON&&this.options.enableDeprecation){s.deprecate(n.config.deprecatedAsJSON,true)}if(n.config.requireAs){s.requireAs(n.config.requireAs)}else{if(n.config.require){s.require.apply(s,Array.from(n.config.require))}}if(n.config.defaults){s.setDefault(n.config.defaults)}var v=n.setup(r,s,t);if(n.config.returns&&!instanceOf(v,n.config.returns)){throw new Error("Filter "+n.name+" did not return a valid instance.")}r.store("Behavior Filter result:"+n.name,v);p[n.name]=n;var o=this.getPlugins(n.name);if(o){for(var l in o){if(u){q.push(this.applyFilter.pass([r,o[l],m,null,v],this))}else{this.applyFilter(r,o[l],m,null,v)}}}}return q},getFilter:function(l){return this._registered[l]||Behavior.getFilter(l)},getPlugins:function(l){return this._plugins[l]||Behavior._plugins[l]},cleanup:function(m,l){m=document.id(m);var o=c(m);for(var n in o){o[n].cleanup(m);m.eliminate("Behavior Filter result:"+n);delete o[n]}if(!l){this._getElements(m).each(this.cleanup,this)}return this}});Behavior.getLog=k;Behavior.PassMethods=f;var c=function(l){return l.retrieve("_appliedBehaviors",{})};var d=function(m,n,l){if(!this._registered[m]||l){this._registered[m]=new Behavior.Filter(m,n)}else{throw new Error('Could not add the Behavior filter "'+m+'" as a previous trigger by that same name exists.')}};var j=function(n,m){for(var l in n){d.apply(this,[l,n[l],m])}};var g=function(o,n,l,m){if(!this._plugins[o]){this._plugins[o]={}}if(!this._plugins[o][n]||m){this._plugins[o][n]=new Behavior.Filter(n,l)}else{throw new Error('Could not add the Behavior filter plugin "'+n+'" as a previous trigger by that same name exists.')}};var a=function(n,m){for(var l in n){g.apply(this,[n[l].fitlerName,n[l].name,n[l].setup],m)}};var b=function(l,n){var m=this.getFilter(l);Object.append(m.config.defaults,n)};Object.append(Behavior,{_registered:{},_plugins:{},addGlobalFilter:d,addGlobalFilters:j,addGlobalPlugin:g,addGlobalPlugins:a,setFilterDefaults:b,getFilter:function(l){return this._registered[l]}});Behavior.implement({_registered:{},_plugins:{},addFilter:d,addFilters:j,addPlugin:g,addPlugins:a,setFilterDefaults:b});Behavior.Filter=new Class({config:{},initialize:function(m,l){this.name=m;if(typeOf(l)=="function"){this.setup=l}else{Object.append(this.config,l);this.setup=this.config.setup}this._cleanupFunctions=new Table()},markForCleanup:function(l,m){var n=this._cleanupFunctions.get(l);if(!n){n=[]}n.include(m);this._cleanupFunctions.set(l,n);return this},cleanup:function(l){var m=this._cleanupFunctions.get(l);if(m){m.each(function(n){n()});this._cleanupFunctions.erase(l)}return this}});Behavior.elementDataProperty="behavior";Element.implement({addBehavior:function(l){return this.setData(Behavior.elementDataProperty,this.getBehaviors().include(l).join(" "))},removeBehavior:function(l){return this.setData(Behavior.elementDataProperty,this.getBehaviors().erase(l).join(" "))},getBehaviors:function(){var l=this.getData(Behavior.elementDataProperty);if(!l){return[]}return l.trim().split(i)},hasBehavior:function(l){return this.getBehaviors().contains(l)},getBehaviorResult:function(l){return this.retrieve("Behavior Filter result:"+l)}})})();(function(){var c=!!window.addEventListener;Element.NativeEvents.focusin=Element.NativeEvents.focusout=2;var m=function(n,o,p,q,r){while(r&&r!=n){if(o(r,q)){return p.call(r,q,r)}r=document.id(r.parentNode)}};var a={mouseenter:{base:"mouseover"},mouseleave:{base:"mouseout"},focus:{base:"focus"+(c?"":"in"),capture:true},blur:{base:c?"blur":"focusout",capture:true}};var b="$delegation:";var k=function(n){return{base:"focusin",remove:function(o,q){var r=o.retrieve(b+n+"listeners",{})[q];if(r&&r.forms){for(var p=r.forms.length;p--;){r.forms[p].removeEvent(n,r.fns[p])}}},listen:function(z,t,x,p,v,u){var q=(v.get("tag")=="form")?v:p.target.getParent("form");if(!q){return}var w=z.retrieve(b+n+"listeners",{}),r=w[u]||{forms:[],fns:[]},o=r.forms,y=r.fns;if(o.indexOf(q)!=-1){return}o.push(q);var s=function(A){m(z,t,x,A,v)};q.addEvent(n,s);y.push(s);w[u]=r;z.store(b+n+"listeners",w)}}};var d=function(n){return{base:"focusin",listen:function(o,p,r,s,t){var q={blur:function(){this.removeEvents(q)}};q[n]=function(u){m(o,p,r,u,t)};s.target.addEvents(q)}}};if(!c){Object.append(a,{submit:k("submit"),reset:k("reset"),change:d("change"),select:d("select")})}var j=Element.prototype,g=j.addEvent,l=j.removeEvent;var f=function(n,o){return function(t,s,p){if(t.indexOf(":relay")==-1){return n.call(this,t,s,p)}var q=Slick.parse(t).expressions[0][0];if(q.pseudos[0].key!="relay"){return n.call(this,t,s,p)}var r=q.tag;q.pseudos.slice(1).each(function(u){r+=":"+u.key+(u.value?"("+u.value+")":"")});n.call(this,t,s);return o.call(this,r,q.pseudos[0].value,s)}};var i={addEvent:function(x,s,z){var v=this.retrieve("$delegates",{}),t=v[x];if(t){for(var A in t){if(t[A].fn==z&&t[A].match==s){return this}}}var r=x,w=s,q=z,p=a[x]||{};x=p.base||r;s=function(D){return Slick.match(D,w)};var y=Element.Events[r];if(y&&y.condition){var n=s,o=y.condition;s=function(E,D){return n(E,D)&&o.call(E,D,x)}}var B=this,u=String.uniqueID();var C=p.listen?function(D,E){if(!E&&D&&D.target){E=D.target}if(E){p.listen(B,s,z,D,E,u)}}:function(D,E){if(!E&&D&&D.target){E=D.target}if(E){m(B,s,z,D,E)}};if(!t){t={}}t[u]={match:w,fn:q,delegator:C};v[r]=t;return g.call(this,x,C,p.capture)},removeEvent:function(u,p,v,w){var t=this.retrieve("$delegates",{}),r=t[u];if(!r){return this}if(w){var o=u,y=r[w].delegator,n=a[u]||{};u=n.base||o;if(n.remove){n.remove(this,w)}delete r[w];t[o]=r;return l.call(this,u,y)}var q,x;if(v){for(q in r){x=r[q];if(x.match==p&&x.fn==v){return i.removeEvent.call(this,u,p,v,q)}}}else{for(q in r){x=r[q];if(x.match==p){i.removeEvent.call(this,u,p,x.fn,q)}}}return this}};[Element,Window,Document].invoke("implement",{addEvent:f(g,i.addEvent),removeEvent:f(l,i.removeEvent)})})();(function(){Events.Pseudos=function(j,f,g){var d="_monitorEvents:";var c=function(k){return{store:k.store?function(l,m){k.store(d+l,m)}:function(l,m){(k._monitorEvents||(k._monitorEvents={}))[l]=m},retrieve:k.retrieve?function(l,m){return k.retrieve(d+l,m)}:function(l,m){if(!k._monitorEvents){return m}return k._monitorEvents[l]||m}}};var i=function(n){if(n.indexOf(":")==-1||!j){return null}var m=Slick.parse(n).expressions[0][0],r=m.pseudos,k=r.length,q=[];while(k--){var p=r[k].key,o=j[p];if(o!=null){q.push({event:m.tag,value:r[k].value,pseudo:p,original:n,listener:o})}}return q.length?q:null};return{addEvent:function(o,r,l){var p=i(o);if(!p){return f.call(this,o,r,l)}var m=c(this),t=m.retrieve(o,[]),k=p[0].event,n=Array.slice(arguments,2),q=r,s=this;p.each(function(u){var v=u.listener,w=q;if(v==false){k+=":"+u.pseudo+"("+u.value+")"}else{q=function(){v.call(s,u,w,arguments,q)}}});t.include({type:k,event:r,monitor:q});m.store(o,t);if(o!=k){f.apply(this,[o,r].concat(n))}return f.apply(this,[k,q].concat(n))},removeEvent:function(o,n){var m=i(o);if(!m){return g.call(this,o,n)}var p=c(this),l=p.retrieve(o);if(!l){return this}var k=Array.slice(arguments,2);g.apply(this,[o,n].concat(k));l.each(function(q,r){if(!n||q.event==n){g.apply(this,[q.type,q.monitor].concat(k))}delete l[r]},this);p.store(o,l);return this}}};var b={once:function(f,g,d,c){g.apply(this,d);this.removeEvent(f.event,c).removeEvent(f.original,g)},throttle:function(d,f,c){if(!f._throttled){f.apply(this,c);f._throttled=setTimeout(function(){f._throttled=false},d.value||250)}},pause:function(d,f,c){clearTimeout(f._pause);f._pause=f.delay(d.value||250,this,c)}};Events.definePseudo=function(c,d){b[c]=d;return this};Events.lookupPseudo=function(c){return b[c]};var a=Events.prototype;Events.implement(Events.Pseudos(b,a.addEvent,a.removeEvent));["Request","Fx"].each(function(c){if(this[c]){this[c].implement(Events.prototype)}})})();(function(){var d={relay:false},c=["once","throttle","pause"],b=c.length;while(b--){d[c[b]]=Events.lookupPseudo(c[b])}DOMEvent.definePseudo=function(f,g){d[f]=g;return this};var a=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(d,a.addEvent,a.removeEvent))})();(function(c,b,a){Event.Mock=function(g,d){var f=b.event;d=d||"click";if(document.createEvent){f=document.createEvent("HTMLEvents");f.initEvent(d,false,true)}f=new Event(f);f.target=g;return f}})(document.id,window);(function(){var a=/\s*,\s*|\s+/g;window.Delegator=new Class({Implements:[Options,Events,Behavior.PassMethods],options:{getBehavior:function(){},onError:Behavior.getLog("error"),onWarn:Behavior.getLog("warn")},initialize:function(b){this.setOptions(b);this._bound={eventHandler:this._eventHandler.bind(this)};Delegator._instances.push(this);Object.each(Delegator._triggers,function(c){this._eventTypes.combine(c.types)},this);this.API=new Class({Extends:BehaviorAPI});this.passMethods({addEvent:this.addEvent.bind(this),removeEvent:this.removeEvent.bind(this),addEvents:this.addEvents.bind(this),removeEvents:this.removeEvents.bind(this),fireEvent:this.fireEvent.bind(this),attach:this.attach.bind(this),trigger:this.trigger.bind(this),error:function(){this.fireEvent("error",arguments)}.bind(this),fail:function(){var c=Array.join(arguments," ");throw new Error(c)},warn:function(){this.fireEvent("warn",arguments)}.bind(this),getBehavior:function(){return this.options.getBehavior()}.bind(this)});this.bindToBehavior(this.options.getBehavior())},bindToBehavior:function(c){if(!c){return}this.unbindFromBehavior();this._behavior=c;if(!this._behaviorEvents){var b=this;this._behaviorEvents={destroyDom:function(d){Array.from(d).each(function(f){b._behavior.cleanup(f)})},ammendDom:function(d){b._behavior.apply(d)}}}this.addEvents(this._behaviorEvents)},getBehavior:function(){return this._behavior},unbindFromBehavior:function(){if(this._behaviorEvents&&this._behavior){this._behavior.removeEvents(this._behaviorEvents);delete this._behavior}},attach:function(c,b){b=b||"addEvent";c=document.id(c);if((b=="addEvent"&&this._attachedTo.contains(c))||(b=="removeEvent")&&!this._attachedTo.contains(c)){return this}this._eventTypes.each(function(d){c[b](d+":relay([data-trigger])",this._bound.eventHandler)},this);this._attachedTo.push(c);return this},detach:function(b){if(b){this.attach(b,"removeEvent");return this}else{this._attachedTo.each(this.detach,this)}},trigger:function(c,d,f){if(!f||typeOf(f)=="string"){f=new Event.Mock(d,f)}var b=this._getTrigger(c);if(b&&b.types.contains(f.type)){if(this.options.breakOnErrors){this._trigger(b,d,f)}else{try{this._trigger(b,d,f)}catch(g){this.fireEvent("error",["Could not apply the trigger",c,g])}}}else{this.fireEvent("error","Could not find a trigger with the name "+c+" for event: "+f.type)}return this},_getTrigger:function(b){return this._triggers[b]||Delegator._triggers[b]},_trigger:function(b,c,f){var d=new this.API(c,b.name);if(b.requireAs){d.requireAs(b.requireAs)}else{if(b.require){d.require.apply(d,Array.from(b.require))}}if(b.defaults){d.setDefault(b.defaults)}b.handler.apply(this,[f,c,d]);this.fireEvent("trigger",[b,c,f])},_eventHandler:function(c,d){var b=d.getTriggers();if(b.contains("Stop")){c.stop()}if(b.contains("PreventDefault")){c.preventDefault()}b.each(function(f){if(f!="Stop"&&f!="PreventDefault"){this.trigger(f,d,c)}},this)},_onRegister:function(b){b.each(function(c){if(!this._eventTypes.contains(c)){this._attachedTo.each(function(d){d.addEvent(c+":relay([data-trigger])",this._bound.eventHandler)},this)}this._eventTypes.include(c)},this)},_attachedTo:[],_eventTypes:[],_triggers:{}});Delegator._triggers={};Delegator._instances=[];Delegator._onRegister=function(b){this._instances.each(function(c){c._onRegister(b)})};Delegator.register=function(f,c,d,b){f=Array.from(f);if(typeOf(c)=="object"){var g=c;for(c in g){this.register.apply(this,[f,c,g[c],d])}return this}if(!this._triggers[c]||b){if(typeOf(d)=="function"){d={handler:d}}d.types=f;d.name=c;this._triggers[c]=d;this._onRegister(f)}else{throw new Error('Could add the trigger "'+c+'" as a previous trigger by that same name exists.')}return this};Delegator.implement("register",Delegator.register);Element.implement({addTrigger:function(b){return this.setData("trigger",this.getTriggers().include(b).join(" "))},removeTrigger:function(b){return this.setData("trigger",this.getTriggers().erase(b).join(" "))},getTriggers:function(){var b=this.getData("trigger");if(!b){return[]}return b.trim().split(a)},hasTrigger:function(b){return this.getTriggers().contains(b)}})})();Class.Mutators.Binds=function(a){if(!this.prototype.initialize){this.implement("initialize",function(){})}return Array.from(a).concat(this.prototype.Binds||[])};Class.Mutators.initialize=function(a){return function(){Array.from(this.Binds).each(function(b){var c=this[b];if(c){this[b]=c.bind(this)}},this);return a.apply(this,arguments)}};(function(){var g=document.html;Element.Properties.styles={set:function(k){this.setStyles(k)}};var j=(g.style.opacity!=null),a=(g.style.filter!=null),i=/alpha\(opacity=([\d.]+)\)/i;var b=function(l,k){l.store("$opacity",k);l.style.visibility=k>0?"visible":"hidden"};var d=(j?function(l,k){l.style.opacity=k}:(a?function(l,k){if(!l.currentStyle||!l.currentStyle.hasLayout){l.style.zoom=1}k=(k*100).limit(0,100).round();k=(k==100)?"":"alpha(opacity="+k+")";var m=l.style.filter||l.getComputedStyle("filter")||"";l.style.filter=i.test(m)?m.replace(i,k):m+k}:b));var f=(j?function(l){var k=l.style.opacity||l.getComputedStyle("opacity");return(k=="")?1:k.toFloat()}:(a?function(l){var m=(l.style.filter||l.getComputedStyle("filter")),k;if(m){k=m.match(i)}return(k==null||m==null)?1:(k[1]/100)}:function(l){var k=l.retrieve("$opacity");if(k==null){k=(l.style.visibility=="hidden"?0:1)}return k}));var c=(g.style.cssFloat==null)?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(m){if(this.currentStyle){return this.currentStyle[m.camelCase()]}var l=Element.getDocument(this).defaultView,k=l?l.getComputedStyle(this,null):null;return(k)?k.getPropertyValue((m==c)?"float":m.hyphenate()):null},setStyle:function(l,k){if(l=="opacity"){d(this,parseFloat(k));return this}l=(l=="float"?c:l).camelCase();if(typeOf(k)!="string"){var m=(Element.Styles[l]||"@").split(" ");k=Array.from(k).map(function(o,n){if(!m[n]){return""}return(typeOf(o)=="number")?m[n].replace("@",Math.round(o)):o}).join(" ")}else{if(k==String(Number(k))){k=Math.round(k)}}this.style[l]=k;return this},getStyle:function(q){if(q=="opacity"){return f(this)}q=(q=="float"?c:q).camelCase();var k=this.style[q];if(!k||q=="zIndex"){k=[];for(var p in Element.ShortStyles){if(q!=p){continue}for(var o in Element.ShortStyles[p]){k.push(this.getStyle(o))}return k.join(" ")}k=this.getComputedStyle(q)}if(k){k=String(k);var m=k.match(/rgba?\([\d\s,]+\)/);if(m){k=k.replace(m[0],m[0].rgbToHex())}}if(Browser.opera||(Browser.ie&&isNaN(parseFloat(k)))){if((/^(height|width)$/).test(q)){var l=(q=="width")?["left","right"]:["top","bottom"],n=0;l.each(function(r){n+=this.getStyle("border-"+r+"-width").toInt()+this.getStyle("padding-"+r).toInt()},this);return this["offset"+q.capitalize()]-n+"px"}if(Browser.opera&&String(k).indexOf("px")!=-1){return k}if((/^border(.+)Width|margin|padding/).test(q)){return"0px"}}return k},setStyles:function(l){for(var k in l){this.setStyle(k,l[k])}return this},getStyles:function(){var k={};Array.flatten(arguments).each(function(l){k[l]=this.getStyle(l)},this);return k}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};Element.implement({setOpacity:function(k){d(this,k);return this},getOpacity:function(){return f(this)}});Element.Properties.opacity={set:function(k){d(this,k);b(this,k)},get:function(){return f(this)}};Element.Styles=new Hash(Element.Styles);Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(q){var p=Element.ShortStyles;var l=Element.Styles;["margin","padding"].each(function(r){var s=r+q;p[r][s]=l[s]="@px"});var o="border"+q;p.border[o]=l[o]="@px @ rgb(@, @, @)";var n=o+"Width",k=o+"Style",m=o+"Color";p[o]={};p.borderWidth[n]=p[o][n]=l[n]="@px";p.borderStyle[k]=p[o][k]=l[k]="@";p.borderColor[m]=p[o][m]=l[m]="rgb(@, @, @)"})})();(function(){var j=document.createElement("div"),f=document.createElement("div");j.style.height="0";j.appendChild(f);var d=(f.offsetParent===j);j=f=null;var n=function(o){return m(o,"position")!="static"||a(o)};var k=function(o){return n(o)||(/^(?:table|td|th)$/i).test(o.tagName)};Element.implement({scrollTo:function(o,p){if(a(this)){this.getWindow().scrollTo(o,p)}else{this.scrollLeft=o;this.scrollTop=p}return this},getSize:function(){if(a(this)){return this.getWindow().getSize()}return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(a(this)){return this.getWindow().getScrollSize()}return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(a(this)){return this.getWindow().getScroll()}return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var p=this.parentNode,o={x:0,y:0};while(p&&!a(p)){o.x+=p.scrollLeft;o.y+=p.scrollTop;p=p.parentNode}return o},getOffsetParent:d?function(){var o=this;if(a(o)||m(o,"position")=="fixed"){return null}var p=(m(o,"position")=="static")?k:n;while((o=o.parentNode)){if(p(o)){return o}}return null}:function(){var o=this;if(a(o)||m(o,"position")=="fixed"){return null}try{return o.offsetParent}catch(p){}return null},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var t=this.getBoundingClientRect(),q=document.id(this.getDocument().documentElement),s=q.getScroll(),v=this.getScrolls(),u=(m(this,"position")=="fixed");return{x:t.left.toInt()+v.x+((u)?0:s.x)-q.clientLeft,y:t.top.toInt()+v.y+((u)?0:s.y)-q.clientTop}}var p=this,o={x:0,y:0};if(a(this)){return o}while(p&&!a(p)){o.x+=p.offsetLeft;o.y+=p.offsetTop;if(Browser.firefox){if(!c(p)){o.x+=b(p);o.y+=i(p)}var r=p.parentNode;if(r&&m(r,"overflow")!="visible"){o.x+=b(r);o.y+=i(r)}}else{if(p!=this&&Browser.safari){o.x+=b(p);o.y+=i(p)}}p=p.offsetParent}if(Browser.firefox&&!c(this)){o.x-=b(this);o.y-=i(this)}return o},getPosition:function(r){var s=this.getOffsets(),p=this.getScrolls();var o={x:s.x-p.x,y:s.y-p.y};if(r&&(r=document.id(r))){var q=r.getPosition();return{x:o.x-q.x-b(r),y:o.y-q.y-i(r)}}return o},getCoordinates:function(q){if(a(this)){return this.getWindow().getCoordinates()}var o=this.getPosition(q),p=this.getSize();var r={left:o.x,top:o.y,width:p.x,height:p.y};r.right=r.left+r.width;r.bottom=r.top+r.height;return r},computePosition:function(o){return{left:o.x-l(this,"margin-left"),top:o.y-l(this,"margin-top")}},setPosition:function(o){return this.setStyles(this.computePosition(o))}});[Document,Window].invoke("implement",{getSize:function(){var o=g(this);return{x:o.clientWidth,y:o.clientHeight}},getScroll:function(){var p=this.getWindow(),o=g(this);return{x:p.pageXOffset||o.scrollLeft,y:p.pageYOffset||o.scrollTop}},getScrollSize:function(){var q=g(this),p=this.getSize(),o=this.getDocument().body;return{x:Math.max(q.scrollWidth,o.scrollWidth,p.x),y:Math.max(q.scrollHeight,o.scrollHeight,p.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var o=this.getSize();return{top:0,left:0,bottom:o.y,right:o.x,height:o.y,width:o.x}}});var m=Element.getComputedStyle;function l(o,p){return m(o,p).toInt()||0}function c(o){return m(o,"-moz-box-sizing")=="border-box"}function i(o){return l(o,"border-top-width")}function b(o){return l(o,"border-left-width")}function a(o){return(/^(?:body|html)$/i).test(o.tagName)}function g(o){var p=o.getDocument();return(!p.compatMode||p.compatMode=="CSS1Compat")?p.html:p.body}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});(function(){var b=function(f,d){var g=[];Object.each(d,function(i){Object.each(i,function(j){f.each(function(k){g.push(k+"-"+j+(k=="border"?"-width":""))})})});return g};var c=function(g,f){var d=0;Object.each(f,function(j,i){if(i.test(g)){d=d+j.toInt()}});return d};var a=function(d){return !!(!d||d.offsetHeight||d.offsetWidth)};Element.implement({measure:function(j){if(a(this)){return j.call(this)}var i=this.getParent(),f=[];while(!a(i)&&i!=document.body){f.push(i.expose());i=i.getParent()}var g=this.expose(),d=j.call(this);g();f.each(function(k){k()});return d},expose:function(){if(this.getStyle("display")!="none"){return function(){}}var d=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=d}.bind(this)},getDimensions:function(d){d=Object.merge({computeSize:false},d);var j={x:0,y:0};var i=function(l,k){return(k.computeSize)?l.getComputedSize(k):l.getSize()};var f=this.getParent("body");if(f&&this.getStyle("display")=="none"){j=this.measure(function(){return i(this,d)})}else{if(f){try{j=i(this,d)}catch(g){}}}return Object.append(j,(j.x||j.x===0)?{width:j.x,height:j.y}:{x:j.width,y:j.height})},getComputedSize:function(d){if(d&&d.plains){d.planes=d.plains}d=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},d);var i={},f={width:0,height:0},g;if(d.mode=="vertical"){delete f.width;delete d.planes.width}else{if(d.mode=="horizontal"){delete f.height;delete d.planes.height}}b(d.styles,d.planes).each(function(j){i[j]=this.getStyle(j).toInt()},this);Object.each(d.planes,function(k,j){var m=j.capitalize(),l=this.getStyle(j);if(l=="auto"&&!g){g=this.getDimensions()}l=i[j]=(l=="auto")?g[j]:l.toInt();f["total"+m]=l;k.each(function(o){var n=c(o,i);f["computed"+o.capitalize()]=n;f["total"+m]+=n})},this);return Object.append(f,i)}})})();(function(b){var a=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(d,c){c=Object.merge({},a.options,c);a.setPositionOption(c);a.setEdgeOption(c);a.setOffsetOption(d,c);a.setDimensionsOption(d,c);return c},setPositionOption:function(c){c.position=a.getCoordinateFromValue(c.position)},setEdgeOption:function(d){var c=a.getCoordinateFromValue(d.edge);d.edge=c?c:(d.position.x=="center"&&d.position.y=="center")?{x:"center",y:"center"}:{x:"left",y:"top"}},setOffsetOption:function(g,d){var c={x:0,y:0},i=g.measure(function(){return document.id(this.getOffsetParent())}),f=i.getScroll();if(!i||i==g.getDocument().body){return}c=i.measure(function(){var k=this.getPosition();if(this.getStyle("position")=="fixed"){var j=window.getScroll();k.x+=j.x;k.y+=j.y}return k});d.offset={parentPositioned:i!=document.id(d.relativeTo),x:d.offset.x-c.x+f.x,y:d.offset.y-c.y+f.y}},setDimensionsOption:function(d,c){c.dimensions=d.getDimensions({computeSize:true,styles:["padding","border","margin"]})},getPosition:function(f,d){var c={};d=a.getOptions(f,d);var g=document.id(d.relativeTo)||document.body;a.setPositionCoordinates(d,c,g);if(d.edge){a.toEdge(c,d)}var i=d.offset;c.left=((c.x>=0||i.parentPositioned||d.allowNegative)?c.x:0).toInt();c.top=((c.y>=0||i.parentPositioned||d.allowNegative)?c.y:0).toInt();a.toMinMax(c,d);if(d.relFixedPosition||g.getStyle("position")=="fixed"){a.toRelFixedPosition(g,c)}if(d.ignoreScroll){a.toIgnoreScroll(g,c)}if(d.ignoreMargins){a.toIgnoreMargins(c,d)}c.left=Math.ceil(c.left);c.top=Math.ceil(c.top);delete c.x;delete c.y;return c},setPositionCoordinates:function(m,i,d){var g=m.offset.y,j=m.offset.x,f=(d==document.body)?window.getScroll():d.getPosition(),l=f.y,c=f.x,k=window.getSize();switch(m.position.x){case"left":i.x=c+j;break;case"right":i.x=c+j+d.offsetWidth;break;default:i.x=c+((d==document.body?k.x:d.offsetWidth)/2)+j;break}switch(m.position.y){case"top":i.y=l+g;break;case"bottom":i.y=l+g+d.offsetHeight;break;default:i.y=l+((d==document.body?k.y:d.offsetHeight)/2)+g;break}},toMinMax:function(c,d){var g={left:"x",top:"y"},f;["minimum","maximum"].each(function(i){["left","top"].each(function(j){f=d[i]?d[i][g[j]]:null;if(f!=null&&((i=="minimum")?c[j]<f:c[j]>f)){c[j]=f}})})},toRelFixedPosition:function(f,c){var d=window.getScroll();c.top+=d.y;c.left+=d.x},toIgnoreScroll:function(f,d){var c=f.getScroll();d.top-=c.y;d.left-=c.x},toIgnoreMargins:function(c,d){c.left+=d.edge.x=="right"?d.dimensions["margin-right"]:(d.edge.x!="center"?-d.dimensions["margin-left"]:-d.dimensions["margin-left"]+((d.dimensions["margin-right"]+d.dimensions["margin-left"])/2));c.top+=d.edge.y=="bottom"?d.dimensions["margin-bottom"]:(d.edge.y!="center"?-d.dimensions["margin-top"]:-d.dimensions["margin-top"]+((d.dimensions["margin-bottom"]+d.dimensions["margin-top"])/2))},toEdge:function(c,d){var f={},i=d.dimensions,g=d.edge;switch(g.x){case"left":f.x=0;break;case"right":f.x=-i.x-i.computedRight-i.computedLeft;break;default:f.x=-(Math.round(i.totalWidth/2));break}switch(g.y){case"top":f.y=0;break;case"bottom":f.y=-i.y-i.computedTop-i.computedBottom;break;default:f.y=-(Math.round(i.totalHeight/2));break}c.x+=f.x;c.y+=f.y},getCoordinateFromValue:function(c){if(typeOf(c)!="string"){return c}c=c.toLowerCase();return{x:c.test("left")?"left":(c.test("right")?"right":"center"),y:c.test(/upper|top/)?"top":(c.test("bottom")?"bottom":"center")}}};Element.implement({position:function(d){if(d&&(d.x!=null||d.y!=null)){return(b?b.apply(this,arguments):this)}var c=this.setStyle("position","absolute").calculatePosition(d);return(d&&d.returnPos)?c:this.setStyles(c)},calculatePosition:function(c){return a.getPosition(this,c)}})})(Element.prototype.position);Class.Occlude=new Class({occlude:function(c,b){b=document.id(b||this.element);var a=b.retrieve(c||this.property);if(a&&!this.occluded){return(this.occluded=a)}this.occluded=false;b.store(c||this.property,this);return this.occluded}});var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:(Browser.ie6||(Browser.firefox&&Browser.version<3&&Browser.Platform.mac))},property:"IframeShim",initialize:function(b,a){this.element=document.id(b);if(this.occlude()){return this.occluded}this.setOptions(a);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var c=this.element.getStyle("zIndex").toInt();if(!c){c=1;var b=this.element.getStyle("position");if(b=="static"||!b){this.element.setStyle("position","relative")}this.element.setStyle("zIndex",c)}c=((this.options.zIndex!=null||this.options.zIndex===0)&&c>this.options.zIndex)?this.options.zIndex:c-1;if(c<0){c=1}this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:c,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var a=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}).bind(this);if(!IframeShim.ready){window.addEvent("load",a)}else{a()}}else{this.position=this.hide=this.show=this.dispose=Function.from(this)}},position:function(){if(!IframeShim.ready||!this.shim){return this}var a=this.element.measure(function(){return this.getSize()});if(this.options.margin!=undefined){a.x=a.x-(this.options.margin*2);a.y=a.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.set({width:a.x,height:a.y}).position({relativeTo:this.element,offset:this.options.offset});return this},hide:function(){if(this.shim){this.shim.setStyle("display","none")}return this},show:function(){if(this.shim){this.shim.setStyle("display","block")}return this.position()},dispose:function(){if(this.shim){this.shim.dispose()}return this},destroy:function(){if(this.shim){this.shim.destroy()}return this}});window.addEvent("load",function(){IframeShim.ready=true});var Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},"class":"mask",maskMargins:false,useIframeShim:true,iframeShimOptions:{}},initialize:function(b,a){this.target=document.id(b)||document.id(document.body);this.target.store("mask",this);this.setOptions(a);this.render();this.inject()},render:function(){this.element=new Element("div",{"class":this.options["class"],id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(a){this.fireEvent("click",a);if(this.options.hideOnClick){this.hide()}}.bind(this)}});this.hidden=true},toElement:function(){return this.element},inject:function(b,a){a=a||(this.options.inject?this.options.inject.where:"")||this.target==document.body?"inside":"after";b=b||(this.options.inject&&this.options.inject.target)||this.target;this.element.inject(b,a);if(this.options.useIframeShim){this.shim=new IframeShim(this.element,this.options.iframeShimOptions);this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)})}},position:function(){this.resize(this.options.width,this.options.height);this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body});return this},resize:function(a,f){var b={styles:["padding","border"]};if(this.options.maskMargins){b.styles.push("margin")}var d=this.target.getComputedSize(b);if(this.target==document.body){this.element.setStyles({width:0,height:0});var c=window.getScrollSize();if(d.totalHeight<c.y){d.totalHeight=c.y}if(d.totalWidth<c.x){d.totalWidth=c.x}}this.element.setStyles({width:Array.pick([a,d.totalWidth,d.x]),height:Array.pick([f,d.totalHeight,d.y])});return this},show:function(){if(!this.hidden){return this}window.addEvent("resize",this.position);this.position();this.showMask.apply(this,arguments);return this},showMask:function(){this.element.setStyle("display","block");this.hidden=false;this.fireEvent("show")},hide:function(){if(this.hidden){return this}window.removeEvent("resize",this.position);this.hideMask.apply(this,arguments);if(this.options.destroyOnHide){return this.destroy()}return this},hideMask:function(){this.element.setStyle("display","none");this.hidden=true;this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");this.target.eliminate("mask")}});Element.Properties.mask={set:function(b){var a=this.retrieve("mask");if(a){a.destroy()}return this.eliminate("mask").store("mask:options",b)},get:function(){var a=this.retrieve("mask");if(!a){a=new Mask(this,this.retrieve("mask:options"));this.store("mask",a)}return a}};Element.implement({mask:function(a){if(a){this.set("mask",a)}this.get("mask").show();return this},unmask:function(){this.get("mask").hide();return this}});(function(){var a={};["add","remove","toggle"].each(function(b){a[b+"Class"]={require:["class"],handler:function(f,d,c){var g=d;if(c.get("target")){g=d.getElement(c.get("target"));if(!g){c.fail("could not locate target element to "+b+" its class",d)}}g[b+"Class"](c.get("class"))}}});Delegator.register("click",a)})();(function(){var g=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:60,unit:false,duration:500,frames:null,frameSkip:true,link:"ignore"},initialize:function(i){this.subject=this.subject||this;this.setOptions(i)},getTransition:function(){return function(i){return -(Math.cos(Math.PI*i)-1)/2}},step:function(i){if(this.options.frameSkip){var j=(this.time!=null)?(i-this.time):0,k=j/this.frameInterval;this.time=i;this.frame+=k}else{this.frame++}if(this.frame<this.frames){var l=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,l))}else{this.frame=this.frames;this.set(this.compute(this.from,this.to,1));this.stop()}},set:function(i){return i},compute:function(k,j,i){return g.compute(k,j,i)},check:function(){if(!this.isRunning()){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},start:function(m,l){if(!this.check(m,l)){return this}this.from=m;this.to=l;this.frame=(this.options.frameSkip)?0:-1;this.time=null;this.transition=this.getTransition();var k=this.options.frames,j=this.options.fps,i=this.options.duration;this.duration=g.Durations[i]||i.toInt();this.frameInterval=1000/j;this.frames=k||Math.round(this.duration/this.frameInterval);this.fireEvent("start",this.subject);b.call(this,j);return this},stop:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);if(this.frames==this.frame){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject)}}else{this.fireEvent("stop",this.subject)}}return this},cancel:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);this.frame=this.frames;this.fireEvent("cancel",this.subject).clearChain()}return this},pause:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps)}return this},resume:function(){if((this.frame<this.frames)&&!this.isRunning()){b.call(this,this.options.fps)}return this},isRunning:function(){var i=f[this.options.fps];return i&&i.contains(this)}});g.compute=function(k,j,i){return(j-k)*i+k};g.Durations={"short":250,normal:500,"long":1000};var f={},c={};var a=function(){var k=Date.now();for(var l=this.length;l--;){var j=this[l];if(j){j.step(k)}}};var b=function(j){var i=f[j]||(f[j]=[]);i.push(this);if(!c[j]){c[j]=a.periodical(Math.round(1000/j),i)}};var d=function(j){var i=f[j];if(i){i.erase(this);if(!i.length&&c[j]){delete f[j];c[j]=clearInterval(c[j])}}}})();Fx.CSS=new Class({Extends:Fx,prepare:function(c,d,b){b=Array.from(b);if(b[1]==null){b[1]=b[0];b[0]=c.getStyle(d)}var a=b.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=Function.from(a)();a=(typeof a=="string")?a.split(" "):Array.from(a);return a.map(function(c){c=String(c);var b=false;Object.each(Fx.CSS.Parsers,function(g,f){if(b){return}var d=g.parse(c);if(d||d===0){b={value:d,parser:g}}});b=b||{value:c,parser:Fx.CSS.Parsers.String};return b})},compute:function(d,c,b){var a=[];(Math.min(d.length,c.length)).times(function(f){a.push({value:d[f].parser.compute(d[f].value,c[f].value,b),parser:d[f].parser})});a.$family=Function.from("fx:css:value");return a},serve:function(c,b){if(typeOf(c)!="fx:css:value"){c=this.parse(c)}var a=[];c.each(function(d){a=a.concat(d.parser.serve(d.value,b))});return a},render:function(a,d,c,b){a.setStyle(d,this.serve(c,b))},search:function(a){if(Fx.CSS.Cache[a]){return Fx.CSS.Cache[a]}var c={},b=new RegExp("^"+a.escapeRegExp()+"$");Array.each(document.styleSheets,function(g,f){var d=g.href;if(d&&d.contains("://")&&!d.contains(document.domain)){return}var i=g.rules||g.cssRules;Array.each(i,function(l,j){if(!l.style){return}var k=(l.selectorText)?l.selectorText.replace(/^\w+/,function(n){return n.toLowerCase()}):null;if(!k||!b.test(k)){return}Object.each(Element.Styles,function(n,m){if(!l.style[m]||Element.ShortStyles[m]){return}n=String(l.style[m]);c[m]=((/^rgb/).test(n))?n.rgbToHex():n})})});return Fx.CSS.Cache[a]=c}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(a){if(a.match(/^#[0-9a-f]{3,6}$/i)){return a.hexToRgb(true)}return((a=a.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[a[1],a[2],a[3]]:false},compute:function(c,b,a){return c.map(function(f,d){return Math.round(Fx.compute(c[d],b[d],a))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(b,a){return(a)?b+a:b}},String:{parse:Function.from(false),compute:function(b,a){return a},serve:function(a){return a}}};Fx.CSS.Parsers=new Hash(Fx.CSS.Parsers);Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(b,a){this.elements=this.subject=$$(b);this.parent(a)},compute:function(j,k,l){var c={};for(var d in j){var a=j[d],f=k[d],g=c[d]={};for(var b in a){g[b]=this.parent(a[b],f[b],l)}}return c},set:function(b){for(var c in b){if(!this.elements[c]){continue}var a=b[c];for(var d in a){this.render(this.elements[c],d,a[d],this.options.unit)}}return this},start:function(c){if(!this.check(c)){return this}var k={},l={};for(var d in c){if(!this.elements[d]){continue}var g=c[d],a=k[d]={},j=l[d]={};for(var b in g){var f=this.prepare(this.elements[d],b,g[b]);a[b]=f.from;j[b]=f.to}}return this.parent(k,l)}});Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:false,fixedWidth:false,display:0,show:false,height:true,width:false,opacity:true,alwaysHide:false,trigger:"click",initialDisplayFx:true,resetHeight:true},initialize:function(){var j=function(i){return i!=null};var g=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:j,elements:j});this.parent(g.elements,g.options);var b=this.options,f=this.togglers=$$(g.togglers);this.previous=-1;this.internalChain=new Chain();if(b.alwaysHide){this.options.link="chain"}if(b.show||this.options.show===0){b.display=false;this.previous=b.show}if(b.start){b.display=false;b.show=false}var d=this.effects={};if(b.opacity){d.opacity="fullOpacity"}if(b.width){d.width=b.fixedWidth?"fullWidth":"offsetWidth"}if(b.height){d.height=b.fixedHeight?"fullHeight":"scrollHeight"}for(var c=0,a=f.length;c<a;c++){this.addSection(f[c],this.elements[c])}this.elements.each(function(l,k){if(b.show===k){this.fireEvent("active",[f[k],l])}else{for(var m in d){l.setStyle(m,0)}}},this);if(b.display||b.display===0||b.initialDisplayFx===false){this.display(b.display,b.initialDisplayFx)}if(b.fixedHeight!==false){b.resetHeight=false}this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(i,d){i=document.id(i);d=document.id(d);this.togglers.include(i);this.elements.include(d);var g=this.togglers,c=this.options,j=g.contains(i),a=g.indexOf(i),b=this.display.pass(a,this);i.store("accordion:display",b).addEvent(c.trigger,b);if(c.height){d.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"})}if(c.width){d.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"})}d.fullOpacity=1;if(c.fixedWidth){d.fullWidth=c.fixedWidth}if(c.fixedHeight){d.fullHeight=c.fixedHeight}d.setStyle("overflow","hidden");if(!j){for(var f in this.effects){d.setStyle(f,0)}}return this},removeSection:function(g,b){var f=this.togglers,a=f.indexOf(g),c=this.elements[a];var d=function(){f.erase(g);this.elements.erase(c);this.detach(g)}.bind(this);if(this.now==a||b!=null){this.display(b!=null?b:(a-1>=0?a-1:0)).chain(d)}else{d()}return this},detach:function(b){var a=function(c){c.removeEvent(this.options.trigger,c.retrieve("accordion:display"))}.bind(this);if(!b){this.togglers.each(a)}else{a(b)}return this},display:function(b,c){if(!this.check(b,c)){return this}var j={},i=this.elements,a=this.options,g=this.effects;if(c==null){c=true}if(typeOf(b)=="element"){b=i.indexOf(b)}if(b==this.previous&&!a.alwaysHide){return this}if(a.resetHeight){var f=i[this.previous];if(f&&!this.selfHidden){for(var d in g){f.setStyle(d,f[g[d]])}}}if((this.timer&&a.link=="chain")||(b===this.previous&&!a.alwaysHide)){return this}this.previous=b;this.selfHidden=false;i.each(function(m,l){j[l]={};var k;if(l!=b){k=true}else{if(a.alwaysHide&&((m.offsetHeight>0&&a.height)||m.offsetWidth>0&&a.width)){k=true;this.selfHidden=true}}this.fireEvent(k?"background":"active",[this.togglers[l],m]);for(var n in g){j[l][n]=k?0:m[g[n]]}if(!c&&!k&&a.resetHeight){j[l].height="auto"}},this);this.internalChain.clearChain();this.internalChain.chain(function(){if(a.resetHeight&&!this.selfHidden){var k=i[b];if(k){k.setStyle("height","auto")}}}.bind(this));return c?this.start(j):this.set(j).internalChain.callChain()}});var Accordion=new Class({Extends:Fx.Accordion,initialize:function(){this.parent.apply(this,arguments);var a=Array.link(arguments,{container:Type.isElement});this.container=a.container},addSection:function(c,b,f){c=document.id(c);b=document.id(b);var d=this.togglers.contains(c);var a=this.togglers.length;if(a&&(!d||f)){f=f!=null?f:a-1;c.inject(this.togglers[f],"before");b.inject(c,"after")}else{if(this.container&&!d){c.inject(this.container);b.inject(this.container)}}return this.parent.apply(this,arguments)}});(function(){var b=function(c){return c!=null};var a=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(f,g){if(typeof g=="string"){g=g.split(".")}for(var d=0,c=g.length;d<c;d++){if(a.call(f,g[d])){f=f[g[d]]}else{return null}}return f},cleanValues:function(c,f){f=f||b;for(var d in c){if(!f(c[d])){delete c[d]}}return c},erase:function(c,d){if(a.call(c,d)){delete c[d]}return c},run:function(d){var c=Array.slice(arguments,1);for(var f in d){if(d[f].apply){d[f].apply(d,c)}}return d}})})();Behavior.addGlobalFilter("Accordion",{deprecated:{headers:"toggler-elements",sections:"section-elements"},defaults:{display:0,height:true,width:false,opacity:true,alwaysHide:false,trigger:"click",initialDisplayFx:true,resetHeight:true,headers:".header",sections:".section"},setup:function(c,d){var b=Object.cleanValues(d.getAs({fixedHeight:Number,fixedWidth:Number,display:Number,show:Number,height:Boolean,width:Boolean,opacity:Boolean,alwaysHide:Boolean,trigger:String,initialDisplayFx:Boolean,resetHeight:Boolean}));var a=new Fx.Accordion(c.getElements(d.get("headers")),c.getElements(d.get("sections")),b);d.onCleanup(a.detach.bind(a));return a}});Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(b,a){if(arguments.length==1){a=b;b=this.property||this.options.property}this.render(this.element,b,a,this.options.unit);return this},start:function(c,f,d){if(!this.check(c,f,d)){return this}var b=Array.flatten(arguments);this.property=this.options.property||b.shift();var a=this.prepare(this.element,this.property,b);return this.parent(a.from,a.to)}});Element.Properties.tween={set:function(a){this.get("tween").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("tween");if(!a){a=new Fx.Tween(this,{link:"cancel"});this.store("tween",a)}return a}};Element.implement({tween:function(a,c,b){this.get("tween").start(a,c,b);return this},fade:function(c){var d=this.get("tween"),g,f,a;if(c==null){c="toggle"}switch(c){case"in":g="start";f=1;break;case"out":g="start";f=0;break;case"show":g="set";f=1;break;case"hide":g="set";f=0;break;case"toggle":var b=this.retrieve("fade:flag",this.getStyle("opacity")==1);g="start";f=b?0:1;this.store("fade:flag",!b);a=true;break;default:g="start";f=c}if(!a){this.eliminate("fade:flag")}d[g]("opacity",f);if(g=="set"||f!=0){this.setStyle("visibility",f==0?"hidden":"visible")}else{d.chain(function(){this.element.setStyle("visibility","hidden")})}return this},highlight:function(c,a){if(!a){a=this.retrieve("highlight:original",this.getStyle("background-color"));a=(a=="transparent")?"#fff":a}var b=this.get("tween");b.start("background-color",c||"#ffff88",a).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));b.callChain()}.bind(this));return this}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(a){if(typeof a=="string"){a=this.search(a)}for(var b in a){this.render(this.element,b,a[b],this.options.unit)}return this},compute:function(f,d,c){var a={};for(var b in f){a[b]=this.parent(f[b],d[b],c)}return a},start:function(b){if(!this.check(b)){return this}if(typeof b=="string"){b=this.search(b)}var f={},d={};for(var c in b){var a=this.prepare(this.element,c,b[c]);f[c]=a.from;d[c]=a.to}return this.parent(f,d)}});Element.Properties.morph={set:function(a){this.get("morph").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("morph");if(!a){a=new Fx.Morph(this,{link:"cancel"});this.store("morph",a)}return a}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});Element.implement({isDisplayed:function(){return this.getStyle("display")!="none"},isVisible:function(){var a=this.offsetWidth,b=this.offsetHeight;return(a==0&&b==0)?false:(a>0&&b>0)?true:this.style.display!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var b;try{b=this.getStyle("display")}catch(a){}if(b=="none"){return this}return this.store("element:_originalDisplay",b||"").setStyle("display","none")},show:function(a){if(!a&&this.isDisplayed()){return this}a=a||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",(a=="none")?"block":a)},swapClass:function(a,b){return this.removeClass(a).addClass(b)}});Document.implement({clearSelection:function(){if(window.getSelection){var a=window.getSelection();if(a&&a.removeAllRanges){a.removeAllRanges()}}else{if(document.selection&&document.selection.empty){try{document.selection.empty()}catch(b){}}}}});var TabSwapper=new Class({Implements:[Options,Events],options:{selectedClass:"tabSelected",mouseoverClass:"tabOver",deselectedClass:"",rearrangeDOM:true,effectOptions:{duration:500},cookieDays:999},tabs:[],sections:[],clickers:[],sectionFx:[],initialize:function(a){this.setOptions(a);var b=this.setup();if(b){return b}if(this.options.initPanel!=null){this.show(this.options.initPanel)}else{if(this.options.cookieName&&this.recall()){this.show(this.recall().toInt())}else{this.show(0)}}},setup:function(){var c=this.options,d=$$(c.sections),b=$$(c.tabs);if(b[0]&&b[0].retrieve("tabSwapper")){return b[0].retrieve("tabSwapper")}var a=$$(c.clickers);b.each(function(g,f){this.addTab(g,d[f],a[f],f)},this)},addTab:function(c,d,a,b){c=document.id(c);a=document.id(a);d=document.id(d);if(this.tabs.indexOf(c)>=0&&c.retrieve("tabbered")&&this.tabs.indexOf(c)!=b&&this.options.rearrangeDOM){this.moveTab(this.tabs.indexOf(c),b);return this}if(b==null){b=this.tabs.length}if(b>0&&this.tabs[b-1]&&this.options.rearrangeDOM){c.inject(this.tabs[b-1],"after");d.inject(this.tabs[b-1].retrieve("section"),"after")}this.tabs.splice(b,0,c);a=a||c;c.addEvents({mouseout:function(){c.removeClass(this.options.mouseoverClass)}.bind(this),mouseover:function(){c.addClass(this.options.mouseoverClass)}.bind(this)});a.addEvent("click",function(f){f.preventDefault();this.show(b)}.bind(this));c.store("tabbered",true);c.store("section",d);c.store("clicker",a);this.hideSection(b);return this},removeTab:function(b){var a=this.tabs[this.now];if(this.now==b){if(b>0){this.show(b-1)}else{if(b<this.tabs.length){this.show(b+1)}}}this.now=this.tabs.indexOf(a);return this},moveTab:function(j,i){var c=this.tabs[j];var b=c.retrieve("clicker");var f=c.retrieve("section");var a=this.tabs[i];var g=a.retrieve("clicker");var d=a.retrieve("section");this.tabs.erase(c).splice(i,0,c);c.inject(a,"before");b.inject(g,"before");f.inject(d,"before");return this},show:function(a){if(this.now==null){this.tabs.each(function(c,b){if(a!=b){this.hideSection(b)}},this)}this.showSection(a).save(a);return this},save:function(a){if(this.options.cookieName){Cookie.write(this.options.cookieName,a,{duration:this.options.cookieDays})}return this},recall:function(){return(this.options.cookieName)?Cookie.read(this.options.cookieName):false},hideSection:function(a){var c=this.tabs[a];if(!c){return this}var b=c.retrieve("section");if(!b){return this}if(b.getStyle("display")!="none"){this.lastHeight=b.getSize().y;b.setStyle("display","none");c.swapClass(this.options.selectedClass,this.options.deselectedClass);this.fireEvent("onBackground",[a,b,c])}return this},showSection:function(g){var b=this.tabs[g];if(!b){return this}var d=b.retrieve("section");if(!d){return this}var i=this.options.smooth&&!Browser.ie;if(this.now!=g){if(!b.retrieve("tabFx")){b.store("tabFx",new Fx.Morph(d,this.options.effectOptions))}var c=d.getStyle("overflow");var a={display:"block",overflow:"hidden"};if(i){a.opacity=0}var j=false;if(i){j={opacity:1}}else{if(d.getStyle("opacity").toInt()<1){d.setStyle("opacity",1);if(!this.options.smoothSize){this.fireEvent("onActiveAfterFx",[g,d,b])}}}if(this.options.smoothSize){var k=d.getDimensions().height;if(this.options.maxSize!=null&&this.options.maxSize<k){k=this.options.maxSize}if(!j){j={}}j.height=k}if(this.now!=null){this.hideSection(this.now)}if(this.options.smoothSize&&this.lastHeight){a.height=this.lastHeight}d.setStyles(a);var f=function(){this.fireEvent("onActiveAfterFx",[g,d,b]);d.setStyles({height:this.options.maxSize==j.height?this.options.maxSize:"auto",overflow:c});d.getElements("input, textarea").setStyle("opacity",1)}.bind(this);if(j){b.retrieve("tabFx").start(j).chain(f)}else{f()}this.now=g;this.fireEvent("onActive",[g,d,b])}b.swapClass(this.options.deselectedClass,this.options.selectedClass);return this}});String.implement({parseQueryString:function(d,a){if(d==null){d=true}if(a==null){a=true}var c=this.split(/[&;]/),b={};if(!c.length){return b}c.each(function(k){var f=k.indexOf("=")+1,i=f?k.substr(f):"",g=f?k.substr(0,f-1).match(/([^\]\[]+|(\B)(?=\]))/g):[k],j=b;if(!g){return}if(a){i=decodeURIComponent(i)}g.each(function(m,l){if(d){m=decodeURIComponent(m)}var n=j[m];if(l<g.length-1){j=j[m]=n||{}}else{if(typeOf(n)=="array"){n.push(i)}else{j[m]=n!=null?[n,i]:i}}})});return b},cleanQueryString:function(a){return this.split("&").filter(function(f){var b=f.indexOf("="),c=b<0?"":f.substr(0,b),d=f.substr(b+1);return a?a.call(null,c,d):(d||d===0)}).join("&")}});Behavior.addGlobalFilters({Tabs:{defaults:{"tabs-selector":".tabs>li","sections-selector":".tab_sections>li",smooth:true,smoothSize:true,rearrangeDOM:false},setup:function(c,d){var b=c.getElements(d.get("tabs-selector"));var g=c.getElements(d.get("sections-selector"));if(b.length!=g.length||b.length==0){d.fail("warning; sections and sections are not of equal number. tabs: %o, sections: %o",b,g)}var a=function(){return window.location.hash.substring(1,window.location.hash.length).parseQueryString()};var f=new TabSwapper(Object.merge({tabs:b,sections:g,initPanel:d.get("hash")?a()[d.get("hash")]:null},Object.cleanValues(d.getAs({smooth:Boolean,smoothSize:Boolean,rearrangeDOM:Boolean,selectedClass:String,initPanel:Number}))));f.addEvent("active",function(i){if(d.get("hash")){var j=a();j[d.get("hash")]=i;window.location.hash=Object.cleanValues(Object.toQueryString(j))}d.fireEvent("layout:display",g[0].getParent())});c.store("TabSwapper",f);return f}}});window.addEvent("domready",function(){var b=new Behavior({selector:"[data-behavior]:not(.hidden .modal [data-behavior])"}).apply(document.body);var a=new Delegator({getBehavior:function(){return b}}).attach(document.body);document.body.addEvent("click:relay(.smartwidget)",function(c){c.stopPropagation();if(["a","audio","video"].indexOf(c.target.tagName.toLowerCase())===-1){c.preventDefault()}})});Mask.implement({options:{useIframeShim:false},render:function(){this.element=new Element("a",{"class":this.options["class"],id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(a){this.fireEvent("click",a);if(this.options.hideOnClick){this.hide()}}.bind(this)}});this.hidden=true}});Delegator.register("click","fakeLabel",{defaults:{target:"input"},handler:function(d,b,c){var a=b.getElement(c.get("target"));if(["checkbox","radio"].contains(a.get("type"))){a.checked=true;a.fireEvent("change",new Event.Mock(a,"change"))}a.focus()}});Delegator.register("click","PageTabs",{requireAs:{tabs:String},handler:function(g,f,d){var i=f.getElement(d.get("tabs"));if(!i){d.fail("Could not find target for selector "+d.get("tabs"))}var b=i.getBehaviorResult("Tabs");if(!b){d.fail("The target element is not part of a tabs interface")}var a=b.now;var c=d.get("direction")=="back"?c=a-1:c=a+1;if(!b.tabs[c]){return}b.show(c)}});Delegator.register("click","selectOne",{require:["targets"],defaults:{"class":"selected"},handler:function(d,c,b){var a=c.getElements(b.get("targets"));if(a.length==0){b.fail("Could not find targets for selector "+b.get("targets"))}a.removeClass(b.get("class"));if(a.contains(c)){c.addClass(b.get("class"))}else{a.some(function(f){if(f.contains(c)){f.addClass(b.get("class"));return true}})}}});Delegator.register("click","ShowSlide",{requireAs:{tabs:String,index:Number},handler:function(d,c,b){var f=c.getElement(b.get("tabs"));if(!f){b.fail("Could not find target for selector "+b.get("tabs"))}var a=f.getBehaviorResult("Tabs");if(!a){b.fail("The target element is not part of a tabs interface")}a.show(b.getAs(Number,"index"))}});var flashlog={};window.addEvent("domready",function(){flashlog.logDiv=new Element("div",{id:"log",styles:{backgroundColor:"#fff",border:"1px solid #000"},events:{click:function(){this.set("html","")}}});if(Browser.Platform.ios){document.body.addClass("iOS")}});var log=function(){new Element("div",{styles:{borderBottom:"3px solid #666"},html:Array.join(arguments," ")}).inject(flashlog.logDiv);flashlog.logDiv.inject(document.body)};flashlog.destroy=function(){if(flashlog.flashDiv){flashlog.flashDiv.destroy();delete flashlog.flashDiv}};var flash=function(a,b){if(flashlog.flashDiv){flashlog.destroy()}flashlog.flashDiv=new Element("div",{"class":"alert-message flash"}).inject(document.body);flashlog.flashDiv.addClass(b);flashlog.flashDiv.show().innerHTML+="<p>"+Array.join(a," ")+"</p>";clearTimeout(flashlog.flashTimer);flashlog.flashTimer=destroy.delay(3000)};["error","success","info","warning"].each(function(a){flash[a]=function(){flash(arguments,a)}});(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(c,b){this.element=this.subject=document.id(c);this.parent(b);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body)}if(this.options.wheelStops){var d=this.element,f=this.cancel.pass(false,this);this.addEvent("start",function(){d.addEvent("mousewheel",f)},true);this.addEvent("complete",function(){d.removeEvent("mousewheel",f)},true)}},set:function(){var b=Array.flatten(arguments);if(Browser.firefox){b=[Math.round(b[0]),Math.round(b[1])]}this.element.scrollTo(b[0],b[1]);return this},compute:function(d,c,b){return[0,1].map(function(f){return Fx.compute(d[f],c[f],b)})},start:function(c,d){if(!this.check(c,d)){return this}var b=this.element.getScroll();return this.parent([b.x,b.y],[c,d])},calculateScroll:function(i,g){var d=this.element,b=d.getScrollSize(),j=d.getScroll(),l=d.getSize(),c=this.options.offset,k={x:i,y:g};for(var f in k){if(!k[f]&&k[f]!==0){k[f]=j[f]}if(typeOf(k[f])!="number"){k[f]=b[f]-l[f]}k[f]+=c[f]}return[k.x,k.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false))},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"))},toElement:function(d,f){f=f?Array.from(f):["x","y"];var c=a(this.element)?{x:0,y:0}:this.element.getScroll();var b=Object.map(document.id(d).getPosition(this.element),function(i,g){return f.contains(g)?i+c[g]:false});return this.start.apply(this,this.calculateScroll(b.x,b.y))},toElementEdge:function(d,i,f){i=i?Array.from(i):["x","y"];d=document.id(d);var k={},g=d.getPosition(this.element),l=d.getSize(),j=this.element.getScroll(),b=this.element.getSize(),c={x:g.x+l.x,y:g.y+l.y};["x","y"].each(function(m){if(i.contains(m)){if(c[m]>j[m]+b[m]){k[m]=c[m]-b[m]}if(g[m]<j[m]){k[m]=g[m]}}if(k[m]==null){k[m]=j[m]}if(f&&f[m]){k[m]=k[m]+f[m]}},this);if(k.x!=j.x||k.y!=j.y){this.start(k.x,k.y)}return this},toElementCenter:function(f,g,j){g=g?Array.from(g):["x","y"];f=document.id(f);var k={},c=f.getPosition(this.element),d=f.getSize(),b=this.element.getScroll(),i=this.element.getSize();["x","y"].each(function(l){if(g.contains(l)){k[l]=c[l]-(i[l]-d[l])/2}if(k[l]==null){k[l]=b[l]}if(j&&j[l]){k[l]=k[l]+j[l]}},this);if(k.x!=b.x||k.y!=b.y){this.start(k.x,k.y)}return this}});Fx.Scroll.implement({scrollToCenter:function(){return this.toElementCenter.apply(this,arguments)},scrollIntoView:function(){return this.toElementEdge.apply(this,arguments)}});function a(b){return(/^(?:body|html)$/i).test(b.tagName)}})();(function(){var S=10;var d=1;var s=720/(window.devicePixelRatio||1);var A=350;var E=0.5;var N=600;var v=80;var R=60;var C=0.5;var F=50;var x=1;var i=200;var j="webkitTransform" in document.documentElement.style;var f="MozTransform" in document.documentElement.style;var r="ontouchstart" in window;var B,z,p,n,l,u,D;var K=0;var m=[];var T={horizontal:g,vertical:k};var y={globalScrolling:false,scrollers:T,flashIndicators:function(){var U=document.querySelectorAll(".scrollable.vertical");for(var V=0;V<U.length;++V){y.scrollTo(U[V],0,0,20,true)}},scrollToTop:function(){var U=document.getElementsByClassName("scrollable");if(U.length){var V=U[0];if(V.className.indexOf("vertical")!=-1){y.scrollTo(V,0,0,i)}}},scrollTo:function(W,ab,aa,Z,Y){o();var X=L(W);if(X){if(Y){X.delegate=null}X=I(X);m=[X];u=true;if(Z){var ac=W[X.key];var ad=X.filter(ab,aa);var V=ad-ac;var U=new Date().getTime();K=setInterval(function(){var ae=new Date().getTime()-U;var af=ac+((ad-ac)*(ae/Z));if((V<0&&af<ad)||(V>0&&af>ad)){af=ad}X.updater(af);if(af==ad){clearInterval(K);setTimeout(o,200)}},20)}else{X.updater(aa);o()}}}};function O(){window.scrollability=y;document.addEventListener("touchstart",P,false);document.addEventListener("scroll",t,false);document.addEventListener("orientationchange",q,false)}function M(){}function t(U){setTimeout(function(){if(D){D=false}else{if(r){y.scrollToTop()}}})}function q(U){D=true}function P(V){o();var Y=V.target;var Z=V.touches[0];var W=null;var X=new Date().getTime();p=B=Z.clientX;n=z=Z.clientY;l=true;u=false;m=Q(V.target,p,n,X);if(!m.length&&!y.globalScrolling){return true}var aa=setTimeout(function(){aa=0;W=b(Y)},50);var ab=document;ab.addEventListener("touchmove",U,false);ab.addEventListener("touchend",ac,false);K=setInterval(G,0);function U(ae){ae.preventDefault();u=true;if(aa){clearTimeout(aa);aa=0}if(W){w(W);W=null}var ag=ae.touches[0];p=ag.clientX;n=ag.clientY;if(m.length>1){for(var ad=0;ad<m.length;++ad){var af=m[ad];if(af.disable&&af.disable(p,n,B,z)){af.terminator();m.splice(ad,1);break}}}}function ac(ae){if(aa){clearTimeout(aa);aa=0}if(W){var ad=document.createEvent("MouseEvents");ad.initMouseEvent("click",true,true,window,1);W[0].dispatchEvent(ad);w(W)}ab.removeEventListener("touchmove",U,false);ab.removeEventListener("touchend",ac,false);l=false}}function I(aC,at,ar,ae){var aq=aC.delegate;var az=aC.constrained;var X=aC.paginated;var au=aC.viewport||0;var U=aC.scrollbar;var aD=aC.node[aC.key];var ak=aC.min;var am=aC.max;var aa=ak;var ab=Math.round(am/au)*au;var aA=0;var Z=0;var ah=0;var af,ap;var al=X?R:v;var ag=aC.bounce;var V=au*C;var ao=startTouch=aC.filter(at,ar);var ax=ae;var av=0;var ad=20;var an=false;var aw=false;if(X){var aj=Math.round(Math.abs(aa)%au);var ac=((Math.abs(aa)-aj)/au)+1;var aA=aj/ac;var aB=Math.round(aD)%au;var ai=Math.round((aD-aB)/au)*au;ak=am=Math.round(ai+ab)+aB;aa+=aA}if(aq&&aq.onStartScroll){if(!aq.onStartScroll()){return null}}if(U){aC.node.parentNode.appendChild(U)}function ay(aG,aF){var aI=1/(aF-ax);ax=aF;var aH=true;if(l){var aL=(aG-ao)*d;if(!aL){if(!av){av=aF}if(aF-av<ad){return true}}else{av=0}if(!aw&&Math.abs(aG-startTouch)>S){aw=true;if(aq&&aq.onLockScroll){aq.onLockScroll(aC.key)}}ao=aG;Z=aL/aI;if(aD>am&&ab==am&&az){var aK=aD-am;Z*=(1-aK/ag)}else{if(aD<ak&&aa==ak&&az){var aK=ak-aD;Z*=(1-aK/ag)}}}else{if(X&&!an){an=true;if(Math.abs(aD-am)>V||Math.abs(Z)>F){if(aD>am){if(am!=ab){am+=au+aA;ak+=au+aA;if(aq&&aq.onScrollPage){var aE=ak%au;var aJ=-Math.round((aD+au-aE)/au);aq.onScrollPage(aJ,-1)}}}else{if(ak!=aa){am-=au+aA;ak-=au+aA;if(aq&&aq.onScrollPage){var aE=ak%au;var aJ=-Math.round((aD-au-aE)/au);aq.onScrollPage(aJ,1)}}}}}if(aD>am&&az){if(Z>0){var aK=aD-am;var aM=(1-aK/ag);Z=Math.max(Z-N*aI,0)*aM;ah=0}else{if(!ah){af=aD;ap=am-aD}aD=J(ah,af,ap,al);return Y(aD,++ah<=al&&Math.floor(aD)>am)}}else{if(aD<ak&&az){if(Z<0){var aK=ak-aD;var aM=(1-aK/ag);Z=Math.min(Z+N*aI,0)*aM;ah=0}else{if(!ah){af=aD;ap=ak-aD}aD=J(ah,af,ap,al);return Y(aD,++ah<=al&&Math.ceil(aD)<ak)}}else{if(!ah){if(Z<0&&Z<-s){Z=-s}else{if(Z>0&&Z>s){Z=s}}af=Z}Z=J(ah,af,-af,A);if(++ah>A||Math.floor(Z)==0){aH=false}}}}aD+=Z*aI;return Y(aD,aH)}function Y(aJ,aI){aD=aJ;aC.node[aC.key]=aD;aC.update(aC.node,aD);if(aq&&aq.onScroll){aq.onScroll(aD)}var aH=-ak-am;if(U&&au<aH){var aF=au-x*2;var aE=(aF/aH)*aF;var aG=0;if(aD>am){aE=Math.max(aE-(aD-am),7);aG=0}else{if(aD<ak){aE=Math.max(aE-(ak-aD),7);aG=(aF-aE)}else{aG=Math.round((Math.abs(aD)/aH)*(aF-aE))}}aG+=x;U.style.height=Math.round(aE)+"px";a(U,0,Math.round(aG));if(u){U.style.webkitTransition="none";U.style.opacity="1"}}return aI}function W(){if(X){var aE=Math.round(aD/au);Y(aE*(au+aA))}else{if(aD>am&&az){Y(am)}else{if(aD<ak&&az){Y(ak)}}}if(U){U.style.opacity="0";U.style.webkitTransition="opacity 0.33s linear"}if(aq&&aq.onEndScroll){aq.onEndScroll()}}aC.updater=Y;aC.animator=ay;aC.terminator=W;return aC}function G(){var W=new Date().getTime();for(var U=0;U<m.length;++U){var V=m[U];var X=V.filter(p,n);if(!V.animator(X,W)){V.terminator();m.splice(U--,1)}}if(!m.length){o()}}function Q(Z,W,U,Y){var V=[];H(Z,V,W,U,Y);var aa=document.querySelectorAll(".scrollable.global");for(var X=0;X<aa.length;++X){H(aa[X],V,W,U,Y)}return V}function H(Y,W,V,U,Z){while(Y){if(Y.nodeType==1){var ab=L(Y,V,U,Z);if(ab){var aa=false;for(var X=0;X<W.length;++X){if(W[X].node==Y){aa=true;break}}if(!aa){ab=I(ab,V,U,Z);if(ab){W.push(ab)}}}}Y=Y.parentNode}}function L(Z,V,U,aa){var Y=Z.className.split(" ");if(!Z.hasClass("scrollable")){return}for(var X=0;X<Y.length;++X){var W=Y[X];if(T[W]){var ab=T[W](Z);ab.key="scrollable_"+W;ab.paginated=Y.indexOf("paginated")!=-1;if(!(ab.key in Z)){Z[ab.key]=ab.initial?ab.initial(Z):0}return ab}}}function b(V){var U=[];for(var W=V;W;W=W.parentNode){if(W.nodeType==1){W.className=(W.className?W.className+" ":"")+"touched";U.push(W)}}return U}function w(U){for(var V=0;V<U.length;++V){var W=U[V];W.className=W.className.replace("touched","")}}function o(){if(K){clearInterval(K);K=0;for(var U=0;U<m.length;++U){var V=m[U];V.terminator()}m=[]}}function a(V,U,W){if(j){V.style.webkitTransform="translate3d("+(U?(U+"px"):"0")+","+(W?(W+"px"):"0")+",0)"}else{if(f){V.style.MozTransform="translate("+(U?(U+"px"):"0")+","+(W?(W+"px"):"0")+")"}}}y.moveElement=a;function c(U){if(!U.scrollableScrollbar){var V=U.scrollableScrollbar=document.createElement("div");V.className="scrollableScrollbar";V.style.cssText=["position: absolute","top: 0","right: 1px","width: 7px","min-height: 7px","opacity: 0","-webkit-transform: translate3d(0,0,0)","-webkit-box-sizing: border-box",'-webkit-border-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUhJREFUeNp0Ur1OwzAQtt1CaZQQgUjDhuicrEwoqjJlzpBAXoIHywtkcwfECyQPwIgKQkoyFJWq5k6cJcsUS5/sO993/1wpxazjAU4BJyR/A3aA0TSaGu85kbSO0y0AM/pH8lYr8ZwBLpBUluVtGIaPjuM8IYIgeEAdObwkB4xTqgv8iOP4vuu6lZEFRkUDHkWRbNv2mVJ/x4g+1pPn+RJICRlzk4Q3/lVVdUP1nwtqgpJSYqQJGbMj96RpmhXJM01kwzBcWU2x36zv+wXppro5TAihvat/HCjxa6R0V7FY5rruhx3BTtfzvDeS95rI0zSVcB+MpijL0SHLsjW9d3ocIRZvjINbKSsYx5rGsQdsNHFOC8CKolhCh+/GcbxG2ff9TZIkL3Vdv5KjT8AXN3b12MqZi4yRBiTZu7olmEvOacH/LPmPAAMA2bZzzeYUC40AAAAASUVORK5CYII=") 6 2 6 2 / 3px 1px 3px 1px round round',"z-index: 2147483647",].join(";")}return U.scrollableScrollbar}function J(V,U,X,W){return(V==W)?U+X:X*(-Math.pow(2,-10*V/W)+1)+U}function g(U){var V=U.parentNode;return{node:U,min:-V.scrollWidth+V.offsetWidth,max:0,viewport:V.offsetWidth,bounce:V.offsetWidth*E,constrained:true,delegate:U.scrollDelegate,filter:function(W,X){return W},disable:function(X,ab,Z,W){var aa=Math.abs(X-Z);var Y=Math.abs(ab-W);if(Y>aa&&Y>S){return true}},update:function(X,W){a(X,W,X.scrollable_vertical||0)}}}function k(U){var V=U.parentNode;return{node:U,scrollbar:c(U),min:-V.scrollHeight+V.offsetHeight,max:0,viewport:V.offsetHeight,bounce:V.offsetHeight*E,constrained:true,delegate:U.scrollDelegate,filter:function(W,X){return X},disable:function(X,ab,Z,W){var aa=Math.abs(X-Z);var Y=Math.abs(ab-W);if(aa>Y&&aa>S){return true}},update:function(X,W){a(X,X.scrollable_horizontal||0,W)}}}O()})();if(Browser.Platform.ios){Fx.Scrollability=new Class({Extends:Fx.Scroll,current:[0,0],start:function(a,b){if(!this.check(a,b)){return this}return this.constructor.prototype.start.apply(this,[this.current,[-a,-b]])},set:function(){var a=Array.flatten(arguments);scrollability.scrollTo(this.element,a[0],a[1]);this.current=a;return this},compute:function(){return this.parent.apply(this,arguments)}})}else{Fx.Scrollability=Fx.Scroll}Elements.from=function(f,d){if(d||d==null){f=f.stripScripts()}var b,c=f.match(/^\s*<(t[dhr]|tbody|tfoot|thead)/i);if(c){b=new Element("table");var a=c[1].toLowerCase();if(["td","th","tr"].contains(a)){b=new Element("tbody").inject(b);if(a!="tr"){b=new Element("tr").inject(b)}}}return(b||new Element("div")).set("html",f).getChildren()};(function(){var b;var a=function(f,j,d,i){d=d||{};if(d.mask==null){d.mask=true}var g;if(d.mask){g=new Mask(document.body,{destroyOnHide:true}).show();g.addEvent("hide",function(){f.destroy();b=false;if(i){i.fireEvent("popupHidden")}});g.addEvent("click",function(){g.hide()});f.addEvent("click:relay(.close)",function(){g.hide()})}else{f.addEvent("click:relay(.close)",function(){f.destroy();b=false})}b=true;f.inject(document.body,"top").show();var c=f.position(j||{});if(d.fixedPos){setTimeout(function(){var m="100px";var l="100px";var k=f.getSize();if(d.pageHeight){m=((d.pageHeight/2)-(k.y/2))+"px"}if(d.pageWidth){l=((d.pageWidth/2)-(k.x/2))+"px"}f.setStyles({position:"fixed",top:m,left:l})},1)}return c};Delegator.register("click","ShowPopup",{require:["target"],defaults:{mask:true},handler:function(i,g,f){if(b){return}var j=g.getElement(f.get("target"));i.preventDefault();if(!j){f.fail("Could not find target popup element: ",f.get("target"))}targetAPI=new BehaviorAPI(j,"data-modal");var d=j.clone(true,true);f.getBehavior().apply(d);var c={mask:f.getAs(Boolean,"mask"),fixedPos:f.getAs(Boolean,"fixedPos"),pageWidth:f.getAs(Number,"pageWidth"),pageHeight:f.getAs(Number,"pageHeight")};a(d,true,c,j);j.fireEvent("popupVisible",{original:j,clone:d})}});Delegator.register("click","Popover",{defaults:{template:'<div class="popover {position}"><div class="arrow"></div><div class="inner"><h3 class="title">{title}</h3><div class="content"><p>{alt}</p> <a class="btn close primary right">Close</a></div></div></div>',mask:true,position:"auto"},handler:function(c,l,i){if(b){return}c.preventDefault();var n,f=i.get("templateElement");if(f){n=element.getElement(f).get("html")}if(!n){n=i.get("template")}var k=i.get("position");if(k=="auto"){if(l.getParent(".column1")){k="right"}else{k="left"}}var g,d;switch(k){case"above":g="centerTop";d="centerBottom";break;case"below":g="centerBottom";d="centerTop";break;case"left":g="centerLeft";d="centerRight";break;case"right":g="centerRight";d="centerLeft";break}var j=Elements.from(n.substitute({title:l.get("title"),alt:l.get("alt"),position:k}))[0];var o={mask:i.getAs(Boolean,"mask"),fixedPos:i.getAs(Boolean,"fixedPos"),pageWidth:i.getAs(Number,"pageWidth"),pageHeight:i.getAs(Number,"pageHeight")};var m=a(j,{relativeTo:l,position:g,edge:d,returnPos:true},o);if(k=="right"){delete m.left;m.right=75}else{m.left=75}j.setStyles(m)}})})();var Quiz={showMessage:function(a,f){var d=f.getParent(".quiz-list");var i=a?"Correct! You answered correctly. Good job.":"Sorry! That is not the correct answer.";if(d){var g=d.getParent();if(g.getElements(".inline-message")){g.getElements(".inline-message").destroy()}var b=a?"quiz-correct":"quiz-incorrect";var c=new Element("span",{"class":"inline-message epub__inline-message "+b+" epub__"+b});c.set("text",i);g.adopt(c);setTimeout(function(){c.destroy()},3000)}else{if(a){flash.success(i,10)}else{flash.error(i,10)}}},Full:new Class({Implements:[Options,Events],options:{onCorrect:function(a){Quiz.showMessage(true,a)},onIncorrect:function(a){Quiz.showMessage(false,a)}},initialize:function(b,a){this.setOptions(a);this.element=document.id(b);this.startup();this.attach()},startup:function(){this.element.getElements("[data-trigger*=selectOne]").each(function(c){var a=c.getElement("input");var b=new BehaviorAPI(c,"selectone");if(a.checked){c.getElements(b.get("targets")).each(function(d){if(d.contains(c)){d.addClass(b.get("class"))}})}})},attach:function(){this.element.getElements("input, select").addEvent("change",this.validate.bind(this))},validate:function(f){var d=f.target;if(f.target.get("tag")=="select"){d=f.target.getSelected()[0]}if(d.get("value")=="correct"){this.fireEvent("correct",d)}else{this.fireEvent("incorrect",d)}var c=this.element.toQueryString().parseQueryString(),b=0,a=0;Object.each(c,function(i,g){if(!i){b++}if(i!="correct"){a++}});if(b){this.fireEvent("incomplete",[b,c])}else{this.fireEvent("validate",[a,c]);if(!a){this.fireEvent("success")}}}})};Behavior.addGlobalFilter("Quiz",{setup:function(a,b){return new Quiz.Full(a)}});Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof a=="string"){var b=a.split(":");a=Fx.Transitions;a=a[b[0]]||a[b[0].capitalize()];if(b[1]){a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")]}}return a}});Fx.Transition=function(c,b){b=Array.from(b);var a=function(d){return c(d,b)};return Object.append(a,{easeIn:a,easeOut:function(d){return 1-c(1-d,b)},easeInOut:function(d){return(d<=0.5?c(2*d,b):(2-c(2*(1-d),b)))/2}})};Fx.Transitions={linear:function(a){return a}};Fx.Transitions=new Hash(Fx.Transitions);Fx.Transitions.extend=function(a){for(var b in a){Fx.Transitions[b]=new Fx.Transition(a[b])}};Fx.Transitions.extend({Pow:function(b,a){return Math.pow(b,a&&a[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Back:function(b,a){a=a&&a[0]||1.618;return Math.pow(b,2)*((a+1)*b-a)},Bounce:function(g){var f;for(var d=0,c=1;1;d+=c,c/=2){if(g>=(7-4*d)/11){f=c*c-Math.pow((11-6*d-11*g)/4,2);break}}return f},Elastic:function(b,a){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(a&&a[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(b,a){Fx.Transitions[b]=new Fx.Transition(function(c){return Math.pow(c,a+2)})});(function(){var b=function(){return this.get("value")};var a=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(d,c){this.setOptions(c);var f=this.options.base||a.base;if(!d){d=f}if(d&&d.parsed){this.parsed=Object.clone(d.parsed)}else{this.set("value",d.href||d.toString(),f?new a(f):false)}},parse:function(f,d){var c=f.match(this.regex);if(!c){return false}c.shift();return this.merge(c.associate(this.parts),d)},merge:function(d,c){if((!d||!d.scheme)&&(!c||!c.scheme)){return false}if(c){this.parts.every(function(f){if(d[f]){return false}d[f]=c[f]||"";return true})}d.port=d.port||this.schemes[d.scheme.toLowerCase()];d.directory=d.directory?this.parseDirectory(d.directory,c?c.directory:""):"/";return d},parseDirectory:function(d,f){d=(d.substr(0,1)=="/"?"":(f||"/"))+d;if(!d.test(a.regs.directoryDot)){return d}var c=[];d.replace(a.regs.endSlash,"").split("/").each(function(g){if(g==".."&&c.length>0){c.pop()}else{if(g!="."){c.push(g)}}});return c.join("/")+"/"},combine:function(c){return c.value||c.scheme+"://"+(c.user?c.user+(c.password?":"+c.password:"")+"@":"")+(c.host||"")+(c.port&&c.port!=this.schemes[c.scheme]?":"+c.port:"")+(c.directory||"/")+(c.file||"")+(c.query?"?"+c.query:"")+(c.fragment?"#"+c.fragment:"")},set:function(d,g,f){if(d=="value"){var c=g.match(a.regs.scheme);if(c){c=c[1]}if(c&&this.schemes[c.toLowerCase()]==null){this.parsed={scheme:c,value:g}}else{this.parsed=this.parse(g,(f||this).parsed)||(c?{scheme:c,value:g}:{value:g})}}else{if(d=="data"){this.setData(g)}else{this.parsed[d]=g}}return this},get:function(c,d){switch(c){case"value":return this.combine(this.parsed,d?d.parsed:false);case"data":return this.getData()}return this.parsed[c]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(f,d){var c=this.get(d||"query");if(!(c||c===0)){return f?null:{}}var g=c.parseQueryString();return f?g[f]:g},setData:function(c,g,d){if(typeof c=="string"){var f=this.getData();f[arguments[0]]=arguments[1];c=f}else{if(g){c=Object.merge(this.getData(),c)}}return this.set(d||"query",Object.toQueryString(c))},clearData:function(c){return this.set(c||"query","")},toString:b,valueOf:b});a.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/};a.base=new a(Array.from(document.getElements("base[href]",true)).getLast(),{base:document.location});String.implement({toURI:function(c){return new a(this,c)}})})();var TOC=new Class({Implements:[Options,Events],options:{selected:null},initialize:function(a){this.setOptions(a);this.element=new Element("div.hidden.toc-container").inject(document.body);this.element.addEvent("click:relay(a.close)",this.hide.bind(this))},hide:function(){if(this.hidden){return}this.element.hide();this.hidden=true},show:function(){if(!this.hidden){return}if(!this.retrieved){this.nav=this.getNav()}this.element.setStyles({opacity:0,display:"block"});this.select(this.options.selected);this.element.setStyles({opacity:1});this.hidden=false},hidden:true,toggle:function(){if(this.hidden){this.show()}else{this.hide()}},getNav:function(){if(this.retrieved){return}var a=new XMLHttpRequest();a.open("GET","toc.html",false);a.send();txt=a.responseText;this.element.set("html",txt);this.retrieved=true;this.chapters=this.element.getElement(".chapters");this.fx=new Fx.Scrollability(this.chapters,{duration:0})},select:function(b){if(b){var a=this.chapters.getElements("a[href="+b+"]");if(a.length<=0){return}a.each(function(d){d.getParent().addClass("selected");var c;if(d.getParent("dd.contents, dd.figures")){c=d.getParent("dd.contents, dd.figures").getPrevious("dt")}else{c=d.getParent("dt")}if(c){this.fx.toElement(c.addClass("selected"))}}.bind(this));a[0].getParent().scrollIntoView()}}});window.addEvent("domready",function(){if(document.body.hasClass("no-toc")){return}if(!document.body.hasClass("toc")){return}var a=$(document.body).getAttribute("data-toc-page-name");var b=new TOC({selected:a||new URI().get("file")});new Element("a",{"class":"tocLink",text:"TOC",events:{click:function(c){c.stop();b.toggle()}}}).inject(document.body,"top");document.body.addEvent("click",function(c){if(!c.target.getParent(".nav")&&!b.hidden){b.hide()}})});var Touch=new Class({Implements:Events,initialize:function(a){this.element=document.id(a);this.bound={start:this.start.bind(this),move:this.move.bind(this),end:this.end.bind(this)};if(Browser.Platform.ipod){this.context=this.element;this.startEvent="touchstart";this.endEvent="touchend";this.moveEvent="touchmove"}else{this.context=document;this.startEvent="mousedown";this.endEvent="mouseup";this.moveEvent="mousemove"}this.attach()},attach:function(){this.element.addListener(this.startEvent,this.bound.start)},detach:function(){this.element.removeListener(this.startEvent,this.bound.start)},start:function(a){this.preventDefault(a);document.body.style.WebkitUserSelect="none";this.hasDragged=false;this.context.addListener(this.moveEvent,this.bound.move);this.context.addListener(this.endEvent,this.bound.end);var b=this.getPage(a);this.startX=b.pageX;this.startY=b.pageY;this.fireEvent("start")},move:function(a){this.preventDefault(a);var b=this.getPage(a);this.deltaX=b.pageX-this.startX;this.deltaY=b.pageY-this.startY;this.hasDragged=!(this.deltaX===0&&this.deltaY===0);if(this.hasDragged){this.fireEvent("move",[this.deltaX,this.deltaY])}},end:function(a){this.preventDefault(a);document.body.style.WebkitUserSelect="";this.context.removeListener(this.moveEvent,this.bound.move);this.context.removeListener(this.endEvent,this.bound.end);this.fireEvent((this.hasDragged)?"end":"cancel")},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},getPage:function(b){if(b.targetTouches){b=b.targetTouches[0]}if(b.pageX!=null&&b.pageY!=null){return{pageX:b.pageX,pageY:b.pageY}}var a=(!document.compatMode||document.compatMode=="CSS1Compat")?document.documentElement:document.body;return{pageX:b.clientX+a.scrollLeft,pageY:b.clientY+a.scrollTop}}});Touch.build="%build%";var ThreeSixty=new Class({Implements:[Options,Events],options:{images:{count:72,path:"images/Seq_v04_640x378_##.jpg"},maxFlickMultiplier:1,minFlick:5,rotateDistance:1000,playIntro:true,full360:true},current:0,history:[0],dragStartPos:0,sources:[],initialize:function(a,b){this.element=document.id(a);this.setOptions(b);this.attach();this.computeSources();this.makeImg();this.makeFx();this.preload()},makeImg:function(){if(this.options.image){this.img=document.id(this.options.image)}if(!this.img){this.img=new Element("img",{src:this.sources[0]}).inject(this.element)}},makeFx:function(){this.fx=new Fx({transition:Fx.Transitions.Quad.easeOut,fps:120});this.fx.set=function(a){this.show(a.round())}.bind(this)},computeSources:function(){var a=this.options.images.path.split("##");this.options.images.count.times(function(b){this.sources.push(a[0]+this.pad(b+1,2)+a[1])},this);return this.sources},preload:function(){Asset.images(this.sources,{onProgress:function(a,b,c){this.fireEvent("progress",[((a/this.options.images.count)*100).round(),b,c])}.bind(this),onComplete:function(){this.fireEvent("ready");if(this.options.playIntro){this.intro()}}.bind(this)})},intro:function(){this.fx.options.duration=1000;this.fx.start(this.current,this.options.images.count).chain(function(){this.fx.options.duration=500;this.current=this.options.images.count}.bind(this))},pad:function(c,b,a){if(b==1){return c}return c<Math.pow(10,b-1)?(a||"0")+this.pad(c,b-1,a):c},attach:function(){this.touch=new Touch(this.element).addEvents({start:this.startDrag.bind(this),end:this.endDrag.bind(this),move:this.drag.bind(this)})},startDrag:function(){this.fx.cancel();this.dragStartPos=this.current;this.history.empty();this.dragOffset=0;this.dragInterval=this.updateDragHistory.periodical(10,this);this.updateDragHistory()},updateDragHistory:function(){this.history.unshift(this.dragOffset);if(this.history.length>3){this.history.pop()}},endDrag:function(){clearInterval(this.dragInterval);var a=(this.history.getLast()-this.dragOffset);var c=this.element.getSize().x;var b=(a/c)*this.options.images.count;this.flick(b.round())},drag:function(a){this.dragOffset=a;var b=a/this.options.rotateDistance,c=(this.options.images.count*b).round();this.rotate(-c)},rotate:function(b){if(this.options.full360){var a=(b+this.dragStartPos)%this.options.images.count;if(a<0){a=this.options.images.count+a}this.show(a)}else{var a=b+this.dragStartPos;if(a>=0&&a<this.options.images.count){this.show(a)}}},show:function(a){if(this.sources[a]){this.img.src=this.sources[a];this.current=a;this.fireEvent("changed",{index:this.current})}},flick:function(a){if(a.abs()<this.options.minFlick){return}if(a.abs()>this.options.maxFlickMultiplier*this.options.images.count){a=this.options.maxFlickMultiplier*this.options.images.count*(a>0?1:-1)}this.fx.start(this.current,this.current+a)}});if(Browser.Platform.ios){Browser.Platform.ipod=true}Behavior.addGlobalFilters({ThreeSixty:{defaults:{playIntro:false,image:"img.frame"},setup:function(a,b){var c=new ThreeSixty(a,Object.merge({image:a.getElement(b.get("image"))},Object.cleanValues(b.getAs({images:Object,playIntro:Boolean}))));return c}}});var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var b=Array.link(arguments,{options:Type.isObject,element:function(c){return c!=null}});this.element=document.id(b.element);this.document=this.element.getDocument();this.setOptions(b.options||{});var a=typeOf(this.options.handle);this.handles=((a=="array"||a=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=(Browser.ie)?"selectstart":"mousedown";if(Browser.ie&&!Drag.ondragstartFixed){document.ondragstart=Function.from(false);Drag.ondragstartFixed=true}this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(false)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(a){var l=this.options;if(a.rightClick){return}if(l.preventDefault){a.preventDefault()}if(l.stopPropagation){a.stopPropagation()}this.mouse.start=a.page;this.fireEvent("beforeStart",this.element);var c=l.limit;this.limit={x:[],y:[]};var f,j;for(f in l.modifiers){if(!l.modifiers[f]){continue}var b=this.element.getStyle(l.modifiers[f]);if(b&&!b.match(/px$/)){if(!j){j=this.element.getCoordinates(this.element.getOffsetParent())}b=j[l.modifiers[f]]}if(l.style){this.value.now[f]=(b||0).toInt()}else{this.value.now[f]=this.element[l.modifiers[f]]}if(l.invert){this.value.now[f]*=-1}this.mouse.pos[f]=a.page[f]-this.value.now[f];if(c&&c[f]){var d=2;while(d--){var g=c[f][d];if(g||g===0){this.limit[f][d]=(typeof g=="function")?g():g}}}}if(typeOf(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid}}var k={mousemove:this.bound.check,mouseup:this.bound.cancel};k[this.selection]=this.bound.eventStop;this.document.addEvents(k)},check:function(a){if(this.options.preventDefault){a.preventDefault()}var b=Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-this.mouse.start.y,2)));if(b>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element)}},drag:function(b){var a=this.options;if(a.preventDefault){b.preventDefault()}this.mouse.now=b.page;for(var c in a.modifiers){if(!a.modifiers[c]){continue}this.value.now[c]=this.mouse.now[c]-this.mouse.pos[c];if(a.invert){this.value.now[c]*=-1}if(a.limit&&this.limit[c]){if((this.limit[c][1]||this.limit[c][1]===0)&&(this.value.now[c]>this.limit[c][1])){this.value.now[c]=this.limit[c][1]}else{if((this.limit[c][0]||this.limit[c][0]===0)&&(this.value.now[c]<this.limit[c][0])){this.value.now[c]=this.limit[c][0]}}}if(a.grid[c]){this.value.now[c]-=((this.value.now[c]-(this.limit[c][0]||0))%a.grid[c])}if(a.style){this.element.setStyle(a.modifiers[c],this.value.now[c]+a.unit)}else{this.element[a.modifiers[c]]=this.value.now[c]}}this.fireEvent("drag",[this.element,b])},cancel:function(a){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});if(a){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element)}},stop:function(b){var a={mousemove:this.bound.drag,mouseup:this.bound.stop};a[this.selection]=this.bound.eventStop;this.document.removeEvents(a);if(b){this.fireEvent("complete",[this.element,b])}}});Element.implement({makeResizable:function(a){var b=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},a));this.store("resizer",b);return b.addEvent("drag",function(){this.fireEvent("resize",b)}.bind(this))}});Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:false,precalculate:false,includeMargins:true,checkDroppables:true},initialize:function(b,a){this.parent(b,a);b=this.element;this.droppables=$$(this.options.droppables);this.container=document.id(this.options.container);if(this.container&&typeOf(this.container)!="element"){this.container=document.id(this.container.getDocument().body)}if(this.options.style){if(this.options.modifiers.x=="left"&&this.options.modifiers.y=="top"){var c=b.getOffsetParent(),d=b.getStyles("left","top");if(c&&(d.left=="auto"||d.top=="auto")){b.setPosition(b.getPosition(c))}}if(b.getStyle("position")=="static"){b.setStyle("position","absolute")}}this.addEvent("start",this.checkDroppables,true);this.overed=null},start:function(a){if(this.container){this.options.limit=this.calculateLimit()}if(this.options.precalculate){this.positions=this.droppables.map(function(b){return b.getCoordinates()})}this.parent(a)},calculateLimit:function(){var l=this.element,f=this.container,d=document.id(l.getOffsetParent())||document.body,j=f.getCoordinates(d),c={},b={},m={},i={},o={};["top","right","bottom","left"].each(function(s){c[s]=l.getStyle("margin-"+s).toInt();b[s]=l.getStyle("border-"+s).toInt();m[s]=f.getStyle("margin-"+s).toInt();i[s]=f.getStyle("border-"+s).toInt();o[s]=d.getStyle("padding-"+s).toInt()},this);var g=l.offsetWidth+c.left+c.right,r=l.offsetHeight+c.top+c.bottom,k=0,n=0,q=j.right-i.right-g,a=j.bottom-i.bottom-r;if(this.options.includeMargins){k+=c.left;n+=c.top}else{q+=c.right;a+=c.bottom}if(l.getStyle("position")=="relative"){var p=l.getCoordinates(d);p.left-=l.getStyle("left").toInt();p.top-=l.getStyle("top").toInt();k-=p.left;n-=p.top;if(f.getStyle("position")!="relative"){k+=i.left;n+=i.top}q+=c.left-p.left;a+=c.top-p.top;if(f!=d){k+=m.left+o.left;n+=((Browser.ie6||Browser.ie7)?0:m.top)+o.top}}else{k-=c.left;n-=c.top;if(f!=d){k+=j.left+i.left;n+=j.top+i.top}}return{x:[k,q],y:[n,a]}},getDroppableCoordinates:function(c){var b=c.getCoordinates();if(c.getStyle("position")=="fixed"){var a=window.getScroll();b.left+=a.x;b.right+=a.x;b.top+=a.y;b.bottom+=a.y}return b},checkDroppables:function(){var a=this.droppables.filter(function(d,c){d=this.positions?this.positions[c]:this.getDroppableCoordinates(d);var b=this.mouse.now;return(b.x>d.left&&b.x<d.right&&b.y<d.bottom&&b.y>d.top)},this).getLast();if(this.overed!=a){if(this.overed){this.fireEvent("leave",[this.element,this.overed])}if(a){this.fireEvent("enter",[this.element,a])}this.overed=a}},drag:function(a){this.parent(a);if(this.options.checkDroppables&&this.droppables.length){this.checkDroppables()}},stop:function(a){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,a]);this.overed=null;return this.parent(a)}});Element.implement({makeDraggable:function(a){var b=new Drag.Move(this,a);this.store("dragger",b);return b}});Class.refactor=function(b,a){Object.each(a,function(f,d){var c=b.prototype[d];c=(c&&c.$origin)||c||function(){};b.implement(d,(typeof f=="function")?function(){var g=this.previous;this.previous=c;var i=f.apply(this,arguments);this.previous=g;return i}:f)});return b};Class.refactor(Drag,{attach:function(){this.handles.addEvent("touchstart",this.bound.start);return this.previous.apply(this,arguments)},detach:function(){this.handles.removeEvent("touchstart",this.bound.start);return this.previous.apply(this,arguments)},start:function(a){document.body.addEvents({touchmove:this.bound.check,touchend:this.bound.cancel});this.previous.apply(this,arguments)},check:function(a){if(this.options.preventDefault){a.preventDefault()}var b=Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-this.mouse.start.y,2)));if(b>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});document.body.addEvents({touchmove:this.bound.drag,touchend:this.bound.stop});this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element)}},cancel:function(a){document.body.removeEvents({touchmove:this.bound.check,touchend:this.bound.cancel});return this.previous.apply(this,arguments)},stop:function(a){document.body.removeEvents({touchmove:this.bound.drag,touchend:this.bound.stop});return this.previous.apply(this,arguments)}});(function(){Drag.Scroll=new Class({Implements:[Options,Events],options:{friction:5,axis:{x:true,y:true},boundDragToContainer:false},initialize:function(i,n){i=this.element=document.id(i);this.content=i.getFirst();this.setOptions(n);var b,c,f,k,d;var m=function(){var o=Date.now();k=[i.scrollLeft,i.scrollTop];if(b){var p=o-b+1;f=[1000*(k[0]-c[0])/p,1000*(k[1]-c[1])/p]}c=k;b=o};var g=this.fx=new Fx.Scroll(i,{transition:Fx.Transitions.Expo.easeOut});g.set.apply(g,this.limit(i.scrollLeft,i.scrollTop));var l=this;friction=this.options.friction,axis=this.options.axis;var j=this.drag=new Drag(i,{style:false,invert:true,modifiers:{x:axis.x&&"scrollLeft",y:axis.y&&"scrollTop"},onStart:function(){m();d=setInterval(m,1000/60);g.cancel()},onDrag:function(r,s){l.fireEvent("drag",r,s);if(!l.options.boundDragToContainer){return}var p=r.getSize();var u=r.getPosition();var q=-5;var o=this.mouse.now.x-u.x;var t=this.mouse.now.y-u.y;if(o<=q||o>=p.x-q||t<=q||t>=p.y-q){this.stop()}},onComplete:function(){b=false;clearInterval(d);g.start.apply(g,l.limit(k[0]+(f[0]||0)/friction,k[1]+(f[1]||0)/friction));l.fireEvent("complete")}})},getLimit:function(){var b=[[0,0],[0,0]],c=this.element;var d=Object.values(this.content.getStyles("padding-left","border-left-width","margin-left","padding-top","border-top-width","margin-top","width","height")).invoke("toInt");b[0][0]=a(d.slice(0,3));b[0][1]=d[6]+b[0][0]-c.clientWidth;b[1][0]=a(d.slice(3,6));b[1][1]=d[7]+b[1][0]-c.clientHeight;return b},limit:function(b,d){var c=this.getLimit();return[b.limit(c[0][0],c[0][1]),d.limit(c[1][0],c[1][1])]}});var a=function(d){var b=0;for(var c=d.length;c--;){b+=d[c]}return b}})();var md=md||{};md.widgets=md.widgets||{};md.widgets.Accordion=new Class({Implements:[Events,Options],options:{mode:"accordion",tabs:[]},initialize:function(b,a){this.el=b;this.setOptions(a);this["render-"+this.options.mode]()},"render-tabs":function(){var c={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",10:"ten",11:"eleven",12:"twelve"};var f=new Element("div",{"class":"header "+c[this.options.tabs.length]+"-tabs"}),b=new Element("div",{"class":"content"}),d,a;d=this.options.tabs.map(function(j,g){return new Element("div",{"class":"tab-title"+(g===0?" active":""),"data-index":g,html:"<p>"+j.title+"</p>"}).addEvent("click",function(k){var i=k.target.hasClass("tab-title")?k.target:k.target.getParents(".tab-title")[0];this.el.getElements(".tab-title, .tab-content").removeClass("active");i.addClass("active");this.el.getElements(".tab-content")[i.get("data-index")].addClass("active")}.bind(this))}.bind(this));a=this.options.tabs.map(function(j,g){return new Element("div",{"class":"tab-content"+(g===0?" active":""),html:j.content})});f.adopt(d);b.adopt(a);this.el.addClass("accordion-widget").empty().adopt(f,b)},"render-accordion":function(){var a=this.options.tabs.map(function(k,j){var n=new Element("div",{"class":"accordion-item"}),m=new Element("div",{"class":"accordion-title",html:k.title}),g=new Element("div",{"class":"accordion-content-wrapper"}),l=new Element("div",{"class":"accordion-content",html:k.content});m.addEvent("click",function(i){if(i.target.getParent(".accordion-item").hasClass("active")){i.target.getParent(".accordion-item").removeClass("active")}else{$(i.target).getParent(".accordion-item").addClass("active")}}.bind(this));g.adopt(l);return n.adopt(m,g)}.bind(this));var c=a.length;if(c>1){var b=new Element("div",{"class":"accordion-wrapper"});var f=new Element("div",{"class":"accordion-open-all",text:"Expand All"});var d=new Element("div",{"class":"accordion-close-all",text:"Collapse All"});f.addEvent("click",function(){this.el.getElements(".accordion-item").addClass("active")}.bind(this));d.addEvent("click",function(){this.el.getElements(".accordion-item").removeClass("active")}.bind(this));b.adopt(f,d);this.el.addClass("accordion-widget").empty().adopt(b,a)}else{this.el.addClass("accordion-widget").empty().adopt(a)}}});var md=md||{};md.widgets=md.widgets||{};md.widgets.AlternateSlider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(a){this.setKnobPosition(a)},initialStep:0,snap:false,offset:0,range:false,wheel:false,steps:100,mode:"horizontal"},initialize:function(g,a,f){this.setOptions(f);f=this.options;this.element=document.id(g);a=this.knob=document.id(a);this.previousChange=this.previousEnd=this.step=-1;var b={},d={x:false,y:false};switch(f.mode){case"vertical":this.axis="y";this.property="top";this.offset="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";this.offset="offsetWidth"}this.setSliderDimensions();this.setRange(f.range);if(a.getStyle("position")=="static"){a.setStyle("position","relative")}a.setStyle(this.property,-f.offset);d[this.axis]=this.property;b[this.axis]=[-f.offset,this.full-f.offset];var c={snap:0,limit:b,modifiers:d,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:(function(){this.isDragging=true}).bind(this),onCancel:function(){this.isDragging=false}.bind(this),onComplete:function(){this.isDragging=false;this.draggedKnob();this.end()}.bind(this)};if(f.snap){this.setSnap(c)}this.drag=new Drag(a,c);this.attach();if(f.initialStep!=null){this.set(f.initialStep)}},attach:function(){this.element.addEvent("mousedown",this.clickedElement);if(this.options.wheel){this.element.addEvent("mousewheel",this.scrolledElement)}this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},autosize:function(){this.setSliderDimensions().setKnobPosition(this.toPosition(this.step));this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset];if(this.options.snap){this.setSnap()}return this},setSnap:function(a){if(!a){a=this.drag.options}a.grid=this.stepWidth;a.limit[this.axis][1]=this.full;return this},setKnobPosition:function(a){if(this.options.snap){a=this.toPosition(this.step)}this.knob.setStyle(this.property,a);return this},setSliderDimensions:function(){this.full=this.element.measure(function(){this.half=this.knob[this.offset]/2;return this.element[this.offset]-this.knob[this.offset]+(this.options.offset*2)}.bind(this));return this},set:function(a){if(!((this.range>0)^(a<this.min))){a=this.min}if(!((this.range>0)^(a>this.max))){a=this.max}this.step=Math.round(a);return this.checkStep().fireEvent("tick",this.toPosition(this.step)).end()},setRange:function(a,b){this.min=Array.pick([a[0],0]);this.max=Array.pick([a[1],this.options.steps]);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.options.maxWidth/(this.steps-1);if(a){this.set(Array.pick([b,this.step]).floor(this.min).max(this.max))}return this},clickedElement:function(c){if(this.isDragging||c.target==this.knob){return}var b=this.range<0?-1:1,a=c.page[this.axis]-this.element.getPosition()[this.axis]-this.half;a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep().fireEvent("tick",a).end()},scrolledElement:function(a){var b=(this.options.mode=="horizontal")?(a.wheel<0):(a.wheel>0);this.set(this.step+(b?-1:1)*this.stepSize);a.stop()},draggedKnob:function(){var b=this.range<0?-1:1,a=this.drag.value.now[this.axis];a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep()},checkStep:function(){var a=this.step;if(this.previousChange!=a){this.previousChange=a;this.fireEvent("change",a)}return this},end:function(){var a=this.step;if(this.previousEnd!==a){this.previousEnd=a;this.fireEvent("complete",a+"")}return this},toStep:function(a){var b=(a+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.ceil(b):b},toPosition:function(a){return Math.abs(this.min-a)*this.stepWidth}});var md=md||{};md.media=md.media||{};md.media.AudioManager=new Class({Implements:[Options,Events],initialize:function(b){this.setOptions(b);this.map={};if(this.options.audioUrlAttr){var a="["+this.options.audioUrlAttr+"]";Array.each($$(a),function(d){var c=d.getAttribute(this.options.audioUrlAttr);if(!this.hasAudio(c)){this.addAudio(c);console.log("Audio registered. ",c)}}.bind(this))}},addAudio:function(a){this.map[a]=new Audio(a);this.map[a].addEventListener("ended",function(){console.log("audio playing ended "+a)})},hasAudio:function(a){return this.map[a]!=undefined},getAudio:function(a){if(this.hasAudio===undefined){throw ("no audio found with url: ",a)}return this.map[a]},addAndGetAudio:function(a){if(!this.hasAudio(a)){this.addAudio(a)}return this.getAudio(a)},play:function(b,c){var d=this.map[b];if(this.isPlaying()){if(this.playingAudio!=d){this.playingAudio.pause()}else{console.log("Not doing anything as Audio is already playing.");return}}var a=this;var f=function(){console.log("audio paused playing "+b);a.fireEvent("audiostopped",{url:b,audio:d,element:c});d.removeEventListener("pause",f);a.playingAudio=undefined};d.addEventListener("pause",f);console.log("playing "+b);d.play();this.playingAudio=d},isPlaying:function(a){if(a==undefined){return this.playingAudio!=undefined&&!this.playingAudio.paused}else{if(this.playingAudio!=undefined){return this.playingAudio==this.map[a]}return false}},pause:function(a){var b=this.map[a];b.pause()},stop:function(a){var b=this.map[a];b.stop()}});md.media.AudioTextBinding=new Class({Implements:[Options,Events],options:{elAudioAttr:"data-audio",embedded:{elStartTimeAttr:"data-audio-start-time",elStopTimeAttr:"data-audio-stop-time",elDuration:"data-audio-duration",elSelector:".audio-text"},activeClass:"active",playedClass:"played",embeddedConfig:false},dataList:[],initialize:function(a,d,b){if(!a){throw ("container is not defined")}if(!d){throw ("audioManager is not defined")}var c=a.getAttribute(this.options.elAudioAttr);if(!c){throw (this.options.elAudioAttr+" is compulsory attribute in Element")}this.container=a;this.setOptions(b);this.audio=d.addAndGetAudio(c);this.audio.addEventListener("timeupdate",this.audioStep.bind(this));this.audio.addEventListener("ended",this.cleanup.bind(this));if(this.options.embeddedConfig){this.setEmbeddedConfig()}else{this.setConfig()}},setEmbeddedConfig:function(){var a=this.container.getElements(this.options.embedded.elSelector);a.each(function(f){var b={};b.startTime=parseFloat(f.getAttribute(this.options.embedded.elStartTimeAttr));var c=f.getAttribute(this.options.embedded.elStopTimeAttr);var d=f.getAttribute(this.options.embedded.elDuration);if(c){b.stopTime=parseFloat(c)}else{b.duration=parseFloat(d)}b.active=false;b.el=f;this.dataList.push(b)}.bind(this))},setConfig:function(){if(!this.options.config){throw ("config option is not defined")}this.options.config.each(function(b){var a=b;a.active=false;a.el=this.container.getElements(b.selector);this.dataList.push(a)}.bind(this))},audioStep:function(b){var a=this.audio.currentTime;this.dataList.each(function(c){var d=c.stopTime;if(d==undefined){d=c.startTime+c.duration}if(a>c.startTime&&a<d){if(c.active===false){c.el.addClass(this.options.activeClass);c.active=true}}else{if(c.active===true){c.el.removeClass(this.options.activeClass);c.el.addClass(this.options.playedClass);c.active=false}}}.bind(this))},cleanup:function(){console.log("cleaning up Elements");this.dataList.each(function(a){a.el.removeClass(this.options.activeClass);a.el.removeClass(this.options.playedClass)}.bind(this))}});md.media.ui=md.media.ui||{};md.media.ui.AudioControl=new Class({Implements:[Options,Events],options:{elAudioAttr:"data-audio",playSelector:".ac-play",pauseSelector:".ac-stop",},initialize:function(a,c,b){this.setOptions(b);this.container=a;if(!a){throw ("container is not defined")}if(!c){throw ("audioManager is not defined")}this.audioUrl=a.getAttribute(this.options.elAudioAttr);if(!this.audioUrl){throw (this.options.elAudioAttr+" is compulsory attribute in Element")}this.audioManager=c;this.audio=c.addAndGetAudio(this.audioUrl);this.audio.addEventListener("ended",function(){this.resetControls()}.bind(this));this.playSelector=a.getElements(this.options.playSelector);this.pauseSelector=a.getElements(this.options.pauseSelector);this.resetControls();this.playSelector.addEvent("click",this.playHandler.bind(this));this.pauseSelector.addEvent("click",this.pauseHandler.bind(this))},resetControls:function(){this.pauseSelector.fade("hide");this.playSelector.fade("show")},playHandler:function(a){if(a){a.stop()}this.audioManager.play(this.audioUrl);this.pauseSelector.fade("show");this.playSelector.fade("hide");this.playing=true},pauseHandler:function(a){if(a){a.stop()}this.audioManager.pause(this.audioUrl);this.pauseSelector.fade("hide");this.playSelector.fade("show");this.playing=false}});md.media.ui.AudioControlOverlay=new Class({Extends:md.media.ui.AudioControl,initialize:function(b,d,a,c){this.parent(b,d,c);this.wrapper=a;this.wrapper.addEvent("click",this.containerClicked.bind(this))},containerClicked:function(a){a.stop();if(this.playing){this.pauseSelector.fade("in");setTimeout(function(){this.pauseSelector.fade("out")}.bind(this),600);this.container.fade("show");setTimeout(function(){this.audioManager.pause(this.audioUrl);this.playSelector.fade("in");this.playing=false}.bind(this),750)}},playHandler:function(a){this.parent(a);this.pauseSelector.fade("hide");this.container.fade("out")},pauseHandler:function(b,a){this.parent(b);this.container.fade("in")},resetControls:function(){this.parent();this.container.fade("in")},pause:function(){this.pauseHandler()}});var SmoothScroll=Fx.SmoothScroll=new Class({Extends:Fx.Scroll,options:{axes:["x","y"]},initialize:function(c,d){d=d||document;this.doc=d.getDocument();this.parent(this.doc,c);var f=d.getWindow(),a=f.location.href.match(/^[^#]*/)[0]+"#",b=$$(this.options.links||this.doc.links);b.each(function(i){if(i.href.indexOf(a)!=0){return}var g=i.href.substr(a.length);if(g){this.useLink(i,g)}},this);this.addEvent("complete",function(){f.location.hash=this.anchor;this.element.scrollTo(this.to[0],this.to[1])},true)},useLink:function(b,a){b.addEvent("click",function(d){var c=document.id(a)||this.doc.getElement("a[name="+a+"]");if(!c){return}d.preventDefault();this.toElement(c,this.options.axes).chain(function(){this.fireEvent("scrolledTo",[b,c])}.bind(this));this.anchor=a}.bind(this));return this}});var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(a){this.setKnobPosition(a)},initialStep:0,snap:false,offset:0,range:false,wheel:false,steps:100,mode:"horizontal"},initialize:function(g,a,f){this.setOptions(f);f=this.options;this.element=document.id(g);a=this.knob=document.id(a);this.previousChange=this.previousEnd=this.step=-1;var b={},d={x:false,y:false};switch(f.mode){case"vertical":this.axis="y";this.property="top";this.offset="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";this.offset="offsetWidth"}this.setSliderDimensions();this.setRange(f.range);if(a.getStyle("position")=="static"){a.setStyle("position","relative")}a.setStyle(this.property,-f.offset);d[this.axis]=this.property;b[this.axis]=[-f.offset,this.full-f.offset];var c={snap:0,limit:b,modifiers:d,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:(function(){this.isDragging=true}).bind(this),onCancel:function(){this.isDragging=false}.bind(this),onComplete:function(){this.isDragging=false;this.draggedKnob();this.end()}.bind(this)};if(f.snap){this.setSnap(c)}this.drag=new Drag(a,c);this.attach();if(f.initialStep!=null){this.set(f.initialStep)}},attach:function(){this.element.addEvent("mousedown",this.clickedElement);if(this.options.wheel){this.element.addEvent("mousewheel",this.scrolledElement)}this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},autosize:function(){this.setSliderDimensions().setKnobPosition(this.toPosition(this.step));this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset];if(this.options.snap){this.setSnap()}return this},setSnap:function(a){if(!a){a=this.drag.options}a.grid=Math.ceil(this.stepWidth);a.limit[this.axis][1]=this.full;return this},setKnobPosition:function(a){if(this.options.snap){a=this.toPosition(this.step)}this.knob.setStyle(this.property,a);return this},setSliderDimensions:function(){this.full=this.element.measure(function(){this.half=this.knob[this.offset]/2;return this.element[this.offset]-this.knob[this.offset]+(this.options.offset*2)}.bind(this));return this},set:function(a){if(!((this.range>0)^(a<this.min))){a=this.min}if(!((this.range>0)^(a>this.max))){a=this.max}this.step=Math.round(a);return this.checkStep().fireEvent("tick",this.toPosition(this.step)).end()},setRange:function(a,b){this.min=Array.pick([a[0],0]);this.max=Array.pick([a[1],this.options.steps]);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.stepSize*this.full/Math.abs(this.range);if(a){this.set(Array.pick([b,this.step]).floor(this.min).max(this.max))}return this},clickedElement:function(c){if(this.isDragging||c.target==this.knob){return}var b=this.range<0?-1:1,a=c.page[this.axis]-this.element.getPosition()[this.axis]-this.half;a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep().fireEvent("tick",a).end()},scrolledElement:function(a){var b=(this.options.mode=="horizontal")?(a.wheel<0):(a.wheel>0);this.set(this.step+(b?-1:1)*this.stepSize);a.stop()},draggedKnob:function(){var b=this.range<0?-1:1,a=this.drag.value.now[this.axis];a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep()},checkStep:function(){var a=this.step;if(this.previousChange!=a){this.previousChange=a;this.fireEvent("change",a)}return this},end:function(){var a=this.step;if(this.previousEnd!==a){this.previousEnd=a;this.fireEvent("complete",a+"")}return this},toStep:function(a){var b=(a+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(b-=b%this.stepSize):b},toPosition:function(a){return(this.full*Math.abs(this.min-a))/(this.steps*this.stepSize)-this.options.offset}});var md=md||{};md.widget=md.widget||{};md.widget.PictureSlider=new Class({Implements:[Options,Events],options:{duration:"short",center:true,caption:{opacity:0.8,duration:"short"},text:{duration:200}},initialize:function(c,a,b){this.setOptions(b);var d=this;this.images=[];this.current=null;this.obj=c;c.addClass("picture-slider");this.width=c.getStyle("width").toInt();this.height=c.getStyle("height").toInt();this.sheet=new Element("div");this.sheet.addClass("ps-sheet");this.sheet.setStyle("width",this.width);this.sheet.setStyle("height",this.height);c.appendChild(this.sheet);a.each(function(f){d.appendImage(f)});this.caption=new Element("div");this.caption.addClass("ps-caption");this.caption.setStyle("height",0);this.caption.setStyle("opacity",this.options.caption.opacity);this.caption.p=new Element("p");this.caption.p.set("tween",{duration:this.options.caption.duration});this.caption.appendChild(this.caption.p);this.obj.appendChild(this.caption);this.kb=null;if(typeof Keyboard!="undefined"){this.kb=new Keyboard({defaultEventType:"keydown",events:{left:function(){d.left()},right:function(){d.right()}}});this.kb.activate()}this.switchTo(0)},switchTo:function(b){if(!(b>=0&&b<this.images.length)){return this.current}this.current=this.images[b];var a=new Fx.Tween(this.sheet,{duration:this.options.duration,property:"left"});a.start(-b*this.width);this.setCaption(this.current.caption);this.n=b;this.fireEvent("change",this.current);return this.current},left:function(){return this.switchTo(this.n-1)},right:function(){return this.switchTo(this.n+1)},appendImage:function(d){var b;if(d.link){b=new Element("a");b.href=d.link}else{b=new Element("div")}b.addClass("ps-frame");b.setStyle("left",this.width*this.images.length);b.setStyle("width",this.width);b.setStyle("height",this.height);this.sheet.appendChild(b);var a=this.options.center;if(typeof d.center!="undefined"){a=d.center}if(d.src){var f=new Element("img");f.addClass("ps-frame-image");f.src=d.src;b.appendChild(f);var i=this;f.addEvent("load",function(){if(f.width/f.height>i.width/i.height){f.width=i.width}else{f.height=i.height}if(a){f.setStyle("top",(i.height-f.height)/2)}})}if(d.content){var j=new Element("div");j.addClass("ps-frame-content");b.appendChild(j);if(typeof d.content=="string"){j.set("html",d.content)}var l=j.getStyle("width").toInt();var c=j.getStyle("padding-left").toInt()+j.getStyle("padding-right").toInt();var m=j.getStyle("margin-left").toInt()+j.getStyle("margin-right").toInt();j.setStyle("left",(this.width-l-c-m)/2);if(a){var g=j.getStyle("height").toInt();var c=j.getStyle("padding-top").toInt()+j.getStyle("padding-bottom").toInt();var m=j.getStyle("margin-top").toInt()+j.getStyle("margin-bottom").toInt();var k=(this.height-g-c-m)/2;if(k>0){j.setStyle("top",(this.height-g-c-m)/2)}}}this.images.push(d)},setCaption:function(c){var b=new Fx.Tween(this.caption,{duration:this.options.text.duration,property:"height",link:"chain"});if(c){var d=this;b.addEvent("complete",function(){d.caption.p.innerHTML=c;d.caption.p.fade(1)});this.caption.p.fade(0);var a=new Element("div");a.addClass("ps-caption");a.setStyle("visibility","hidden");a.p=new Element("p");a.p.innerHTML=c;a.appendChild(a.p);this.obj.appendChild(a);h=a.getStyle("height");this.obj.removeChild(a);b.start(h)}else{this.caption.p.innerHTML="";this.caption.p.fade(0);b.start(0)}}});md.widget.ImageCompareWidget=new Class({Implements:[Options,Events],options:{knobClass:".md-knob",sliderClass:".md-slider",frontImageWrapperClass:".front-img-wrapper",imgContainerClass:".img-container",initialPosition:0},initialize:function(a,c){this.setOptions(c);var g=a.getElements(this.options.sliderClass)[0];var f=a.getElements(this.options.knobClass)[0];var i=a.getElements(this.options.frontImageWrapperClass)[0];var b=a.getElements(this.options.imgContainerClass)[0];var j=b.getWidth()*this.options.initialPosition/100;var d=new Slider(g,f,{range:[0,b.getWidth()],initialStep:j,onChange:function(k){if(k!==undefined){console.log("width changed to "+k);i.setStyle("width",k+"px")}}})}});md.widget.ImageSliderWidget=new Class({Implements:[Options,Events],options:{knobClass:".md-knob",sliderClass:".md-slider",imgContainerClass:".img-container"},initialize:function(b,a,c){this.setOptions(c);var f=new md.widget.PictureSlider(b.getElements(this.options.imgContainerClass)[0],a);var i=b.getElements(this.options.sliderClass)[0];var g=b.getElements(this.options.knobClass)[0];var d=new Slider(i,g,{range:[0,4],initialStep:0,onChange:function(j){if(j!=undefined){f.switchTo(j)}}})}});var md=md||{};md.HtmlTransformer=new Class({Implements:[Options,Events],options:{copy:true,stripBR:true},initialize:function(d,c,b,a){this.setOptions(a);this.srcEl=d;this.dest=c;this.mapping=b;if(this.dest&&this.dest.template){this.fetchTemplate()}},fetchTemplate:function(){this.templateEl=this.dest.template.el.clone().getChildren();this.fireEvent("templateLoaded",{elements:this.templateEl})},transform:function(){if(this.templateEl==undefined||this.srcEl==undefined||this.dest==undefined){return}if(this.dest.template&&this.templateEl===undefined){var a=this.addEvent("templateLoaded",function(){this._transform();console.log("remove handle here",a)}.bind(this))}else{this._transform()}},_transform:function(){if(this.dest.template){this.dest.destinationEl.empty();this.dest.destinationEl.adopt(this.templateEl)}Object.each(this.mapping,function(b,a){this._replaceBlock(b,a)}.bind(this))},_replaceBlock:function(b,a){var c=Array.map(this.srcEl.getElement(a).getChildren(),function(f){if(this.options.copy){f=f.clone()}if(this.options.stripBR){var d=f.getElements("br");d.destroy();if(f.match("br")){f.destroy();return undefined}}return f}.bind(this));this.dest.destinationEl.getElement(b).adopt(c)}});md.HtmlTransformerEx=new Class({Extends:md.HtmlTransformer,_transform:function(){if(this.srcEl==undefined||this.dest==undefined){return}if(this.dest.template){this.dest.destinationEl.empty();this.dest.destinationEl.adopt(this.templateEl)}Object.each(this.options.properties,function(c){var b=this.srcEl.getElement(c.srcClass).clone();Array.each(b.getElements("a[data-trigger='ShowPopup']"),function(d){var f=new Element("span");f.innerHTML=d.innerHTML;f.replaces(d)});if(c.stripBR!==undefined&&c.stripBR==false){}else{if(this.options.stripBR||c.stripBR){var a=b.getElements("br");a.destroy();if(b.match("br")){b.destroy()}}}this.dest.destinationEl.innerHTML=this.dest.destinationEl.innerHTML.replace("{{"+c.placeholder+"}}",b.innerHTML)}.bind(this))},});md.ModalContent=new Class({Implements:[Options],options:{template:'<div><div class="modal-header"></div><div class="modal-body"></div><div class="modal-footer"><a class="close btn primaryb">Close</a></div></div>',mappings:{".recipe-header":".modal-header",".recipe-body":".modal-body"}},initialize:function(c,d,b){this.setOptions(b);var a=new md.HtmlTransformer(c,{destinationEl:d,template:{el:Elements.from(this.options.template)[0],}},this.options.mappings,this.options);a.transform()}});md.TemplateContent=new Class({Implements:[Options],options:{stripBR:true},initialize:function(d,c,f,b){this.setOptions(b);var g=$$(d);if(g==undefined||g.length==0){return}var a=new md.HtmlTransformerEx(c,{destinationEl:f,template:{el:$$(d)[0],}},this.options.mappings,this.options);a.transform()}});var md=md||{};md.widgets=md.widgets||{};md.widgets.TextSizeWidget=new Class({INVALID_TAGS:["AUDIO","VIDEO","IMG","BR","HR"],INVALID_CLASSES:["chaucer-widget-item"],Implements:[Options],options:{target:null,defaultSize:12,incrementPerc:10,widgetContainerClass:"text-zoom-controls",widgetZoomInClass:"zoom-in",widgetZoomOutClass:"zoom-out",widgetZoomResetClass:"zoom-reset",createEl:true},originalSize:undefined,initialize:function(i,d){this.el=i;this.setOptions(d);this.target=document.body;if(this.options.target){this.target=this.options.target}if(this.options.createEl){var b=new Element("div",{"class":this.options.widgetContainerClass});var g=new Element("div",{text:"+","class":this.options.widgetZoomInClass+" zoom-action"});var a=new Element("div",{text:"-","class":this.options.widgetZoomOutClass+" zoom-action"});var c=new Element("div",{text:"0","class":this.options.widgetZoomResetClass+" zoom-action"});var f=new Element("div",{style:"clear: both"});b.adopt(g,a,c,f);this.el.empty();this.el.adopt(b)}else{b=this.el.getElements("."+this.options.widgetContainerClass);g=this.el.getElements("."+this.options.widgetZoomInClass);a=this.el.getElements("."+this.options.widgetZoomOutClass);c=this.el.getElements("."+this.options.widgetZoomResetClass)}g.addEvent("click",function(j){j.preventDefault();this.changeFontSize(this.target,true)}.bind(this));a.addEvent("click",function(j){j.preventDefault();this.changeFontSize(this.target,false)}.bind(this));c.addEvent("click",function(j){j.preventDefault();this.resetFontSize(this.target)}.bind(this))},resetFontSize:function(a){var b=a.getAttribute("data-ori-font-size");if(b){console.log("Changed to original size: "+b+", el:",a);a.setStyle("font-size",b)}a.getChildren().each(function(c){this.resetFontSize(c)}.bind(this))},changeFontSize:function(d,i){var a=this.INVALID_TAGS.contains(d.tagName);var b=this.INVALID_CLASSES.some(function(j){return d.hasClass(j)||d.getParent("."+j)});d.getChildren().each(function(j){this.changeFontSize(j,i)}.bind(this));if(a){return}var g=oriSize=d.getStyle("font-size");if(b){d.setStyle("font-size",g);return}if(!d.hasAttribute("data-ori-font-size")){d.setAttribute("data-ori-font-size",g)}var f="%";if(g.indexOf("%")>=0){g=g.substr(0,g.length-1)}else{f=g.substr(g.length-2,g.length);g=g.substr(0,g.length-2)}g=parseFloat(g);var c=g*this.options.incrementPerc/100;if(i){g=g+c}else{g=g-c}d.setStyle("font-size",g+f);console.log("changed size to "+(g+f)+" from "+oriSize+", el:",d)}});md.widgets.Tabs=new Class({Implements:Events,initialize:function(b,c,a){this.tabs=b;this.contents=c;if(!a){a={}}this.css=a.selectedClass||"selected";this.select(this.tabs[0]);b.each(function(d){d.addEvent("click",function(f){this.select(d);f.stop()}.bind(this))}.bind(this))},select:function(a){this.tabs.removeClass(this.css);a.addClass(this.css);this.contents.setStyle("display","none");var b=this.contents[this.tabs.indexOf(a)];b.setStyle("display","block");this.fireEvent("change",[b,a])}});md.widgets.Timeline=new Class({initialize:function(a){new Drag.Scroll(a,{axis:{x:true,y:false}})}});md.widgets.ImageMap=new Class({Implements:[Events,Options],options:{defaultZoom:100,defaultX:0,defaultY:0,zoomStep:10,minZoom:0,maxZoom:250,left:0,top:0,wrapperEl:null,imageEl:null,controlsEl:null,imageUrl:null,showZoomControls:true,boundDragToContainer:false,showNavigator:false,updateNavigatorImmediately:true},currentZoom:null,wrapper:null,image:null,controlsWrapper:null,initialize:function(d,b){this.el=d;this.setOptions(b);var a=!b.wrapperEl;if(a){this.setupDom()}this.wrapper=this.options.wrapperEl;this.image=this.options.imageEl;if(this.options.showNavigator){this.addNavigator()}this.controlsWrapper=this.options.controlsEl;this.addControls();if(!a){this.attachBehavior()}var c;if(this.options.defaultZoom=="autofit"){this.options.imageEl.addEvent("load",function(){c=this.image.naturalHeight/this.image.naturalWidth;this.setZoom(this.el.getSize().x*c)}.bind(this))}},addNavigator:function(){this.navigator=this.options.navigatorEl;this.navigatorImage=this.image.clone();this.navigatorImage.setStyles({width:"100%"});this.navigator.adopt(this.navigatorImage);this.navigatorArea=new Element("div",{"class":"navigator-view-area"});this.navigator.adopt(this.navigatorArea);this.navigatorArea.makeDraggable({container:this.navigator,onDrag:function(){if(this.options.updateNavigatorImmediately){this.positionImageArea()}}.bind(this),onComplete:function(){this.positionImageArea()}.bind(this)})},getNavigationRatio:function(){return this.image.width/this.navigator.getSize().x},positionNavigatorArea:function(){var c=this.getNavigationRatio();var b=this.wrapper.getSize();var a=(b.y/c);var d=this.navigatorImage.height>a?this.navigatorImage.height:a;this.navigator.setStyle("height",d+"px");this.navigatorArea.setStyles({top:(this.wrapper.scrollTop/c)+"px",left:(this.wrapper.scrollLeft/c)+"px",width:(b.x/c)+"px",height:(b.y/c)+"px"})},positionImageArea:function(){var b=this.getNavigationRatio();var a=this.navigatorArea.getPosition(this.navigator);this.wrapper.scrollTo(a.x*b,a.y*b)},attachBehavior:function(){this.setZoom(this.options.defaultZoom);this._resetDrag();this.wrapper.scrollTo(this.options.left,this.options.top)},setupDom:function(){this.el.empty();this.options.wrapperEl=new Element("div",{"class":"imagemap-wrapper"});var a=this.el.getSize();this.options.wrapperEl.setStyles({position:"relative",overflow:"hidden",height:a.y+"px"});if(!this.options.showNavigator){this.options.wrapperEl.setStyles({width:a.x+"px"})}else{this.el.addClass("navigator-enabled")}this.options.imageEl=new Element("img",{src:this.options.imageUrl});this.options.imageEl.addEvent("load",function(){this.attachBehavior();if(this.image.naturalWidth<this.image.naturalHeight&&this.el.getSize().x<this.el.getSize().y){this.options.minZoom=this.el.getSize().x/this.image.naturalWidth*this.image.naturalHeight}if(this.options.showNavigator){this.positionNavigatorArea()}}.bind(this));this.options.wrapperEl.adopt(this.options.imageEl);this.options.controlsEl=new Element("div");var b=new Element("div",{"class":"widget-imagemap-wrapper"});b.adopt(this.options.wrapperEl);if(this.options.showNavigator){this.options.navigatorEl=new Element("div",{"class":"imagemap-navigator"});b.adopt(this.options.navigatorEl)}b.adopt(this.options.controlsEl);this.el.adopt(b)},addControls:function(){var a=function(d,b){var c=new Element("div",{"class":"map-control",text:d});c.addEvent("click",function(g){g.stop();var f=this.currentZoom;if(b){f=f+this.options.zoomStep}else{f=f-this.options.zoomStep}this.setZoom(f)}.bind(this));return c}.bind(this);this.controlsWrapper.addClass("map-controls-container");this.controlsWrapper.adopt(a("+",true));this.controlsWrapper.adopt(a("-",false));this.controlsWrapper.adopt(new Element("div",{"class":"map-control",html:"&#8635;",style:"margin-top: 5px",events:{click:function(b){this.setZoom(this.options.defaultZoom);this.wrapper.scrollTop=0;this.wrapper.scrollLeft=0;this.positionNavigatorArea()}.bind(this)}}));if(!this.options.showZoomControls){this.controlsWrapper.setStyle("display","none")}},_resetZoom:function(){var f=this.image.getSize();var d=this.el.getSize().x<this.el.getSize().y;var b=this.currentZoom;var a=this.currentZoom;if(d){b=a*this.image.naturalWidth/this.image.naturalHeight}else{a=b*this.image.naturalHeight/this.image.naturalWidth}var c=Math.floor(a-f.y)/2;var j=Math.floor(b-f.x)/2;var g=this.wrapper.scrollTop;var i=this.wrapper.scrollLeft;this.image.setStyle("width",b+"px");this.image.setStyle("height",a+"px");this.wrapper.scrollTop=g+c;this.wrapper.scrollLeft=i+j;if(this.options.showNavigator){this.positionNavigatorArea()}},setZoom:function(a){if(a>this.options.maxZoom){this.currentZoom=this.options.maxZoom}else{if(a<this.options.minZoom){this.currentZoom=this.options.minZoom}else{this.currentZoom=a}}this._resetZoom()},setPan:function(a,b){this.wrapper.scrollTo(a,b)},_resetDrag:function(){if(this.drag){this.drag.drag.detach()}this.drag=new Drag.Scroll(this.wrapper,{axis:{x:true,y:true},boundDragToContainer:this.options.boundDragToContainer,onDrag:function(){if(this.options.showNavigator&&this.options.updateNavigatorImmediately){this.positionNavigatorArea()}}.bind(this),onComplete:function(){if(this.options.showNavigator){this.positionNavigatorArea()}}.bind(this)})}});(function(a){Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var b=0,c=this.length;if(c){while(c--){b+=this[c]}}return b},unique:function(){return[].combine(this)},shuffle:function(){for(var c=this.length;c&&--c;){var b=this[c],d=Math.floor(Math.random()*(c+1));this[c]=this[d];this[d]=b}return this},reduce:function(d,f){for(var c=0,b=this.length;c<b;c++){if(c in this){f=f===a?this[c]:d.call(null,f,this[c],c,this)}}return f},reduceRight:function(c,d){var b=this.length;while(b--){if(b in this){d=d===a?this[b]:c.call(null,d,this[b],b,this)}}return d}})})();var md=md||{};md.dragdrop=md.dragdrop||{};md.dragdrop.ResultManager=new Class({Implements:[Options,Events],options:{container:undefined,show:false,correctCountSelector:".correct span",incorrectCountSelector:".incorrect span"},initialize:function(a,b){if(typeOf(a)!="number"){throw ("questionCount must be number. received: "+a)}this.questionCount=a;this._correctCount=0;this._incorrectCount=0;this.setOptions(b)},setView:function(a,b){if(this.options.show&&this.options.container!=undefined){this.options.container.getElement(a).set("text",b)}},incrementCorrect:function(){this._correctCount++;this.setView(this.options.correctCountSelector,this._correctCount);if(this._correctCount==this.questionCount){this.fireEvent("allQuestionsCorrect",{correctPercentage:this.getCorrectPercentage()})}},incrementIncorrect:function(){this._incorrectCount++;this.setView(this.options.incorrectCountSelector,this._incorrectCount)},getCorrectPercentage:function(){var a=this._correctCount+this._incorrectCount;return this.questionCount/a*100}});md.dragdrop.BaseGame=new Class({Implements:[Options,Events],options:{correctClass:"correct",incorrectClass:"incorrect",hoverClass:"dragHover",finishMsgSelector:".finishMsg",errorAudioPath:"../Audio/error.m4a",isCorrectCheck:undefined,result:{}},initialize:function(b,a){this.reflowable=document.body.hasClass("book-type-reflowable")&&!(window.parent&&window.parent.Lindgren);if(this.reflowable){this.refactorDrag()}if(typeOf(a)=="null"||typeOf(a.draggables)=="null"||typeOf(a.droppables)=="null"||typeOf(a.draggablesContainer)=="null"){throw ("options.draggables & options.droppables & options.draggablesContainer are compulatory options.")}this.setOptions(a);if(this.options.errorAudioPath!==undefined){this.errorAudio=new Audio(this.options.errorAudioPath)}this.setupDraggables()},refactorDrag:function(){Class.refactor(Drag,{start:function(a){a.page=a.client;this.previous(a)},drag:function(a){a.page=a.client;this.previous(a)}})},startDragHandler:function(a){return function(i){var d=a;i.stop();var b=this;var j={left:b.getLeft(),top:b.getTop(),width:b.getComputedStyle("width"),height:b.getComputedStyle("height")};var k=b.clone().setStyles(j).setStyles({opacity:0.7,position:"absolute","z-index":11000}).inject(d.options.draggablesContainer);k.orig=b;var c=d.options.appContainer||$$("body"),f={container:c,droppables:d.options.droppables,onDrop:d._onDropHandler.bind(d),onEnter:d.onEnterHandler.bind(d),onLeave:d.onLeaveHandler.bind(d),onCancel:d.onCancelHandler.bind(d)};if(d.reflowable){f.onDrag=function(l,m){l.setStyle("top",m.event.pageY)}}var g=new Drag.Move(k,f);g.start(i);a.fireEvent("dragStarted",{draggable:k})}},setupDraggables:function(){this.options.draggables.addEvent("mousedown",this.startDragHandler(this));this.options.draggables.addEvent("touchstart",this.startDragHandler(this))},makeDraggable:function(a){this.options.draggables.push(a);a.addEvent("mousedown",this.startDragHandler(this));a.addEvent("touchstart",this.startDragHandler(this))},removeDraggable:function(a){Array.erase(this.options.draggables,a);a.removeEvents("mousedown");a.removeEvents("touchstart")},resetDummy:function(a){a.destroy()},onCancelHandler:function(a){this.resetDummy(a);this.fireEvent("dragEnded",{draggable:a})},onEnterHandler:function(a,b){b.addClass(this.options.hoverClass)},onLeaveHandler:function(a,b){b.removeClass(this.options.hoverClass)},_onDropHandler:function(b,c){if(this.reflowable){var a=Math.abs;c=this.options.droppables.map(function(f){var d=Object.merge(f.getCoordinates(),b.getPosition(f));return{x:d.x,y:d.y,w:d.width,h:d.height,el:f}}).filter(function(d){return a(d.x)<d.w&&a(d.y)<d.h}).reduce(function(f,d){if(f.el===null){return d}return(a(f.x)+a(f.y)<a(d.x)+a(d.y))?f:d},{el:null}).el}this.fireEvent("dragEnded",{draggable:b,droppable:c});this.onDropHandler(b.orig,c);this.resetDummy(b)},onDropHandler:function(a,b){}});md.dragdrop.MatchingGame=new Class({Extends:md.dragdrop.BaseGame,initialize:function(b,a){this.parent(b,a);this.resultManager=new md.dragdrop.ResultManager(this.options.draggables.length,this.options.result);this.resultManager.addEvent("allQuestionsCorrect",function(c){$$(this.options.finishMsgSelector).getElement("span").set("text",Math.round(c.correctPercentage)+"%");$$(this.options.finishMsgSelector).fade("in")}.bind(this));this.addEvents({dragStarted:function(d){var c=d.draggable.orig;c.setAttribute("data-origDisplay",c.getStyle("display"));c.setStyle("display","none")},dragEnded:function(c){c.draggable.orig.setStyle("display",c.draggable.orig.getAttribute("data-origDisplay"))}})},onDropHandler:function(a,d){if(d){var c=false;if(this.options.isCorrectCheck!==undefined){c=this.options.isCorrectCheck(a,d)}else{c=a.get("data-textid")!=undefined&&a.get("data-textid")===d.get("data-textid")}if(c){a.destroy();this.options.droppables.removeClass(this.options.incorrectClass);d.addClass(this.options.correctClass);a.removeClass(this.options.incorrectClass);this.options.droppables.erase(d);if(d.getElement("span")!==null&&d.getElement("span").hasAttribute("data-ibooks-audio-src")){var b=new Audio(d.getElement("span").getAttribute("data-ibooks-audio-src"));b.play()}this.resultManager.incrementCorrect();if(this.options.correctHandler){this.options.correctHandler(a,d)}}else{a.addClass(this.options.incorrectClass);d.addClass(this.options.incorrectClass);if(this.errorAudio){this.errorAudio.play()}this.resultManager.incrementIncorrect();if(this.options.incorrectHandler){this.options.incorrectHandler(a,d)}}this.onLeaveHandler(a,d)}}});md.dragdrop.CollectionGame=new Class({Extends:md.dragdrop.BaseGame,initialize:function(b,a){this.parent(b,a);this.dropCount=0;this.addEvents({dragStarted:function(c){c.draggable.addClass("drag");c.draggable.orig.addClass("active")},dragEnded:function(c){c.draggable.orig.removeClass("active")}})},onDropHandler:function(a,d){if(d&&this.options.dropLimit>this.dropCount){var b=false;if(this.options.isCorrectCheck!==undefined){b=this.options.isCorrectCheck(a,d)}else{b=a.get("data-textid")!==undefined&&a.get("data-textid")===d.get("data-textid")}if(b){if(this.options.correctHandler){var c=this.options.correctHandler.bind(this);c(a,d)}this.dropCount++}this.onLeaveHandler(a,d)}else{if(this.options.dropLimit<=this.dropCount){window.alert("House is full ("+this.dropCount+" members). Time for somebody to sleep outside.")}}}});md.dragdrop.Quiz=new Class({Implements:[Options],options:{reverse:false,minHeight:"100px",score:false,instructions:"Drag the answers in the right column to the corresponding items on the left."},initialize:function(d,a,b){this.el=d;var c=[];var f=[];this.questionMapping={};this.reflowable=document.body.hasClass("book-type-reflowable")&&!(window.parent&&window.parent.Lindgren);this.setOptions(b);a.each(function(i){if(this.options.reverse){var j=i.answer;var g=i.question}else{var j=i.question;var g=i.answer}c.push(j);f.push(g);this.questionMapping[j]=g}.bind(this));if(c.length!==c.unique().length){throw ("Questions has duplicate question, There should not be any duplicate questions")}this.questions=c;this.answers=f.shuffle();this.createDOM();this.makeDrag();if(this.options.score){this.incorrectAnswers=0;this.correctAnswers=0}},makeDrag:function(){var a={draggables:this.el.getElements(".draggable"),droppables:this.el.getElements(".droppable"),draggablesContainer:this.reflowable?this.el.getElement(".draggable-container"):$$("body")[0],correctHandler:function(b,c){c.adopt(b.clone());b.destroy();if(this.options.score){this.correctAnswers+=1;this.el.getElement(".dragdropquiz-correct-score").set("text",this.correctAnswers)}}.bind(this),incorrectHandler:function(){if(this.options.score){this.incorrectAnswers+=1;this.el.getElement(".dragdropquiz-incorrect-score").set("text",this.incorrectAnswers)}}.bind(this)};if(this.reflowable){a.appContainer=this.el.getElement(".dragdropquiz-container")}new md.dragdrop.MatchingGame(this.el,a)},reset:function(a){a.stop();this.createDOM();this.makeDrag();if(this.options.score){this.incorrectAnswers=0;this.correctAnswers=0}},createDOM:function(){var b=new Element("div",{"class":"dragdropquiz-container"}),i=new Element("div",{"class":"dragdropquiz-instructions",text:this.options.instructions}),d=new Element("div",{"class":"dragdropquiz-reset-wrapper"}),l=new Element("button",{"class":"dragdropquiz-reset btn",text:"Reset",events:{click:this.reset.bind(this)}});b.adopt(i);if(this.options.score){var c=new Element("div",{"class":"dragdropquiz-score"}),k=new Element("div",{html:'<span class="correct-label">Correct</span>'}),a=new Element("div",{"class":"dragdropquiz-correct-score",text:"0"}),f=new Element("div",{html:'<span class="incorrect-label">Incorrect</span>'}),g=new Element("div",{"class":"dragdropquiz-incorrect-score",text:"0"});b.adopt(c.adopt(k.adopt(a),f.adopt(g)))}var j=new Element("div",{"class":"draggable-container",styles:{"min-height":this.options.minHeight}});this.questions.each(function(n){var o=new Element("div",{"class":"question-wrapper"});o.adopt(new Element("div",{"class":"draggable question chaucer smartwidget","data-textid":this.questionMapping[n],text:n}));j.adopt(o)}.bind(this));var m=new Element("div",{"class":"droppable-container"});this.answers.each(function(o){var p=new Element("div",{text:o});var q=new Element("div",{"class":"droppable","data-textid":o});var n=new Element("div",{"class":"answer"});n.adopt([p,q]);m.adopt(n)}.bind(this));d.adopt(l);b.adopt(m,j,d.adopt(l));this.el.empty();this.el.adopt(b);if(this.reflowable){b.setStyle("position","relative");this.el.getParent().addClass("page-break")}}});var md=md||{};md.BibleNotes=new Class({Implements:[Options],options:{startsWith:"c",separator:"_",useParent:true,wrapWithDiv:true},initialize:function(b,a){this.setOptions(a);Array.each(b,function(d){if(d.starting.chapter>d.ending.chapter){if(console.error){console.error("starting chapter can not be greater than ending chapter",d)}return}var w=this.options.startsWith+d.starting.chapter+this.options.separator+d.starting.verse;var v=$(w);var k;var i=this.options.startsWith+d.ending.chapter+this.options.separator+d.ending.verse;var m=$(i);var o;if(v==null||v==undefined||m==null||m==undefined){console.error?console.error("start or end node not available, start=",v,", end=",m):console.log("start or end node not available","start=",v,", end=",m);return}if(this.options.useParent){o=m.parentNode;k=v.parentNode}var s=new Element("a",{href:"javascript:",html:d.linkText});o.appendChild(s);var g;var l=new Element("div",{"class":"tooltip"});var t=new Element("div",{"class":"close",title:"Close"});t.injectBottom(l);var y=new Element("span",{"class":"title"}).injectBottom(l);y.innerHTML=d.title;var q=new Element("div",{"class":"content"}).injectBottom(l);q.innerHTML=d.contents;s.addEvent("click",function(z){z.stop();l.show();if(g){g.addClass("active")}});t.addEvent("click",function(z){z.stop();l.hide();if(g){g.removeClass("active")}});if(this.options.wrapWithDiv){var c=k.previousElementSibling;g=new Element("div",{"class":"wrapper"});if(c.id=="c"+d.starting.chapter){g.injectBefore(c)}else{g.injectBefore(k)}for(chapter=d.starting.chapter;chapter<=d.ending.chapter;chapter++){var u=d.starting.verse,r=0;if(chapter!=d.ending.chapter){r=999}else{r=d.ending.verse}for(verse=u;verse<=r;verse++){var j=this.options.startsWith+chapter+this.options.separator+verse;var p=$(j);var f;if(p!=null&&p!=undefined){if(this.options.useParent){f=p.parentNode}var n=f.previousElementSibling;if(verse==1){if(n!=g){n.injectBottom(g)}}else{var x=n.tagName.toLowerCase();if(x!="div"&&x!="p"){n.injectBottom(g)}}f.injectBottom(g)}}}l.injectBottom(g)}else{l.injectAfter(o)}}.bind(this))}});var md=md||{};md.util=md.util||{};md.util.Flash=new Class({Implements:[Options,Events],options:{containerSelector:"body",type:"info",time:5000,position:"top",width:"570px"},initialize:function(a){this.setOptions(a)},show:function(b,a){if(!a){a=this.options.type}if(this.flashDiv){this.destroy()}this.flashDiv=new Element("div",{"class":"alert-message flash",styles:{width:this.options.width}}).inject($$(this.options.containerSelector)[0]);this.flashDiv.addClass(a);this.flashDiv.show().innerHTML+="<p>"+b+"</p>";if(this.options.position=="center"){this._center(this.flashDiv)}clearTimeout(this.flashTimer);this.flashTimer=this.destroy.bind(this).delay(this.options.time)},_center:function(a){a.setStyles({left:"50%",top:"50%",position:"absolute","margin-left":-a.getComputedSize().width/2,"margin-top":-a.getComputedSize().height/2})},destroy:function(){if(this.flashDiv){this.flashDiv.destroy();this.flashDiv=null}}});var md=md||{};md.widgets=md.widgets||{};md.widgets.FlashCards=new Class({Implements:[Options],initialize:function(a,b){this.el=$(a);this.reflowable=document.body.hasClass("book-type-reflowable")&&!(window.parent&&window.parent.Lindgren);this.questions=b.questionSet||[];this.options=b;this.render();this.wire()},swap:function(a){a.stop();this.el.getElements(".card").forEach(function(b){b.insertBefore(b.children[1],b.children[0])})},toggle:function(a){a.stop();this.el.getElements(".card.active").toggleClass("show");a.target.hasClass("show")?a.target.removeClass("show").addClass("hide"):a.target.removeClass("hide").addClass("show")},next:function(c){c.stop();var a=this.el.getElement(".card.active"),b=a.getNext(".card")||this.el.getElement(".card:first-of-type");this.reset(a);a.removeClass("active").removeClass("show");b.addClass("active")},prev:function(b){b.stop();var a=this.el.getElement(".card.active"),c=a.getPrevious(".card")||this.el.getElement(".card:last-of-type");this.reset(a);a.removeClass("active");c.addClass("active")},reset:function(b){b.removeClass("show");var a=this.el.getElement(".toggle");if(a.hasClass("hide")){a.removeClass("hide").addClass("show")}},render:function(){var b=function(f,d){return'<div class="card'+(d===0?" active":"")+'"><div class="header">'+f.term+'</div><div class="definition">'+f.definition+"</div></div>"},c=new Element("div",{"class":"cards",html:this.questions.map(b).join("").replace(/(<img src="[^"]*")/ig,function(d){return d+"/"}),styles:{height:parseInt(this.options.height,10)-70}}),a=new Element("div",{"class":"controls",html:['<div><a class="prev"></a></div>','<div><a class="next"></a></div>','<div><a class="show toggle"></a></div>','<div><a class="swap"></a></div>'].join("")});this.el.empty().adopt(c,a);this.loadImages=this.el.getElements("img").length;if(this.reflowable&&this.loadImages>0){this.el.getElements("img").addEvent("load",function(d){this.loadImages-=1;if(this.loadImages===0){setTimeout(function(){this.el.addClass("loaded")}.bind(this),Math.max(document.querySelectorAll("body > *").length/4*100,300))}}.bind(this))}else{this.el.addClass("loaded")}},wire:function(){this.el.addEvent("click:relay(.controls .swap)",this.swap.bind(this)).addEvent("click:relay(.controls .toggle)",this.toggle.bind(this)).addEvent("click:relay(.controls .next)",this.next.bind(this)).addEvent("click:relay(.controls .prev)",this.prev.bind(this))}});var md=md||{};md.storage=md.storage||{};md.storage.MemoryStorage=new Class({data:null,initialize:function(){this.data={}},setItem:function(a,b){this.data[a]=b},getItem:function(a){return this.data[a]}});md.storage.Local=new Class({Implements:[Options,Events],options:{session:false,storage:null},MAP:{memory:new md.storage.MemoryStorage(),session:window.sessionStorage,local:window.localStorage},initialize:function(b,a){if($type(b)!="string"){throw ("name must be string, found: "+key)}this.name=b;this.setOptions(a);if(this.options.storage){this.storage=this.MAP[this.options.storage]}else{if(this.options.session){this.storage=window.sessionStorage}else{this.storage=window.localStorage}}},save:function(a,b){var c=this._get();c[a]=b;this._persist(c)},remove:function(a){var b=this._get();delete b[a];this._persist(b)},get:function(a){var b=this._get();if(b==undefined||b==null){b={}}return b[a]},has:function(a){var b=this.get(a);return !(b==null||b==undefined)},getAll:function(){return this._get()},clear:function(){this._persist({})},_get:function(){var a=this.storage.getItem(this.name);if(!a){return{}}var b=JSON.parse(a);return b||{}},_persist:function(a){this.storage.setItem(this.name,JSON.stringify(a))}});var md=md||{};md.widgets=md.widgets||{};md.widgets.Quiz=new Class({CHAR_MAP:"abcdefghijklmnopqrstuvwxyz0123456789",Implements:[Options,Events],options:{container:undefined,qAttr:"data-que",optAttr:"data-option",qSetAttr:"data-que-set",answerAttr:"data-answer",correctMsgAttr:"data-que-correct-text",incorrectMsgAttr:"data-que-incorrect-text",correctClass:"correctAnswer",incorrectClass:"incorrectAnswer",selectedClass:"selectedAnswer",multiAnswer:"data-multi-answer",totalQuestions:-1,persist:true,generateHTML:false,questionData:null,msgTimeout:5000,inlineMsg:true,minHeight:"300px",correctMsg:"Correct! You answered correctly. Good job.",incorrectMsg:"Sorry! That is not the correct answer."},initialize:function(c,a){a.correctMsg=a.questionData.correctMsg;a.incorrectMsg=a.questionData.incorrectMsg;this.setOptions(a);this.el=$(c);if(this.options.generateHTML){this.generateHTML(this.options.questionData)}this.flash=new md.util.Flash({position:"center",type:"info",time:this.options.msgTimeout});this.stores={};this.quizSummaries={};var b=this.options.container.getElements("["+this.options.qAttr+"]");this.totalCount=b.length;if(this.options.totalQuestions<=0){this.options.totalQuestions=this.totalCount}b.each(function(d){this._setupQuestion(d)}.bind(this));window.addEventListener("resize",this.resize,false);window.addEventListener("load",this.resize,false);window.addEventListener("orientationchange",this.resize,false);window.addEventListener("message",function(d){if(this[JSON.parse(d.data).id]!==undefined){this[JSON.parse(d.data).id].apply(this,[JSON.parse(d.data).data,d.origin])}}.bind(this),false)},domReady:function(){this.resize()},resize:function(){window.parent.postMessage(JSON.stringify({id:"sizeQuiz",data:{id:window.name,width:document.body.offsetWidth,height:document.body.offsetHeight}}),"*")},showMessage:function(a,d,g){var g=a?this.options.correctMsg:this.options.incorrectMsg;if(this.options.inlineMsg){var f=d;if(f.getElements(".inline-message")){f.getElements(".inline-message").destroy()}var b=a?"quiz-correct":"quiz-incorrect";var c=new Element("span",{"class":"inline-message epub__inline-message "+b+" epub__"+b});c.set("text",g);f.adopt(c);setTimeout(function(){c.set({styles:{"padding-top":"7px",opacity:"0"},"class":"inline-message epub__inline-message",html:"hidden"})},this.options.msgTimeout)}else{if(a){this.flash.show(g)}else{this.flash.show(g,"error")}}},generateHTML:function(g){var c=this;this.el.empty();var a=new Element("div",{"class":"quiz-wrapper",styles:{"min-height":this.options.minHeight}});var f=function(n,l,k){var m=new Element("div",{html:'<span class="order">'+c.CHAR_MAP.charAt(n.order-1)+"</span> "+n.text,"class":"question-option",styles:{"padding-top":"5px"}});m.setAttribute(c.options.optAttr,n.order);if(n.correct){m.setAttribute(c.options.answerAttr,"true")}k.adopt(m)};var j=function(m,n){var p=new Element("div",{"class":"question-wrapper"});p.setAttribute(c.options.mulitAnswer,true);p.setAttribute(c.options.qSetAttr,c.el.getAttribute("id")||"1");p.setAttribute(c.options.qAttr,n+"");p.setAttribute(c.options.correctMsgAttr,g.correctMsg);p.setAttribute(c.options.incorrectMsgAttr,g.incorrectMsg);var o=new Element("div",{html:'<span class="order">'+m.order+"</span> "+m.text,"class":"question-text"});p.adopt(o);var l=new Element("div",{"class":"options-wrapper"});var k=new Element("span",{"class":"inline-message epub__inline-message",styles:{"padding-top":"7px",opacity:"0"},html:"hidden"});var n=0;m.options.each(function(i){n++;f(i,n,l)});p.adopt(l,k);a.adopt(p)};var d=0;g.questions.each(function(i){d++;j(i,d)});var b=new Element("button",{text:"Reset","class":"reset"});b.addEvent("click",function(){var i=function(k){(k===".inline-message")?this.el.getElements(k).forEach(function(l){l.set({"class":"inline-message epub__inline-message",text:""})}):this.el.getElements(k).forEach(function(l){l.removeClass(k.substr(1))})}.bind(this);i(".correctAnswer");i(".incorrectAnswer");i(".inline-message")}.bind(this));a.adopt(b);this.el.adopt(a);this.options.container=this.el},isAnswered:function(b,a){return b.has(a)&&b.get(a).answered},_setupQuestion:function(c){var d=c.getAttribute(this.options.qSetAttr);var b=c.getAttribute(this.options.qAttr);var f=c.getAttribute(this.options.multiAnswer)||false;var a=c.getElements("["+this.options.optAttr+"]");a.each(function(g){this._setupOption(c,g,d,b,f)}.bind(this))},_setupOption:function(b,g,d,l,a){var f=g.getAttribute(this.options.optAttr);var k=this.stores[d];var c=this.quizSummaries[d];if(!k){var i=this.options.persist?"local":"memory";k=new md.storage.Local(d+"-store",{storage:i});c=new md.widgets.QuizSummary(d,k,this.options.totalQuestions);this.stores[d]=k;this.quizSummaries[d]=c}if(!this.isAnswered(k,l)){g.addEvent("click",function(o){o.preventDefault();var p=o.target.getParent(".options-wrapper").getNext(".inline-message");if(p.hasClass("quiz-incorrect")||p.hasClass("quiz-correct")){return}o.target.getParent(".options-wrapper").getChildren().forEach(function(q){q.removeClass("correctAnswer").removeClass("incorrectAnswer")});if(this.isAnswered(k,l)){return}var n=g.hasAttribute("data-answer");if(a){this._handleMultiAnswerClick(k,g,l,f)}else{k.save(l+"",{answered:true,correct:n,optionId:f,multiAnswer:a})}var m=k.get(l);this._setEl(g,m);this._showMsg(m,b,c)}.bind(this));if(a&&k.has(l)){var j=k.get(l);if(j.optionIds.contains(f)){this._setEl(g,j)}}}else{console.log("already answered");var j=k.get(l);if(j.multiAnswer){if(j.optionIds.contains(f)){this._setEl(g,j)}}else{if(f==j.optionId){this._setEl(g,j)}}}},_handleMultiAnswerClick:function(d,c,a,f){if(!d.has(a)){d.save(a,{answered:false,correct:false,optionIds:[],multiAnswer:true})}var b=d.get(a);if(b.optionIds.contains(f)){return}b.optionIds.push(f);b.correct=this._isMultiAnswerCorrect(b,a);d.save(a,b);if(this._isMultiAnswered(d,c,a)){this._setMultiAnswerEl(b,a);var b=d.get(a);b.answered=true;d.save(a,b)}},_isMultiAnswerCorrect:function(c,a){var d=this.options.container.getElements("["+this.options.qAttr+"="+a+"] ["+this.options.answerAttr+"=true]");var b=d.map(function(f){return f.getAttribute(this.options.optAttr)}.bind(this));return b.every(function(f){return c.optionIds.contains(f)})},_isMultiAnswered:function(d,c,a){var f=this.options.container.getElements("["+this.options.qAttr+"="+a+"] ["+this.options.answerAttr+"=true]");var b=d.get(a);return b.optionIds.length==f.length},_showMsg:function(d,c,b){if(!d.answered){return}var a=this.options.incorrectMsgAttr;if(d.correct){a=this.options.correctMsgAttr}if(c.hasAttribute(a)){this.showMessage(d.correct,c,c.getAttribute(a))}else{var f=null;if(d.correct){f="You have "+b.getCorrectQCount()+" correct answer. Remaining: "+b.getRemainingQCount()}else{f="You have "+b.getIncorrectQCount()+" incorrect answer"+(b.getIncorrectQCount()>1?"s":"")+". Remaining: "+b.getRemainingQCount()}this.showMessage(d.correct,c,f)}},_setEl:function(b,a){if(a.multiAnswer&&!a.answered){b.addClass(this.options.selectedClass)}else{if(a.answered){if(a.correct){this.correctCount++}else{this.incorrectCount++}this._setOptionColor(b,a.correct)}}},_setMultiAnswerEl:function(b,a){var c=this.options.container.getElements("["+this.options.qAttr+"="+a+"] [class="+this.options.selectedClass+"]");c.each(function(d){d.removeClass(this.options.selectedClass);this._setOptionColor(d,b.correct)}.bind(this))},_setOptionColor:function(b,c){var a=c?this.options.correctClass:this.options.incorrectClass;b.addClass(a)}});md.widgets.QuizSummary=new Class({initialize:function(c,b,a){this.quizStore=b;this.totalQuestions=a;this.store=new md.storage.Local(c+"-summary",{session:true});this.store.save("totalQuestions",this.totalQuestions)},getTotalQCount:function(){return parseInt(this.store.get("totalQuestions"))},getCorrectQCount:function(){return this._processAndCount(function(a){return a.answered&&a.correct})},getIncorrectQCount:function(){return this._processAndCount(function(a){return a.answered&&!a.correct})},getAnsweredQCount:function(){return this._processAndCount(function(a){return a.answered})},getRemainingQCount:function(){return this.getTotalQCount()-this.getAnsweredQCount()},_processAndCount:function(b){var a=0;Object.each(this.quizStore.getAll(),function(c){if(b(c)){a++}});return a}});var md=md||{};md.widgets=md.widgets||{};md.widgets.ShareWidget=new Class({Implements:[Options],URL_MAP:{facebook:"http://www.facebook.com/sharer/sharer.php?u=#url",twitter:"https://twitter.com/intent/tweet?text=#url",google:"https://plus.google.com/share?url=#url"},options:{services:["facebook","google","twitter"]},initialize:function(c,b,a){c.empty();this.setOptions(a);this.el=new Element("div",{"class":"share-widget"});this.options.services.each(function(g){var f=this.URL_MAP[g].replace("#url",b);var i=new Element("a",{target:"_blank",href:f});var d=new Element("li",{"class":"service-"+g});d.adopt(i);this.el.adopt(d)}.bind(this));this.el.adopt(new Element("span",{style:"clear: both"}));c.adopt(this)},toElement:function(){return this.el}});(function(){var a=new Class({loopCount:0,isLooping:false,loopMethod:function(){},setLoop:function(d,c){wasLooping=this.isLooping;if(wasLooping){this.stopLoop()}this.loopMethod=d;this.loopDelay=c||3000;if(wasLooping){this.startLoop()}return this},stopLoop:function(){this.isLooping=false;clearInterval(this.periodical);return this},startLoop:function(d,c){if(!this.isLooping){this.isLooping=true;if(c){this.looper()}this.periodical=this.looper.periodical(d||this.loopDelay,this)}return this},resetLoop:function(){this.loopCount=0;return this},looper:function(){this.loopCount++;this.loopMethod(this.loopCount);return this}});var b=this.Gallery=new Class({Implements:[Options,Events,a],options:{delay:7000,transition:"crossFade",duration:500,autoplay:false,dataAttribute:"data-gallery",selector:"> *",initialSlideIndex:0},transitioning:false,reversed:false,initialize:function(d,c,f){this.element=document.id(d);this.setOptions(c);if(!f){this.setup()}},setup:function(c){if(c){this.setOptions(c)}this.slides=this.element.getElements(this.options.selector);this.setupElement().setupSlides();this.current=this.current||this.slides[this.options.initialSlideIndex];this.index=this.current.retrieve("gallery-index");this.setLoop(this.show.pass(this.reversed?"previous":"next",this),this.options.delay);if(this.options.autoplay){this.play()}return this},show:function(d,f){if(d=="next"||d=="previous"){d=this[d+"Slide"]()}if(typeof d=="number"){d=this.slides[d]}if(d==this.current||this.transitioning){return this}this.transitioning=true;this.current.store("gallery:oldStyles",this.current.get("style"));var k=(f&&f.transition)?f.transition:d.retrieve("gallery-transition"),j=(f&&f.duration)?f.duration:d.retrieve("gallery-duration"),i=this.current.setStyle("z-index",1),g=this.reset(d).setStyle("z-index",0),c=this.index=g.retrieve("gallery-index");slideData={previous:{element:i,index:i.retrieve("gallery-index")},next:{element:g,index:c}};this.fireEvent("show",slideData);b.transitions[k]({previous:i,next:g,duration:j,instance:this});i.setStyle("width",0);(function(){i.setStyle("visibility","hidden");this.fireEvent("showComplete",slideData);this.transitioning=false}).bind(this).delay(j);this.current=g;return this},play:function(){this.startLoop();this.fireEvent("play");return this},pause:function(){this.stopLoop();this.fireEvent("pause");return this},reverse:function(){this.setLoop(this.show.pass(this.reversed?"next":"previous",this),this.options.delay);this.reversed=!this.reversed;this.fireEvent("reverse");return this},setupElement:function(){this.storeData(this.element);this.options.duration=this.element.retrieve("gallery-duration");this.options.transition=this.element.retrieve("gallery-transition");this.options.delay=this.element.retrieve("gallery-delay");if(this.element.getStyle("position")=="static"){this.element.setStyle("position","relative")}return this},setupSlides:function(){this.slides.each(function(c,d){c.store("gallery-index",d).store("gallery:oldStyles",c.get("style"));this.storeData(c);c.setStyle("visibility",(this.current||d==this.options.initialSlideIndex)?"":"hidden");if(!this.current&&d!==this.options.initialSlideIndex){c.setStyle("width",0)}},this);return this},storeData:function(c){var d=this.options;c.store("gallery-transition",d.transition);c.store("gallery-duration",d.duration);if(c==this.element){c.store("gallery-delay",d.delay)}var f=c.get(this.options.dataAttribute);if(!f){return this}Slick.parse(f).expressions[0].each(function(g){c.store("gallery-"+g.tag,g.pseudos[0].key)});return this},reset:function(c){return c.set("style",c.retrieve("gallery:oldStyles"))},nextSlide:function(){return this.slides[this.index+1]||this.slides[0]},previousSlide:function(){return this.slides[this.index-1]||this.slides.getLast()},toElement:function(){return this.element}});b.transitions={};b.defineTransition=function(c,d){b.transitions[c]=d};b.defineTransitions=function(c){Object.each(c,function(f,d){b.defineTransition(d,f)})}})();Element.Properties.gallery={set:function(a){this.get("gallery").setup(a);return this},get:function(){var a=this.retrieve("gallery");if(!a){a=new Gallery(this,{},true);this.store("gallery",a)}return a}};Element.implement({playGallery:function(a){this.get("gallery").setup(a).play();return this},pauseGallery:function(){this.get("gallery").pause();return this}});Gallery.defineTransitions({none:function(a){a.previous.setStyle("display","none");return this},fade:function(a){a.previous.set("tween",{duration:a.duration}).fade("out");return this},crossFade:function(a){a.previous.set("tween",{duration:a.duration}).fade("out");a.next.set("tween",{duration:a.duration}).fade("in");return this},fadeThroughBackground:function(b){var a=b.duration/2;b.next.set("tween",{duration:a}).fade("hide");b.previous.set("tween",{duration:a,onComplete:function(){b.next.fade("in")}}).fade("out");return this}});(function(){function a(c){return{property:(c=="left"||c=="right")?"left":"top",inverted:(c=="left"||c=="up")?1:-1}}function b(c,d,f){var g={duration:f.duration,unit:"%"};if(c=="blind"){f.next.setStyle("z-index",2)}if(c!="slide"){f.next.set("tween",g).setStyle(d.property,100*d.inverted+"%");f.next.tween(d.property,0)}if(c!="blind"){f.previous.set("tween",g).tween(d.property,-(100*d.inverted))}}["left","right","up","down"].each(function(f){var g=f.capitalize(),c="blind"+g,d="slide"+g;[["push"+g,(function(){var i=a(f);return function(j){b("push",i,j)}}())],[c,(function(){var i=a(f);return function(j){b("blind",i,j)}}())],[d,(function(){var i=a(f);return function(j){b("slide",i,j)}}())],[c+"Fade",function(i){this.fade(i)[c](i);return this}]].each(function(i){Gallery.defineTransition(i[0],i[1])})})})();var md=md||{};md.widgets=md.widgets||{};md.widgets.Gallery=new Class({Implements:[Options,Events],options:{images:null,thumbnails:false,size:null,clickToNext:false},initialize:function(c,a,d,b){if(typeOf(c)=="string"){this.el=$(c)}else{this.el=c}this.setOptions(b);this.inChaucer=typeof parent.Lindgren!=="undefined";if(this.options.images){var f=new Element("div",{"class":"main-image-outer"});a.el=new Element("div",{"class":"main-image-inner"});f.adopt(a.el);this.el.empty();this.options.images.each(function(g,m){var l=new Element("div",{"class":"slide-wrapper wraptocenter"});var k=this.options.thumbnails?this.options.size.height-90:this.options.size.height;if(this.options.size){l.setStyles({width:this.options.size.width+"px",height:k+"px"})}if(g.type==="video"){var j=new Element("video",{controls:true});if(g.poster){j.setAttribute("poster",g.poster)}j.adopt(new Element("source",{src:this.inChaucer?"/index.php?option=com_chaucer&task=media.getFile&id="+g.id:g.src,type:this.getVideoType(g.src)}));l.adopt(new Element("span"));l.adopt(j)}else{var o=new Element("img",{src:g.src}),n=(m+1)+" of "+this.options.images.length;l.adopt(new Element("span",{"class":"main-position",text:n}));l.adopt(o)}a.el.adopt(l)}.bind(this));this.el.adopt(f)}if(this.options.size){this.el.setStyles({width:this.options.size.width+"px",height:this.options.size.height+"px"})}if(this.options.thumbnails){this.appendThumbnails(a.el);this.el.getElements(".main-image-outer").setStyle("height",this.el.getHeight()-90)}this.gallery=new Gallery(a.el,a.options);this.gallery.addEvent("showComplete",function(){}.bind(this));if(this.options.clickToNext){this.el.addEvent("click",function(g){if(g.target.tagName.toLowerCase()==="video"){return}g.preventDefault();this.gallery.show("next")}.bind(this))}$(this.gallery).addEvents({swipe:function(g){this.show("show"+((g.direction=="left")?"Next":"Previous"),{transition:"blind"+g.direction.capitalize()})}.bind(this),mousedown:function(g){g.stop()}});if(d){this.slider=new Slider(d.el,d.knob,d.options);this.slider.addEvent("change",function(g){this.current=g;if(this.gallery.slides.length<=g){return}this.show("show",g)}.bind(this))}},getVideoType:function(a){var b=a.split("?")[0].split("."),c=b[b.length-1];switch(c){case"m4v":case"mp4":return"video/mp4";case"ogg":case"ogv":return"video/ogg";case"webm":return"video/webm";default:return"video/mp4"}},show:function(a,b){this.gallery[a](b)},appendThumbnails:function(d){var c=new Element("div",{"class":"thumb-wrapper-outer"});var b=new Element("div",{"class":"thumb-wrapper-inner"});c.adopt(b);var a=this.el.getElements("img, video");a.each(function(f,g){var j=f.getAttribute("src");if(f.tagName.toLowerCase()=="video"){j=f.getAttribute("poster");if(!j){j="../Images/movie.png"}}b.adopt((new Element("p",{"class":(g===0?"active":"")})).adopt((new Element("span",{"class":"thumb-number",text:g+1}))).adopt(new Element("img",{src:f.getAttribute("src"),"data-pos":g})))});b.getChildren().addEvent("click",function(g){g.preventDefault();var f=this.gallery.current.getElement("video");if(f){f.pause()}this.show("show",parseInt(g.target.getAttribute("data-pos")))}.bind(this));this.el.adopt(c)}});var md=md||{};md.widgets=md.widgets||{};md.widgets.Popup=new Class({Implements:[Options],options:{closeBtn:false,closeBtnText:"Close",position:"fixed",alignment:"topLeft"},initialize:function(c,b,a){this.setOptions(a);this.el=c;if(typeOf(b)=="string"){this.popupEl=Elements.from(b)}else{this.popupEl=b}this.el.addEvent("click",this.show.bind(this))},createModal:function(){var i=new Element("div",{"class":"modal"}),k=new Mask(document.body,{destroyOnHide:false,width:"100%",height:"100%"}),j=function(){i.getElements("video, audio").each(function(l){l.pause()});i.hide();k.hide()},g=function(m){var l=m||event;j();l.preventDefault()};k.addEvent("hide",g);k.addEvent("click",g);this.el.addEvent("click:relay(.close)",g);if(this.options.size){i.setStyles({width:this.options.size.width+"px"})}$(k).setStyle("position","fixed");var a=null;if(this.options.title&&this.options.title.length>0){a=new Element("div",{"class":"modal-header",text:this.options.title});i.adopt(a)}var f=new Element("div",{"class":"modal-body"});f.setStyle("height",this.options.size.height+"px");f.adopt(this.popupEl);i.adopt(f);if(this.options.closeBtn){var c=new Element("div",{"class":"modal-footer"});i.adopt(c);var d=new Element("a",{"class":"modal-close btn primary",text:this.options.closeBtnText});d.addEvent("click",j);c.adopt(d)}i.inject(document.body,"top").hide();if(this.options.position=="fixed"){i.position(this.options.pos||{})}else{var b=function(l){if(l=="topLeft"){return"bottomRight"}else{if(l=="topRight"){return"bottomLeft"}else{if(l=="bottomLeft"){return"topRight"}else{return"topLeft"}}}};i.position({relativeTo:e.target,position:b(this.options.alignment),edge:this.options.alignment})}this.modal=i;this.mask=k},show:function(a){if(this.modal===undefined){this.createModal()}a.preventDefault();this.mask.show();this.modal.show();this.el.fireEvent("popupVisible",this)}});var md=md||{};md.util=md.util||{};md.util.StepperElement=new Class({initialize:function(d,c,b,a){this.el=d;this.startPos=c;this.endPos=b;this.steps=a;this.el.setPosition(c);this.xStep=(b.x-c.x)/a;this.yStep=(b.y-c.y)/a},toElement:function(){return this.el},moveLinearTo:function(b){var a={x:this.startPos.x+(this.xStep*b),y:this.startPos.y+(this.yStep*b)};this.el.setPosition(a)}});md.util.LinearElementStepper=new Class({Implements:[Options,Events],initialize:function(c,a,b){this.stepperElements=[];this.steps=a;this.setOptions(b);c.each(function(d){this.stepperElements.push(new md.util.StepperElement(d.el,d.startPos,d.endPos,a))}.bind(this));this.setOptions(b)},moveTo:function(a){this.stepperElements.each(function(b){b.moveLinearTo(a)})}});var md=md||{};md.widgets=md.widgets||{};md.widgets.Sidebar=new Class({Implements:[Options],options:{header:null,footer:null,content:null,width:null},initialize:function(d,b){d.empty();this.setOptions(b);this.el=d;var c=(this.options.header?"sb-header":"")+(this.options.footer?" sb-footer":"");this.tbl=new Element("table",{cellpadding:0,cellspacing:0,"class":c});var a=new Element("tbody").inject(this.tbl);if(this.options.header&&this.options.header.length>0){a.adopt(this.addTr(this.options.header,"header","sb-gradient"))}a.adopt(this.addTr(this.options.content,"content",""));if(this.options.footer&&this.options.footer.length>0){a.adopt(this.addTr(this.options.footer,"footer","sb-gradient"))}this.el.style.height=this.options.height+"px";this.el.adopt(this.tbl)},addTr:function(d,b,a){var c=new Element("tr");var g=new Element("td",{"class":"sidebar-"+b}).inject(c);var f=new Element("div",{"class":"sb-inner "+a,html:d});if(this.options.width){f.setStyle("width",(this.options.width-22)+"px")}g.adopt(f);return c},toElement:function(){return this.el}});var md=md||{};md.widgets=md.widgets||{};md.widgets.TimeSequence=new Class({Implements:[Options],options:{snap:25,snapXOffset:200,contentContainer:null,displayTolerance:50},points:null,snapped:false,displayed:false,maxWidth:0,initialize:function(d,c){this.el=$(d);this.setOptions(c);var f=this.el.getPosition().x;this.points=this.el.getChildren().map(function(g){return g.getPosition({relativeTo:this.el}).x-f-this.options.snapXOffset}.bind(this));console.log("points: ",this.points);this.maxWidth=this.points[this.points.length-1];var b=0;var a=this;this.drag=new Drag(d,{onStart:function(g){b=g.getPosition().x},onDrag:function(i,m){var l=i.getPosition().x;l=Math.abs(l);var k=Math.abs(b-l);var g=a.options.snap;var j=a.getSnapValue(l);console.log("snap to: ",j);if(k>g&&l>(j-g)&&l<(j+g)){console.log("snapping");i.setPosition({x:-j});if(!a.snapped){a.snapped=true}}else{if(a.snapped){a.snapped=false}}var n=a.options.displayTolerance;if(k>n&&l>(j-n)&&l<(j+n)){console.log("displaying..");if(!a.displayed){a.showContent(j);a.displayed=true}}else{if(a.displayed){a.hideContent();a.displayed=false}}},onComplete:function(g){},modifiers:{y:false},limit:{x:[-a.maxWidth,0]}});this.hideContent(false)},getSnapValue:function(b){var a=null;b=b-this.options.snap;this.points.each(function(c){if(!a&&b<c){a=c}});return a},showContent:function(a){if(this.options.contentContainer){this.hideContent(true);this.options.contentContainer.getChildren()[this.points.indexOf(a)].fade("in")}},hideContent:function(b){if(this.options.contentContainer){var a=this.options.contentContainer.getChildren();a.fade("out")}}});var md=md||{};md.animation=md.animation||{};md.animation.Transition=new Class({Implements:[Options,Events],duration:-1,_direct:false,transitionTimings:{linear:"0,0,1,1","expo:in":"0.71,0.01,0.83,0","expo:out":"0.14,1,0.32,0.99","expo:in:out":"0.85,0,0.15,1","circ:in":"0.34,0,0.96,0.23","circ:out":"0,0.5,0.37,0.98","circ:in:out":"0.88,0.1,0.12,0.9","sine:in":"0.22,0.04,0.36,0","sine:out":"0.04,0,0.5,1","sine:in:out":"0.37,0.01,0.63,1","quad:in":"0.14,0.01,0.49,0","quad:out":"0.01,0,0.43,1","quad:in:out":"0.47,0.04,0.53,0.96","cubic:in":"0.35,0,0.65,0","cubic:out":"0.09,0.25,0.24,1","cubic:in:out":"0.66,0,0.34,1","quart:in":"0.69,0,0.76,0.17","quart:out":"0.26,0.96,0.44,1","quart:in:out":"0.76,0,0.24,1","quint:in":"0.64,0,0.78,0","quint:out":"0.22,1,0.35,1","quint:in:out":"0.9,0,0.1,1"},options:{transition:"sine:in:out",properties:"all",duration:400,durationUnit:"ms"},initialize:function(b,a){this.el=b;this.setOptions(a);this.setProps()},setProps:function(){var b=typeOf(this.options.properties)=="array"?this.options.properties.join(","):this.options.properties;if(b.length<=0){return}this.el.setStyle("-webkit-transition-property",b);this.el.setStyle("transition-property",b);var c=this.options.duration+this.options.durationUnit;this.el.setStyle("-webkit-transition-duration",c);this.el.setStyle("transition-duration",c);var d=this.transitionTimings[this.options.transition];if(!d){throw ("unable to find transition "+this.options.transition)}var a="cubic-bezier("+d+")";this.el.setStyle("-webkit-transition-timing-function",a);this.el.setStyle("transition-timing-function",a);this.duration=this.options.duration},cleanupProps:function(){this.el.setStyles({"-webkit-transition-timing-function":null,"transition-timing-function":null,"-webkit-transition-duration":null,"transition-duration":null,"-webkit-transition-property":null,"transition-property":null});this.duration=0},toElement:function(){return this.el},setDirect:function(a){if(a){this.cleanupProps()}else{this.setProps()}this.direct=a},setValue:function(b,a){$(this).setStyles(b);if(a){a.delay(this.duration)}}});var md=md||{};md.widgets=md.widgets||{};md.widgets.AbstractWidget=new Class({Implements:[Options,Events],initialize:function(b,a){this.el=b;this.setOptions(a)},toElement:function(){return this.el}});md.widgets.CanvasAnimation=new Class({initialize:function(b,a){this.el=b;this.context=b.getContext("2d");this.requestAnimationFrame=function(c){return setTimeout(c,16)};this.values=a},getRequestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame},render:function(){this.context.fillStyle="#FFFFFF";this.context.fillRect(0,0,$(this).width,$(this).height);this.context.fillStyle=this.values.borderColor;this.context.fillRect(0,0,this.values.width,this.values.height);this.context.clearRect(this.values.borderWidth,this.values.borderWidth,this.values.width-this.values.borderWidth*2,this.values.height-this.values.borderWidth*2);this.getRequestAnimationFrame()(this.render.bind(this))},animate:function(j,f,d){var i=new Date().getTime();var a=i+d;var c=this.values[j];var g=f-c;var b=function(){var l=new Date().getTime();var k=Math.min((d-(a-l))/d,1);this.values[j]=c+(g*k);if(k<1){this.getRequestAnimationFrame()(b)}}.bind(this);return b()},toElement:function(){return this.el}});md.widgets.helpers=md.widgets.helpers||{};md.widgets.helpers.ComicPanelWrapper=new Class({Extends:md.widgets.AbstractWidget,initialize:function(a,c,b){this.container=a;this.app=c;this.parent(a,b);this._createHider("right","left");this._createHider("bottom","top");this._createBorderHider()},_createHider:function(b,a){var f=b+"HiderEl";var d=(a=="top")?0:$(this.app).getWidth();var c=(a=="top")?$(this.app).getHeight():-1;this[f]=new Element("div",{"class":"hider hider-"+b});this[f].setStyles({position:"absolute",width:$(this.app).getWidth()+"px",height:$(this.app).getHeight()+"px",left:d,top:c,"z-index":100,"background-color":this.options.appColor});this[f].setStyle("border-"+a,this.options.borderWidth+"px solid "+this.options.borderColor);$(this).adopt(this[f]);this[b+"Fx"]=new md.animation.Transition(this[f],{properties:this.app.slide||this.app.fade?["-webkit-transform"]:[]});this[f].addEvent("click",function(g){g.stop();this.fireEvent("hiderClicked")}.bind(this))},_createBorderHider:function(){this.borderHiderEl=new Element("div");this.borderHiderEl.setStyles({width:$(this.app).getWidth(),height:this.options.borderWidth+4,top:-(this.options.borderWidth+2),position:"absolute","z-index":2000,"background-color":this.options.appColor});this.bottomHiderEl.adopt(this.borderHiderEl)},set:function(b,d,c,a){b=b-this.options.borderWidth;d=d-this.options.borderWidth;c=c+(this.options.borderWidth*2);this.rightFx.setValue({"-webkit-transform":"translate3d("+-b+"px,0,0)"});this.bottomFx.setValue({"-webkit-transform":"translate3d(0,"+-d+"px,0)"});setTimeout(function(){this.borderHiderEl.setStyles({left:(c+0.15)+"px"})}.bind(this),300)}});md.widgets.ComicBook=new Class({Extends:md.widgets.AbstractWidget,current:null,currentPoint:0,initialSize:null,currentTimeout:null,panelMode:false,options:{borderColor:"#cccccc",borderWidth:2,points:[],padding:10,transition:"slide",fadeToColor:"#000000",autoPlay:false,autoPlayInterval:5000,kenBurns:false,classWrapper:"eyeframe-wrapper",classPositioner:"eyeframe-positioner",autoStart:false,autoStartDelay:100,jumpToNext:true,nextPage:null,lastFrameAnchor:null,appColor:"#fff",defaultPageHeight:1024,},createHiders:function(){var a=$(this).getElement("."+this.options.classPositioner);this.wrapperHelper=new md.widgets.helpers.ComicPanelWrapper(a,this,this.options);this.wrapperHelper.addEvent("hiderClicked",function(){this.cleanUp()}.bind(this))},initialize:function(d,a){this.inEditor=window.parent&&window.parent.Lindgren!==undefined;var b=this.createDOM(d);this.parent(b,a);if($(this).getHeight()==0){$(this).setStyle("height","100%")}var c=function(){this.elSize=this.el.getSize();console.log("Height: "+this.elSize.y);if(this.elSize.y<this.options.defaultPageHeight/2||this.elSize.y>this.options.defaultPageHeight*1.3){console.log("Height still wrong, trying again");var f=c.delay(5)}else{console.log("Clear timeout");clearTimeout(f);this._init(d,a)}}.bind(this);c()},_init:function(g,c){console.log("El Size: "+this.elSize.x+","+this.elSize.y);if(this.options.transition=="kenburns"){this.options.kenBurns=true;this.options.transition="crossfade"}this.slide=this.options.transition=="slide";this.fade=(this.options.transition=="fade")||(this.options.transition=="crossfade");this.crossfade=this.options.transition=="crossfade";this.createHiders();this.points=this.options.points;this.imgWrapper=$(this).getElement("."+this.options.classWrapper);this.imgWrapper.setStyles({height:this.elSize.y,width:this.elSize.x,"-webkit-transform":"translate3d(0,0,0)"});this.wrapperFx=new md.animation.Transition(this.imgWrapper,{properties:this.slide||this.fade?["height","width","border"]:[]});this.img=$(this).getElement("."+this.options.classWrapper+" img");this.img.setStyles({height:this.elSize.y,width:this.elSize.x,"-webkit-transform-origin-x":0,"-webkit-transform-origin-y":0});this.initialSize=this.img.getSize();this.imgFx=new md.animation.Transition(this.img,{properties:this.slide?["-webkit-transform","-webkit-filter"]:["opacity"]});if(this.options.kenBurns){this.kenBurnsEl=new Element("div","ken-burns-wrapper");this.kenBurnsEl.replaces(this.img);this.kenBurnsEl.adopt(this.img)}if(this.crossfade){this.otherImg=this.img.clone();this.otherImgFx=new md.animation.Transition(this.otherImg,{properties:this.slide?["-webkit-transform","-webkit-filter"]:["opacity"]});this.otherImg.setStyle("opacity","0");this.otherImg.inject(this.img,"after")}this.imgPositioner=$(this).getElement("."+this.options.classPositioner);this.imgPositioner.setStyles({height:this.elSize.y,width:this.elSize.x});this.positionerFx=new md.animation.Transition(this.imgPositioner,{properties:this.slide||this.fade?["-webkit-transform"]:[]});if(this.options.jumpToNext){var f=this.inEditor?Number(window.parent.Lindgren.core.currentPage):parseInt(document.body.get("id").substr(4),10),b=f+1;if(f===Number(localStorage.continuouspanels)){this.options.autoStart=true}this.nextPage=b;if(!this.inEditor){this.options.lastFrameAnchor=this.options.nextPage}else{}delete localStorage.continuouspanels}this.cleanUp(true);var a=new Mask(this.imgWrapper,{style:{opacity:0}});var d=new Element("a",{href:this.options.lastFrameAnchor,styles:{display:"block",width:"100%",height:"100%","-webkit-tap-highlight-color":"rgba(0,0,0,0)"}});$(a).adopt(d);a.show();$(d).addEvent("click",function(i){if(this.options.nextPage&&this.currentPoint==this.points.length){localStorage.continuouspanels=this.nextPage;return}i.stop();this._clicked(i)}.bind(this));$(this).addEvent("click",function(i){this.cleanUp()}.bind(this));if(this.options.autoStart){this.next.delay(this.options.autoStartDelay,this)}},createDOM:function(d){d.setStyles({"max-width":"initial","max-height":"initial"});var c=new Element("div",{"class":this.options.classPositioner});var b=new Element("div",{"class":this.options.classWrapper});b.wraps(d);c.wraps(b);var a=c.getParent();a.setStyles({"background-color":this.options.appColor,overflow:"hidden"});return a},setBgColor:function(){var a=this.fade&&!this.crossfade;this.imgWrapper.setStyle("background-color",a?this.options.fadeToColor:"transparent")},clearBgColor:function(){this.imgWrapper.setStyle("background-color",null)},setCurrent:function(a){this.current=a},_clicked:function(a){a.stop();this.next();if(this.currentPoint!=1){this.cleanupTimeout()}},next:function(){if(this.currentTimeout){this.cleanupTimeout()}if(this.currentPoint>this.points.length){return}else{if(this.currentPoint==this.points.length){this.currentPoint=0;this.cleanUp();return}}this.setTo(this.points[this.currentPoint]);this.currentPoint++;this.autoPlayIfRequired()},cleanupTimeout:function(){if(this.currentTimeout){clearTimeout(this.currentTimeout);this.currentTimeout=null}},autoPlayIfRequired:function(){if(this.options.autoPlay){this.currentTimeout=this.next.bind(this).delay(this.options.autoPlayInterval)}},_setFxMode:function(a){this.wrapperFx.setDirect(a);this.positionerFx.setDirect(a);this.imgFx.setDirect(a);if(this.crossfade){this.otherImgFx.setDirect(a)}},cleanUp:function(a){if(!this.fade||this.crossfade){this.clearBgColor()}this.cleanupTimeout();this.cleanUpKenBurns();this._setFxMode(a);this.setTo({height:this.initialSize.y,imageTop:0,imageLeft:0,width:this.initialSize.x,reset:true},function(){this._setFxMode(false);this.setBgColor()}.bind(this));this.panelMode=false;this.current=null;this.currentPoint=0},cleanUpKenBurns:function(){if(this.options.kenBurns){this.kenBurnsEl.removeClass("kenBurnsIn");this.kenBurnsEl.removeClass("kenBurnsOut")}},setTo:function(a,b){this._action(a,b)},_action:function(f,g){this.panelMode=true;var a=this.points.indexOf(f);var d=this.calculateSlideData(f);this.wrapperHelper.set(d.containerWidth-d.width,d.containerHeight-d.height,d.width,d.height);this.positionerFx.setValue({"-webkit-transform":"translate3d("+d.leftPos+"px,"+d.topPos+"px,0)"},function(){}.bind(this));var c=function(j){var i="translate3d("+d.imageLeft+"px,"+d.imageTop+"px,0) scale("+d.ratio+")";j.setValue({"-webkit-transform":i},function(){if(g){g()}}.bind(this))}.bind(this);var b=function(){var j=this.imgFx;var i=this.img;this.imgFx=this.otherImgFx;this.img=this.otherImg;this.otherImgFx=j;this.otherImg=i;this.otherImgFx.setValue({opacity:"0"})}.bind(this);if(this.fade){if(this.crossfade){c(this.otherImgFx);this.otherImgFx.setValue({opacity:"1"},function(){b()}.bind(this))}this.imgFx.setValue({opacity:"0"},function(){if(!this.crossfade){this.imgFx.setValue({opacity:"1"});c(this.imgFx)}}.bind(this))}else{c(this.imgFx)}if(a>=0){this.imgWrapper.setStyles({border:this.options.borderWidth+"px solid "+this.options.borderColor})}else{this.imgWrapper.setStyles({border:"0px solid "+this.options.borderColor})}if(this.options.kenBurns&&a>=0){this.cleanUpKenBurns();this.kenBurnsEl.addClass(a%2?"kenBurnsOut":"kenBurnsIn")}this.setCurrent(f)},calculateSlideData:function(d){var a=$(this).getSize();var n=this.img.getSize();var o=this.options.padding;var b=this.options.borderWidth*2;var c=-1;var q=-1;var l=1;if(d.reset){b=0;o=0}var f=o;var i=o;c=a.x-(o*2)-(b);q=a.y-(o*2)-(b);var m=c/d.width;var k=q/d.height;if(m<k){l=m;q=d.height*l;i=(a.y-q-b)/2}else{l=k;c=d.width*l;f=(a.x-c-b)/2}var j={x:n.x*l,y:n.y*l};var g=(j.y*-d.imageTop/n.y);var p=(j.x*-d.imageLeft/n.x);var r={width:c,height:q,ratio:l,leftPos:f,topPos:i,imageTop:g,imageLeft:p,containerWidth:a.x,containerHeight:a.y};return r}});var md=md||{};md.widgets=md.widgets||{};md.widgets.ImageCompare=new Class({Implements:[Options,Events],options:{featured:{left:null,right:null},images:[],zoom:false},initialize:function(c,b){var a=function(g){var i=g.target.clone(),f=new Element("div",{"class":"drag-clone"}).setStyles(Object.merge(g.target.getCoordinates(),{opacity:"0.6",position:"absolute",display:"block"})),d;(this.reflowable?this.el:document.body).adopt(f.adopt(i));d=new Drag.Move(f,{droppables:this.el.getElements(".drop-left, .drop-right"),onDrag:this.reflowable?function(j,k){k.stop();j.setStyle("top",k.event.pageY)}:function(j,k){k.stop()},onDrop:function(l,k){if(this.reflowable){var j=Math.abs;k=this.el.getElements(".drop-left, .drop-right").map(function(n){var m=Object.merge(n.getCoordinates(),l.getPosition(n));return{x:m.x,y:m.y,w:m.width,h:m.height,el:n}}).filter(function(m){return j(m.x)<m.w&&j(m.y)<m.h}).reduce(function(n,m){if(n.el===null){return m}return(j(n.x)+j(n.y)<j(m.x)+j(m.y))?n:m},{el:null}).el}if(k){if(this.options.zoom&&!this.reflowable){this.makeImageMap(k,l.getElement("img"))}else{k.empty().adopt(l.getElement("img"))}}l.destroy();d.detach()}.bind(this),onCancel:function(j){j.destroy()},onComplete:function(j){j.destroy()}});g.stop();d.start(g)}.bind(this);this.reflowable=document.body.hasClass("book-type-reflowable")&&!(window.parent&&window.parent.Lindgren);if(this.reflowable){this.refactorDrag()}this.el=c;this.setOptions(b);this.render();this.el.addEvent("touchstart:relay(.film-strip img)",a);this.el.addEvent("mousedown:relay(.film-strip img)",a)},defaultZoom:function(b,c){var a;if(b.width<b.height){if(c.naturalWidth>c.naturalHeight){a=b.width/(c.naturalWidth/c.naturalHeight)}else{a=b.width/(c.naturalHeight/c.naturalWidth)}}else{if(c.naturalWidth>c.naturalHeight){a=b.height/(c.naturalHeight/c.naturalWidth)}else{a=b.height/(c.naturalWidth/c.naturalHeight)}}return a},refactorDrag:function(){Class.refactor(Drag,{start:function(a){a.page=a.client;this.previous(a)},drag:function(a){a.page=a.client;this.previous(a)}})},makeImageMap:function(b,c){var d=b.getCoordinates(),f=new Element("div").setStyles(d),a=this.defaultZoom(d,c);b.empty().adopt(f);new md.widgets.ImageMap(f,{imageUrl:c.get("src"),defaultZoom:a,maxZoom:a*2})},render:function(){var k=this.el.getCoordinates();if(k.width<100||k.height<100){setTimeout(this.render.bind(this),0);return}var c={width:Math.floor(k.width*0.45),height:Math.floor(k.height*0.47)},b=new Element("div",{"class":"drop-left",text:"Drag an image here to compare.",styles:c}),g=new Element("div",{"class":"drop-right",text:"Drag an image here to compare.",styles:c}),j=new Element("div",{"class":"film-strip-wrapper"}),d=new Element("div",{"class":"film-strip"}),i=this.options.images.map(function(l){return new Element("img",{src:l.url})});j.adopt(d.adopt(i));this.el.empty().adopt(b,g,j);if(this.options.featured.left){var a=new Element("img",{src:this.options.featured.left.url});b.empty().adopt(a);if(this.options.zoom&&!this.reflowable){a.onload=function(){this.makeImageMap(b,a)}.bind(this)}}if(this.options.featured.right){var f=new Element("img",{src:this.options.featured.right.url});g.empty().adopt(f);if(this.options.zoom&&!this.reflowable){f.onload=function(){this.makeImageMap(g,f)}.bind(this)}}this.el.setStyle("height",this.options.height);if(this.reflowable){this.el.parentNode.addClass("page-break")}}});
